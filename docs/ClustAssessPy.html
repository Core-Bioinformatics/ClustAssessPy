<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.0"/>
    <title>ClustAssessPy API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>




            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="function" href="#element_sim_elscore">element_sim_elscore</a>
            </li>
            <li>
                    <a class="function" href="#element_sim">element_sim</a>
            </li>
            <li>
                    <a class="function" href="#element_sim_matrix">element_sim_matrix</a>
            </li>
            <li>
                    <a class="function" href="#element_agreement">element_agreement</a>
            </li>
            <li>
                    <a class="function" href="#element_consistency">element_consistency</a>
            </li>
            <li>
                    <a class="function" href="#weighted_element_consistency">weighted_element_consistency</a>
            </li>
            <li>
                    <a class="function" href="#assess_feature_stability">assess_feature_stability</a>
            </li>
            <li>
                    <a class="function" href="#assess_clustering_stability">assess_clustering_stability</a>
            </li>
            <li>
                    <a class="function" href="#assess_nn_stability">assess_nn_stability</a>
            </li>
            <li>
                    <a class="function" href="#plot_clustering_overall_stability">plot_clustering_overall_stability</a>
            </li>
            <li>
                    <a class="function" href="#plot_feature_overall_stability_boxplot">plot_feature_overall_stability_boxplot</a>
            </li>
            <li>
                    <a class="function" href="#plot_feature_overall_stability_incremental">plot_feature_overall_stability_incremental</a>
            </li>
            <li>
                    <a class="function" href="#plot_k_n_partitions">plot_k_n_partitions</a>
            </li>
            <li>
                    <a class="function" href="#plot_k_resolution_corresp">plot_k_resolution_corresp</a>
            </li>
            <li>
                    <a class="function" href="#plot_n_neigh_ecs">plot_n_neigh_ecs</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
ClustAssessPy    </h1>

                
                        <input id="mod-ClustAssessPy-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-ClustAssessPy-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a><span class="kn">from</span> <span class="nn">ClustAssessPy.basic_functions</span> <span class="kn">import</span> <span class="n">element_sim_elscore</span><span class="p">,</span> <span class="n">element_sim</span><span class="p">,</span> <span class="n">element_sim_matrix</span><span class="p">,</span> <span class="n">element_agreement</span><span class="p">,</span> <span class="n">element_consistency</span><span class="p">,</span> <span class="n">weighted_element_consistency</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a><span class="kn">from</span> <span class="nn">ClustAssessPy.dim_reduction_assessment</span> <span class="kn">import</span> <span class="n">assess_feature_stability</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a><span class="kn">from</span> <span class="nn">ClustAssessPy.graph_clustering_assessment</span> <span class="kn">import</span> <span class="n">assess_clustering_stability</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a><span class="kn">from</span> <span class="nn">ClustAssessPy.graph_construction_assessment</span> <span class="kn">import</span> <span class="n">assess_nn_stability</span><span class="p">,</span> <span class="n">get_adjacency_matrix_wrapper</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a><span class="kn">from</span> <span class="nn">ClustAssessPy.plotting_functions</span> <span class="kn">import</span> <span class="n">plot_clustering_overall_stability</span><span class="p">,</span> <span class="n">plot_feature_overall_stability_boxplot</span><span class="p">,</span> <span class="n">plot_feature_overall_stability_incremental</span><span class="p">,</span> <span class="n">plot_k_n_partitions</span><span class="p">,</span> <span class="n">plot_k_resolution_corresp</span><span class="p">,</span> <span class="n">plot_n_neigh_ecs</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a>
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a>    <span class="s1">&#39;element_sim_elscore&#39;</span><span class="p">,</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a>    <span class="s1">&#39;element_sim&#39;</span><span class="p">,</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a>    <span class="s1">&#39;element_sim_matrix&#39;</span><span class="p">,</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a>    <span class="s1">&#39;element_agreement&#39;</span><span class="p">,</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">12</span></a>    <span class="s1">&#39;element_consistency&#39;</span><span class="p">,</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">13</span></a>    <span class="s1">&#39;weighted_element_consistency&#39;</span><span class="p">,</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">14</span></a>    <span class="s1">&#39;assess_feature_stability&#39;</span><span class="p">,</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">15</span></a>    <span class="s1">&#39;assess_clustering_stability&#39;</span><span class="p">,</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">16</span></a>    <span class="s1">&#39;assess_nn_stability&#39;</span><span class="p">,</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">17</span></a>    <span class="s1">&#39;plot_clustering_overall_stability&#39;</span><span class="p">,</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">18</span></a>    <span class="s1">&#39;plot_feature_overall_stability_boxplot&#39;</span><span class="p">,</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">19</span></a>    <span class="s1">&#39;plot_feature_overall_stability_incremental&#39;</span><span class="p">,</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">20</span></a>    <span class="s1">&#39;plot_k_n_partitions&#39;</span><span class="p">,</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">21</span></a>    <span class="s1">&#39;plot_k_resolution_corresp&#39;</span><span class="p">,</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">22</span></a>    <span class="s1">&#39;plot_n_neigh_ecs&#39;</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">23</span></a><span class="p">]</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos">25</span></a><span class="c1"># print(&quot;ClustAssessPy package loaded!!&quot;)</span>
</span></pre></div>


            </section>
                <section id="element_sim_elscore">
                            <input id="element_sim_elscore-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">element_sim_elscore</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">clustering1</span>, </span><span class="param"><span class="n">clustering2</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="element_sim_elscore-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#element_sim_elscore"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="element_sim_elscore-4"><a href="#element_sim_elscore-4"><span class="linenos"> 4</span></a><span class="k">def</span> <span class="nf">element_sim_elscore</span><span class="p">(</span><span class="n">clustering1</span><span class="p">,</span> <span class="n">clustering2</span><span class="p">):</span>
</span><span id="element_sim_elscore-5"><a href="#element_sim_elscore-5"><span class="linenos"> 5</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="element_sim_elscore-6"><a href="#element_sim_elscore-6"><span class="linenos"> 6</span></a><span class="sd">    Calculates the element-wise element-centric similarity between two clustering results.</span>
</span><span id="element_sim_elscore-7"><a href="#element_sim_elscore-7"><span class="linenos"> 7</span></a><span class="sd">    </span>
</span><span id="element_sim_elscore-8"><a href="#element_sim_elscore-8"><span class="linenos"> 8</span></a><span class="sd">    ### Args:</span>
</span><span id="element_sim_elscore-9"><a href="#element_sim_elscore-9"><span class="linenos"> 9</span></a><span class="sd">        clustering1 (array-like): The first clustering partition, where each element represents a cluster assignment.</span>
</span><span id="element_sim_elscore-10"><a href="#element_sim_elscore-10"><span class="linenos">10</span></a><span class="sd">        clustering2 (array-like): The second clustering partition to compare against &#39;clustering1&#39;.</span>
</span><span id="element_sim_elscore-11"><a href="#element_sim_elscore-11"><span class="linenos">11</span></a><span class="sd">        </span>
</span><span id="element_sim_elscore-12"><a href="#element_sim_elscore-12"><span class="linenos">12</span></a><span class="sd">    ### Returns:</span>
</span><span id="element_sim_elscore-13"><a href="#element_sim_elscore-13"><span class="linenos">13</span></a><span class="sd">        ndarray: A NumPy array of ECS values for each element in the clustering partitions. The length of this array is equal to the number of elements in the clustering partitions.</span>
</span><span id="element_sim_elscore-14"><a href="#element_sim_elscore-14"><span class="linenos">14</span></a>
</span><span id="element_sim_elscore-15"><a href="#element_sim_elscore-15"><span class="linenos">15</span></a><span class="sd">    ### Raises:</span>
</span><span id="element_sim_elscore-16"><a href="#element_sim_elscore-16"><span class="linenos">16</span></a><span class="sd">        ValueError: If &#39;clustering1&#39; and &#39;clustering2&#39; are not of the same length.</span>
</span><span id="element_sim_elscore-17"><a href="#element_sim_elscore-17"><span class="linenos">17</span></a>
</span><span id="element_sim_elscore-18"><a href="#element_sim_elscore-18"><span class="linenos">18</span></a><span class="sd">    ### Example:</span>
</span><span id="element_sim_elscore-19"><a href="#element_sim_elscore-19"><span class="linenos">19</span></a><span class="sd">    &gt;&gt;&gt; clustering1 = np.array([1, 1, 2, 2, 3])</span>
</span><span id="element_sim_elscore-20"><a href="#element_sim_elscore-20"><span class="linenos">20</span></a><span class="sd">    &gt;&gt;&gt; clustering2 = np.array([1, 2, 2, 3, 3])</span>
</span><span id="element_sim_elscore-21"><a href="#element_sim_elscore-21"><span class="linenos">21</span></a><span class="sd">    &gt;&gt;&gt; element_sim_elscore(clustering1, clustering2)</span>
</span><span id="element_sim_elscore-22"><a href="#element_sim_elscore-22"><span class="linenos">22</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="element_sim_elscore-23"><a href="#element_sim_elscore-23"><span class="linenos">23</span></a>
</span><span id="element_sim_elscore-24"><a href="#element_sim_elscore-24"><span class="linenos">24</span></a>    <span class="n">clustering1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">clustering1</span><span class="p">)</span>
</span><span id="element_sim_elscore-25"><a href="#element_sim_elscore-25"><span class="linenos">25</span></a>    <span class="n">clustering2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">clustering2</span><span class="p">)</span>
</span><span id="element_sim_elscore-26"><a href="#element_sim_elscore-26"><span class="linenos">26</span></a>
</span><span id="element_sim_elscore-27"><a href="#element_sim_elscore-27"><span class="linenos">27</span></a>    <span class="k">if</span> <span class="n">clustering1</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">clustering2</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
</span><span id="element_sim_elscore-28"><a href="#element_sim_elscore-28"><span class="linenos">28</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;clustering1 and clustering2 must have the same length&quot;</span><span class="p">)</span>
</span><span id="element_sim_elscore-29"><a href="#element_sim_elscore-29"><span class="linenos">29</span></a>
</span><span id="element_sim_elscore-30"><a href="#element_sim_elscore-30"><span class="linenos">30</span></a>    <span class="c1"># Map cluster labels to indices starting from 0</span>
</span><span id="element_sim_elscore-31"><a href="#element_sim_elscore-31"><span class="linenos">31</span></a>    <span class="n">labels_a</span><span class="p">,</span> <span class="n">inverse_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">clustering1</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="element_sim_elscore-32"><a href="#element_sim_elscore-32"><span class="linenos">32</span></a>    <span class="n">labels_b</span><span class="p">,</span> <span class="n">inverse_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">clustering2</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="element_sim_elscore-33"><a href="#element_sim_elscore-33"><span class="linenos">33</span></a>    <span class="n">n_labels_a</span> <span class="o">=</span> <span class="n">labels_a</span><span class="o">.</span><span class="n">size</span>
</span><span id="element_sim_elscore-34"><a href="#element_sim_elscore-34"><span class="linenos">34</span></a>    <span class="n">n_labels_b</span> <span class="o">=</span> <span class="n">labels_b</span><span class="o">.</span><span class="n">size</span>
</span><span id="element_sim_elscore-35"><a href="#element_sim_elscore-35"><span class="linenos">35</span></a>
</span><span id="element_sim_elscore-36"><a href="#element_sim_elscore-36"><span class="linenos">36</span></a>    <span class="c1"># Compute the contingency table C</span>
</span><span id="element_sim_elscore-37"><a href="#element_sim_elscore-37"><span class="linenos">37</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">clustering1</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="element_sim_elscore-38"><a href="#element_sim_elscore-38"><span class="linenos">38</span></a>    <span class="n">C</span> <span class="o">=</span> <span class="n">coo_matrix</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">inverse_a</span><span class="p">,</span> <span class="n">inverse_b</span><span class="p">)),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n_labels_a</span><span class="p">,</span> <span class="n">n_labels_b</span><span class="p">))</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
</span><span id="element_sim_elscore-39"><a href="#element_sim_elscore-39"><span class="linenos">39</span></a>
</span><span id="element_sim_elscore-40"><a href="#element_sim_elscore-40"><span class="linenos">40</span></a>    <span class="n">len_A_eq_ca</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Number of elements in each cluster in clustering1</span>
</span><span id="element_sim_elscore-41"><a href="#element_sim_elscore-41"><span class="linenos">41</span></a>    <span class="n">len_B_eq_cb</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Number of elements in each cluster in clustering2</span>
</span><span id="element_sim_elscore-42"><a href="#element_sim_elscore-42"><span class="linenos">42</span></a>
</span><span id="element_sim_elscore-43"><a href="#element_sim_elscore-43"><span class="linenos">43</span></a>    <span class="c1"># Compute the inverse cluster sizes, handling zero divisions</span>
</span><span id="element_sim_elscore-44"><a href="#element_sim_elscore-44"><span class="linenos">44</span></a>    <span class="n">len_A_eq_ca_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">len_A_eq_ca</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">len_A_eq_ca</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="element_sim_elscore-45"><a href="#element_sim_elscore-45"><span class="linenos">45</span></a>    <span class="n">len_B_eq_cb_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">len_B_eq_cb</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">len_B_eq_cb</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="element_sim_elscore-46"><a href="#element_sim_elscore-46"><span class="linenos">46</span></a>
</span><span id="element_sim_elscore-47"><a href="#element_sim_elscore-47"><span class="linenos">47</span></a>    <span class="c1"># Compute the absolute difference of inverse cluster sizes</span>
</span><span id="element_sim_elscore-48"><a href="#element_sim_elscore-48"><span class="linenos">48</span></a>    <span class="n">delta_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">len_A_eq_ca_inv</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">-</span> <span class="n">len_B_eq_cb_inv</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:])</span>
</span><span id="element_sim_elscore-49"><a href="#element_sim_elscore-49"><span class="linenos">49</span></a>
</span><span id="element_sim_elscore-50"><a href="#element_sim_elscore-50"><span class="linenos">50</span></a>    <span class="c1"># Compute the terms used in the ECS calculation</span>
</span><span id="element_sim_elscore-51"><a href="#element_sim_elscore-51"><span class="linenos">51</span></a>    <span class="n">term1</span> <span class="o">=</span> <span class="n">C</span> <span class="o">*</span> <span class="n">delta_inv</span>
</span><span id="element_sim_elscore-52"><a href="#element_sim_elscore-52"><span class="linenos">52</span></a>    <span class="n">term2</span> <span class="o">=</span> <span class="p">(</span><span class="n">len_A_eq_ca</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">-</span> <span class="n">C</span><span class="p">)</span> <span class="o">*</span> <span class="n">len_A_eq_ca_inv</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="element_sim_elscore-53"><a href="#element_sim_elscore-53"><span class="linenos">53</span></a>    <span class="n">term3</span> <span class="o">=</span> <span class="p">(</span><span class="n">len_B_eq_cb</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">C</span><span class="p">)</span> <span class="o">*</span> <span class="n">len_B_eq_cb_inv</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="element_sim_elscore-54"><a href="#element_sim_elscore-54"><span class="linenos">54</span></a>
</span><span id="element_sim_elscore-55"><a href="#element_sim_elscore-55"><span class="linenos">55</span></a>    <span class="c1"># Compute the ECS score matrix</span>
</span><span id="element_sim_elscore-56"><a href="#element_sim_elscore-56"><span class="linenos">56</span></a>    <span class="n">score_matrix</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">term1</span> <span class="o">+</span> <span class="n">term2</span> <span class="o">+</span> <span class="n">term3</span><span class="p">)</span>
</span><span id="element_sim_elscore-57"><a href="#element_sim_elscore-57"><span class="linenos">57</span></a>    <span class="n">score_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">score_matrix</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="element_sim_elscore-58"><a href="#element_sim_elscore-58"><span class="linenos">58</span></a>
</span><span id="element_sim_elscore-59"><a href="#element_sim_elscore-59"><span class="linenos">59</span></a>    <span class="c1"># Assign ECS values to each element based on their cluster assignments</span>
</span><span id="element_sim_elscore-60"><a href="#element_sim_elscore-60"><span class="linenos">60</span></a>    <span class="n">ecs_element_values</span> <span class="o">=</span> <span class="n">score_matrix</span><span class="p">[</span><span class="n">inverse_a</span><span class="p">,</span> <span class="n">inverse_b</span><span class="p">]</span>
</span><span id="element_sim_elscore-61"><a href="#element_sim_elscore-61"><span class="linenos">61</span></a>
</span><span id="element_sim_elscore-62"><a href="#element_sim_elscore-62"><span class="linenos">62</span></a>    <span class="k">return</span> <span class="n">ecs_element_values</span>
</span></pre></div>


            <div class="docstring"><p>Calculates the element-wise element-centric similarity between two clustering results.</p>

<h3 id="args">Args:</h3>

<pre><code>clustering1 (array-like): The first clustering partition, where each element represents a cluster assignment.
clustering2 (array-like): The second clustering partition to compare against 'clustering1'.
</code></pre>

<h3 id="returns">Returns:</h3>

<pre><code>ndarray: A NumPy array of ECS values for each element in the clustering partitions. The length of this array is equal to the number of elements in the clustering partitions.
</code></pre>

<h3 id="raises">Raises:</h3>

<pre><code>ValueError: If 'clustering1' and 'clustering2' are not of the same length.
</code></pre>

<h3 id="example">Example:</h3>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">clustering1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">clustering2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">element_sim_elscore</span><span class="p">(</span><span class="n">clustering1</span><span class="p">,</span> <span class="n">clustering2</span><span class="p">)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="element_sim">
                            <input id="element_sim-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">element_sim</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">clustering1</span>, </span><span class="param"><span class="n">clustering2</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="element_sim-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#element_sim"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="element_sim-64"><a href="#element_sim-64"><span class="linenos">64</span></a><span class="k">def</span> <span class="nf">element_sim</span><span class="p">(</span><span class="n">clustering1</span><span class="p">,</span> <span class="n">clustering2</span><span class="p">):</span>
</span><span id="element_sim-65"><a href="#element_sim-65"><span class="linenos">65</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="element_sim-66"><a href="#element_sim-66"><span class="linenos">66</span></a><span class="sd">    Calculate the average element-centric similarity between two clustering results</span>
</span><span id="element_sim-67"><a href="#element_sim-67"><span class="linenos">67</span></a>
</span><span id="element_sim-68"><a href="#element_sim-68"><span class="linenos">68</span></a><span class="sd">    ### Args:</span>
</span><span id="element_sim-69"><a href="#element_sim-69"><span class="linenos">69</span></a><span class="sd">        clustering1 (array-like): The first clustering partition, where each element represents a cluster assignment.</span>
</span><span id="element_sim-70"><a href="#element_sim-70"><span class="linenos">70</span></a><span class="sd">        clustering2 (array-like): The second clustering partition to compare against &#39;clustering1&#39;.</span>
</span><span id="element_sim-71"><a href="#element_sim-71"><span class="linenos">71</span></a><span class="sd">        </span>
</span><span id="element_sim-72"><a href="#element_sim-72"><span class="linenos">72</span></a><span class="sd">    ### Returns:</span>
</span><span id="element_sim-73"><a href="#element_sim-73"><span class="linenos">73</span></a><span class="sd">        float: The average ECS value for all elements across the two clustering partitions.</span>
</span><span id="element_sim-74"><a href="#element_sim-74"><span class="linenos">74</span></a>
</span><span id="element_sim-75"><a href="#element_sim-75"><span class="linenos">75</span></a><span class="sd">    ### Raises:</span>
</span><span id="element_sim-76"><a href="#element_sim-76"><span class="linenos">76</span></a><span class="sd">        ValueError: If &#39;clustering1&#39; and &#39;clustering2&#39; are not of the same length or if they are not appropriate vector types (i.e., NumPy arrays, lists, or tuples).</span>
</span><span id="element_sim-77"><a href="#element_sim-77"><span class="linenos">77</span></a>
</span><span id="element_sim-78"><a href="#element_sim-78"><span class="linenos">78</span></a><span class="sd">    ### Example:</span>
</span><span id="element_sim-79"><a href="#element_sim-79"><span class="linenos">79</span></a><span class="sd">    &gt;&gt;&gt; clustering1 = np.array([1, 1, 2, 2, 3])</span>
</span><span id="element_sim-80"><a href="#element_sim-80"><span class="linenos">80</span></a><span class="sd">    &gt;&gt;&gt; clustering2 = np.array([1, 2, 2, 3, 3])</span>
</span><span id="element_sim-81"><a href="#element_sim-81"><span class="linenos">81</span></a><span class="sd">    &gt;&gt;&gt; element_sim(clustering1, clustering2)</span>
</span><span id="element_sim-82"><a href="#element_sim-82"><span class="linenos">82</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="element_sim-83"><a href="#element_sim-83"><span class="linenos">83</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">element_sim_elscore</span><span class="p">(</span><span class="n">clustering1</span><span class="p">,</span> <span class="n">clustering2</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Calculate the average element-centric similarity between two clustering results</p>

<h3 id="args">Args:</h3>

<pre><code>clustering1 (array-like): The first clustering partition, where each element represents a cluster assignment.
clustering2 (array-like): The second clustering partition to compare against 'clustering1'.
</code></pre>

<h3 id="returns">Returns:</h3>

<pre><code>float: The average ECS value for all elements across the two clustering partitions.
</code></pre>

<h3 id="raises">Raises:</h3>

<pre><code>ValueError: If 'clustering1' and 'clustering2' are not of the same length or if they are not appropriate vector types (i.e., NumPy arrays, lists, or tuples).
</code></pre>

<h3 id="example">Example:</h3>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">clustering1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">clustering2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">element_sim</span><span class="p">(</span><span class="n">clustering1</span><span class="p">,</span> <span class="n">clustering2</span><span class="p">)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="element_sim_matrix">
                            <input id="element_sim_matrix-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">element_sim_matrix</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">clustering_list</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="element_sim_matrix-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#element_sim_matrix"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="element_sim_matrix-189"><a href="#element_sim_matrix-189"><span class="linenos">189</span></a><span class="k">def</span> <span class="nf">element_sim_matrix</span><span class="p">(</span><span class="n">clustering_list</span><span class="p">):</span>
</span><span id="element_sim_matrix-190"><a href="#element_sim_matrix-190"><span class="linenos">190</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="element_sim_matrix-191"><a href="#element_sim_matrix-191"><span class="linenos">191</span></a><span class="sd">    Compare a set of clusterings by calculating their pairwise average element-centric clustering similarities.</span>
</span><span id="element_sim_matrix-192"><a href="#element_sim_matrix-192"><span class="linenos">192</span></a>
</span><span id="element_sim_matrix-193"><a href="#element_sim_matrix-193"><span class="linenos">193</span></a><span class="sd">    Optimized to avoid redundant computations and utilize vectorized operations.</span>
</span><span id="element_sim_matrix-194"><a href="#element_sim_matrix-194"><span class="linenos">194</span></a>
</span><span id="element_sim_matrix-195"><a href="#element_sim_matrix-195"><span class="linenos">195</span></a><span class="sd">    ### Args:</span>
</span><span id="element_sim_matrix-196"><a href="#element_sim_matrix-196"><span class="linenos">196</span></a><span class="sd">        clustering_list (list of array-like): A list where each element is a clustering partition represented as an array-like structure (e.g., lists, NumPy arrays). Each clustering partition should have the same length, with each element representing a cluster assignment.</span>
</span><span id="element_sim_matrix-197"><a href="#element_sim_matrix-197"><span class="linenos">197</span></a>
</span><span id="element_sim_matrix-198"><a href="#element_sim_matrix-198"><span class="linenos">198</span></a><span class="sd">    ### Returns:</span>
</span><span id="element_sim_matrix-199"><a href="#element_sim_matrix-199"><span class="linenos">199</span></a><span class="sd">        ndarray: A NumPy matrix containing the pairwise ECS values.</span>
</span><span id="element_sim_matrix-200"><a href="#element_sim_matrix-200"><span class="linenos">200</span></a>
</span><span id="element_sim_matrix-201"><a href="#element_sim_matrix-201"><span class="linenos">201</span></a><span class="sd">    ### Raises:</span>
</span><span id="element_sim_matrix-202"><a href="#element_sim_matrix-202"><span class="linenos">202</span></a><span class="sd">        ValueError: If elements of the &#39;clustering_list&#39; are not of the same length or if they are not appropriate array-like structures.</span>
</span><span id="element_sim_matrix-203"><a href="#element_sim_matrix-203"><span class="linenos">203</span></a>
</span><span id="element_sim_matrix-204"><a href="#element_sim_matrix-204"><span class="linenos">204</span></a><span class="sd">    ### Example:</span>
</span><span id="element_sim_matrix-205"><a href="#element_sim_matrix-205"><span class="linenos">205</span></a><span class="sd">    &gt;&gt;&gt; clustering_list = [np.array([1, 1, 2]), np.array([1, 2, 2]), np.array([2, 2, 1])]</span>
</span><span id="element_sim_matrix-206"><a href="#element_sim_matrix-206"><span class="linenos">206</span></a><span class="sd">    &gt;&gt;&gt; element_sim_matrix(clustering_list)</span>
</span><span id="element_sim_matrix-207"><a href="#element_sim_matrix-207"><span class="linenos">207</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="element_sim_matrix-208"><a href="#element_sim_matrix-208"><span class="linenos">208</span></a>
</span><span id="element_sim_matrix-209"><a href="#element_sim_matrix-209"><span class="linenos">209</span></a>    <span class="c1"># Precompute data for all clusterings</span>
</span><span id="element_sim_matrix-210"><a href="#element_sim_matrix-210"><span class="linenos">210</span></a>    <span class="n">clustering_data</span> <span class="o">=</span> <span class="n">_precompute_clustering_data</span><span class="p">(</span><span class="n">clustering_list</span><span class="p">)</span>
</span><span id="element_sim_matrix-211"><a href="#element_sim_matrix-211"><span class="linenos">211</span></a>    <span class="n">num_clusterings</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">clustering_data</span><span class="p">)</span>
</span><span id="element_sim_matrix-212"><a href="#element_sim_matrix-212"><span class="linenos">212</span></a>    <span class="n">sim_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">num_clusterings</span><span class="p">,</span> <span class="n">num_clusterings</span><span class="p">))</span>  <span class="c1"># Diagonal elements are 1</span>
</span><span id="element_sim_matrix-213"><a href="#element_sim_matrix-213"><span class="linenos">213</span></a>
</span><span id="element_sim_matrix-214"><a href="#element_sim_matrix-214"><span class="linenos">214</span></a>    <span class="c1"># Generate upper triangle indices (excluding diagonal)</span>
</span><span id="element_sim_matrix-215"><a href="#element_sim_matrix-215"><span class="linenos">215</span></a>    <span class="n">indices_i</span><span class="p">,</span> <span class="n">indices_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu_indices</span><span class="p">(</span><span class="n">num_clusterings</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="element_sim_matrix-216"><a href="#element_sim_matrix-216"><span class="linenos">216</span></a>
</span><span id="element_sim_matrix-217"><a href="#element_sim_matrix-217"><span class="linenos">217</span></a>    <span class="c1"># Compute pairwise similarities</span>
</span><span id="element_sim_matrix-218"><a href="#element_sim_matrix-218"><span class="linenos">218</span></a>    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indices_i</span><span class="p">)):</span>
</span><span id="element_sim_matrix-219"><a href="#element_sim_matrix-219"><span class="linenos">219</span></a>        <span class="n">i</span> <span class="o">=</span> <span class="n">indices_i</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="element_sim_matrix-220"><a href="#element_sim_matrix-220"><span class="linenos">220</span></a>        <span class="n">j</span> <span class="o">=</span> <span class="n">indices_j</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="element_sim_matrix-221"><a href="#element_sim_matrix-221"><span class="linenos">221</span></a>        <span class="n">sim_score</span> <span class="o">=</span> <span class="n">_element_sim_with_precomputed</span><span class="p">(</span><span class="n">clustering_data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">clustering_data</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</span><span id="element_sim_matrix-222"><a href="#element_sim_matrix-222"><span class="linenos">222</span></a>        <span class="n">sim_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">sim_score</span>
</span><span id="element_sim_matrix-223"><a href="#element_sim_matrix-223"><span class="linenos">223</span></a>        <span class="n">sim_matrix</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sim_score</span>  <span class="c1"># Symmetric matrix</span>
</span><span id="element_sim_matrix-224"><a href="#element_sim_matrix-224"><span class="linenos">224</span></a>
</span><span id="element_sim_matrix-225"><a href="#element_sim_matrix-225"><span class="linenos">225</span></a>    <span class="k">return</span> <span class="n">sim_matrix</span>
</span></pre></div>


            <div class="docstring"><p>Compare a set of clusterings by calculating their pairwise average element-centric clustering similarities.</p>

<p>Optimized to avoid redundant computations and utilize vectorized operations.</p>

<h3 id="args">Args:</h3>

<pre><code>clustering_list (list of array-like): A list where each element is a clustering partition represented as an array-like structure (e.g., lists, NumPy arrays). Each clustering partition should have the same length, with each element representing a cluster assignment.
</code></pre>

<h3 id="returns">Returns:</h3>

<pre><code>ndarray: A NumPy matrix containing the pairwise ECS values.
</code></pre>

<h3 id="raises">Raises:</h3>

<pre><code>ValueError: If elements of the 'clustering_list' are not of the same length or if they are not appropriate array-like structures.
</code></pre>

<h3 id="example">Example:</h3>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">clustering_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">element_sim_matrix</span><span class="p">(</span><span class="n">clustering_list</span><span class="p">)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="element_agreement">
                            <input id="element_agreement-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">element_agreement</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">reference_clustering</span>, </span><span class="param"><span class="n">clustering_list</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="element_agreement-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#element_agreement"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="element_agreement-85"><a href="#element_agreement-85"><span class="linenos"> 85</span></a><span class="k">def</span> <span class="nf">element_agreement</span><span class="p">(</span><span class="n">reference_clustering</span><span class="p">,</span> <span class="n">clustering_list</span><span class="p">):</span>
</span><span id="element_agreement-86"><a href="#element_agreement-86"><span class="linenos"> 86</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="element_agreement-87"><a href="#element_agreement-87"><span class="linenos"> 87</span></a><span class="sd">    Inspect how consistently a set of clusterings agree with a reference clustering by calculating their element-wise average agreement.</span>
</span><span id="element_agreement-88"><a href="#element_agreement-88"><span class="linenos"> 88</span></a>
</span><span id="element_agreement-89"><a href="#element_agreement-89"><span class="linenos"> 89</span></a><span class="sd">    Optimized using precomputed data.</span>
</span><span id="element_agreement-90"><a href="#element_agreement-90"><span class="linenos"> 90</span></a>
</span><span id="element_agreement-91"><a href="#element_agreement-91"><span class="linenos"> 91</span></a><span class="sd">    ### Args:</span>
</span><span id="element_agreement-92"><a href="#element_agreement-92"><span class="linenos"> 92</span></a><span class="sd">        reference_clustering (array-like): The reference clustering, that each clustering in clustering_list is compared to</span>
</span><span id="element_agreement-93"><a href="#element_agreement-93"><span class="linenos"> 93</span></a><span class="sd">        clustering_list (list of array-like): A list where each element is a clustering partition represented as an array-like structure (e.g., lists, NumPy arrays).</span>
</span><span id="element_agreement-94"><a href="#element_agreement-94"><span class="linenos"> 94</span></a><span class="sd">        </span>
</span><span id="element_agreement-95"><a href="#element_agreement-95"><span class="linenos"> 95</span></a><span class="sd">    ### Returns:</span>
</span><span id="element_agreement-96"><a href="#element_agreement-96"><span class="linenos"> 96</span></a><span class="sd">        ndarray: A vector containing the element-wise average agreement.</span>
</span><span id="element_agreement-97"><a href="#element_agreement-97"><span class="linenos"> 97</span></a>
</span><span id="element_agreement-98"><a href="#element_agreement-98"><span class="linenos"> 98</span></a><span class="sd">    ### Raises:</span>
</span><span id="element_agreement-99"><a href="#element_agreement-99"><span class="linenos"> 99</span></a><span class="sd">        ValueError: If any of the clusterings in the clustering_list are not of the same length as reference_clustering or if they are not appropriate array-like structures.</span>
</span><span id="element_agreement-100"><a href="#element_agreement-100"><span class="linenos">100</span></a>
</span><span id="element_agreement-101"><a href="#element_agreement-101"><span class="linenos">101</span></a><span class="sd">    ### Example:</span>
</span><span id="element_agreement-102"><a href="#element_agreement-102"><span class="linenos">102</span></a><span class="sd">    &gt;&gt;&gt; reference_clustering = np.array([1, 1, 2])</span>
</span><span id="element_agreement-103"><a href="#element_agreement-103"><span class="linenos">103</span></a><span class="sd">    &gt;&gt;&gt; clustering_list = [np.array([1, 1, 2]), np.array([1, 2, 2]), np.array([2, 2, 1])]</span>
</span><span id="element_agreement-104"><a href="#element_agreement-104"><span class="linenos">104</span></a><span class="sd">    &gt;&gt;&gt; element_agreement(reference_clustering, clustering_list)</span>
</span><span id="element_agreement-105"><a href="#element_agreement-105"><span class="linenos">105</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="element_agreement-106"><a href="#element_agreement-106"><span class="linenos">106</span></a>    <span class="n">reference_clustering</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">reference_clustering</span><span class="p">)</span>
</span><span id="element_agreement-107"><a href="#element_agreement-107"><span class="linenos">107</span></a>    <span class="n">num_elements</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">reference_clustering</span><span class="p">)</span>
</span><span id="element_agreement-108"><a href="#element_agreement-108"><span class="linenos">108</span></a>    <span class="n">num_clusterings</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">clustering_list</span><span class="p">)</span>
</span><span id="element_agreement-109"><a href="#element_agreement-109"><span class="linenos">109</span></a>
</span><span id="element_agreement-110"><a href="#element_agreement-110"><span class="linenos">110</span></a>    <span class="c1"># Precompute data for the reference clustering</span>
</span><span id="element_agreement-111"><a href="#element_agreement-111"><span class="linenos">111</span></a>    <span class="n">labels_ref</span><span class="p">,</span> <span class="n">inverse_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">reference_clustering</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="element_agreement-112"><a href="#element_agreement-112"><span class="linenos">112</span></a>    <span class="n">data_ref</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="element_agreement-113"><a href="#element_agreement-113"><span class="linenos">113</span></a>        <span class="s1">&#39;clustering&#39;</span><span class="p">:</span> <span class="n">reference_clustering</span><span class="p">,</span>
</span><span id="element_agreement-114"><a href="#element_agreement-114"><span class="linenos">114</span></a>        <span class="s1">&#39;labels&#39;</span><span class="p">:</span> <span class="n">labels_ref</span><span class="p">,</span>
</span><span id="element_agreement-115"><a href="#element_agreement-115"><span class="linenos">115</span></a>        <span class="s1">&#39;inverse&#39;</span><span class="p">:</span> <span class="n">inverse_ref</span>
</span><span id="element_agreement-116"><a href="#element_agreement-116"><span class="linenos">116</span></a>    <span class="p">}</span>
</span><span id="element_agreement-117"><a href="#element_agreement-117"><span class="linenos">117</span></a>
</span><span id="element_agreement-118"><a href="#element_agreement-118"><span class="linenos">118</span></a>    <span class="c1"># Initialize ECS accumulator</span>
</span><span id="element_agreement-119"><a href="#element_agreement-119"><span class="linenos">119</span></a>    <span class="n">ecs_element_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_elements</span><span class="p">)</span>
</span><span id="element_agreement-120"><a href="#element_agreement-120"><span class="linenos">120</span></a>
</span><span id="element_agreement-121"><a href="#element_agreement-121"><span class="linenos">121</span></a>    <span class="c1"># Compute ECS values for each clustering</span>
</span><span id="element_agreement-122"><a href="#element_agreement-122"><span class="linenos">122</span></a>    <span class="k">for</span> <span class="n">clustering</span> <span class="ow">in</span> <span class="n">clustering_list</span><span class="p">:</span>
</span><span id="element_agreement-123"><a href="#element_agreement-123"><span class="linenos">123</span></a>        <span class="n">clustering</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">clustering</span><span class="p">)</span>
</span><span id="element_agreement-124"><a href="#element_agreement-124"><span class="linenos">124</span></a>        <span class="n">labels</span><span class="p">,</span> <span class="n">inverse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">clustering</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="element_agreement-125"><a href="#element_agreement-125"><span class="linenos">125</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="element_agreement-126"><a href="#element_agreement-126"><span class="linenos">126</span></a>            <span class="s1">&#39;clustering&#39;</span><span class="p">:</span> <span class="n">clustering</span><span class="p">,</span>
</span><span id="element_agreement-127"><a href="#element_agreement-127"><span class="linenos">127</span></a>            <span class="s1">&#39;labels&#39;</span><span class="p">:</span> <span class="n">labels</span><span class="p">,</span>
</span><span id="element_agreement-128"><a href="#element_agreement-128"><span class="linenos">128</span></a>            <span class="s1">&#39;inverse&#39;</span><span class="p">:</span> <span class="n">inverse</span>
</span><span id="element_agreement-129"><a href="#element_agreement-129"><span class="linenos">129</span></a>        <span class="p">}</span>
</span><span id="element_agreement-130"><a href="#element_agreement-130"><span class="linenos">130</span></a>        <span class="n">ecs_values</span> <span class="o">=</span> <span class="n">_element_sim_elscore_with_precomputed</span><span class="p">(</span><span class="n">data_ref</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="element_agreement-131"><a href="#element_agreement-131"><span class="linenos">131</span></a>        <span class="n">ecs_element_values</span> <span class="o">+=</span> <span class="n">ecs_values</span>
</span><span id="element_agreement-132"><a href="#element_agreement-132"><span class="linenos">132</span></a>
</span><span id="element_agreement-133"><a href="#element_agreement-133"><span class="linenos">133</span></a>    <span class="c1"># Compute average ECS values</span>
</span><span id="element_agreement-134"><a href="#element_agreement-134"><span class="linenos">134</span></a>    <span class="n">ecs_element_values</span> <span class="o">/=</span> <span class="n">num_clusterings</span>
</span><span id="element_agreement-135"><a href="#element_agreement-135"><span class="linenos">135</span></a>
</span><span id="element_agreement-136"><a href="#element_agreement-136"><span class="linenos">136</span></a>    <span class="k">return</span> <span class="n">ecs_element_values</span>
</span></pre></div>


            <div class="docstring"><p>Inspect how consistently a set of clusterings agree with a reference clustering by calculating their element-wise average agreement.</p>

<p>Optimized using precomputed data.</p>

<h3 id="args">Args:</h3>

<pre><code>reference_clustering (array-like): The reference clustering, that each clustering in clustering_list is compared to
clustering_list (list of array-like): A list where each element is a clustering partition represented as an array-like structure (e.g., lists, NumPy arrays).
</code></pre>

<h3 id="returns">Returns:</h3>

<pre><code>ndarray: A vector containing the element-wise average agreement.
</code></pre>

<h3 id="raises">Raises:</h3>

<pre><code>ValueError: If any of the clusterings in the clustering_list are not of the same length as reference_clustering or if they are not appropriate array-like structures.
</code></pre>

<h3 id="example">Example:</h3>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">reference_clustering</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">clustering_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">element_agreement</span><span class="p">(</span><span class="n">reference_clustering</span><span class="p">,</span> <span class="n">clustering_list</span><span class="p">)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="element_consistency">
                            <input id="element_consistency-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">element_consistency</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">clustering_list</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="element_consistency-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#element_consistency"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="element_consistency-138"><a href="#element_consistency-138"><span class="linenos">138</span></a><span class="k">def</span> <span class="nf">element_consistency</span><span class="p">(</span><span class="n">clustering_list</span><span class="p">):</span>
</span><span id="element_consistency-139"><a href="#element_consistency-139"><span class="linenos">139</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="element_consistency-140"><a href="#element_consistency-140"><span class="linenos">140</span></a><span class="sd">    Inspects the consistency of a set of clusterings by calculating their element-wise clustering consistency.</span>
</span><span id="element_consistency-141"><a href="#element_consistency-141"><span class="linenos">141</span></a>
</span><span id="element_consistency-142"><a href="#element_consistency-142"><span class="linenos">142</span></a><span class="sd">    Optimized version using precomputed data and efficient looping.</span>
</span><span id="element_consistency-143"><a href="#element_consistency-143"><span class="linenos">143</span></a>
</span><span id="element_consistency-144"><a href="#element_consistency-144"><span class="linenos">144</span></a><span class="sd">    ### Args:</span>
</span><span id="element_consistency-145"><a href="#element_consistency-145"><span class="linenos">145</span></a><span class="sd">        clustering_list (list of array-like): A list where each element is a clustering partition represented as an array-like structure (e.g., lists, NumPy arrays). Each clustering partition should have the same length, with each element representing a cluster assignment.</span>
</span><span id="element_consistency-146"><a href="#element_consistency-146"><span class="linenos">146</span></a>
</span><span id="element_consistency-147"><a href="#element_consistency-147"><span class="linenos">147</span></a><span class="sd">    ### Returns:</span>
</span><span id="element_consistency-148"><a href="#element_consistency-148"><span class="linenos">148</span></a><span class="sd">        ndarray: A NumPy array of average consistency scores for each element in the clustering partitions.</span>
</span><span id="element_consistency-149"><a href="#element_consistency-149"><span class="linenos">149</span></a><span class="sd">        The length of this array is equal to the number of elements in the individual clustering partitions.</span>
</span><span id="element_consistency-150"><a href="#element_consistency-150"><span class="linenos">150</span></a>
</span><span id="element_consistency-151"><a href="#element_consistency-151"><span class="linenos">151</span></a><span class="sd">    ### Raises:</span>
</span><span id="element_consistency-152"><a href="#element_consistency-152"><span class="linenos">152</span></a><span class="sd">        ValueError: If elements of the &#39;clustering_list&#39; are not of the same length or if they are not appropriate array-like structures.</span>
</span><span id="element_consistency-153"><a href="#element_consistency-153"><span class="linenos">153</span></a>
</span><span id="element_consistency-154"><a href="#element_consistency-154"><span class="linenos">154</span></a><span class="sd">    ### Example:</span>
</span><span id="element_consistency-155"><a href="#element_consistency-155"><span class="linenos">155</span></a><span class="sd">        &gt;&gt;&gt; import numpy as np</span>
</span><span id="element_consistency-156"><a href="#element_consistency-156"><span class="linenos">156</span></a><span class="sd">        &gt;&gt;&gt; clustering_list = [np.array([1, 1, 2]), np.array([1, 2, 2]), np.array([2, 2, 1])]</span>
</span><span id="element_consistency-157"><a href="#element_consistency-157"><span class="linenos">157</span></a><span class="sd">        &gt;&gt;&gt; ecs_values = element_consistency(clustering_list)</span>
</span><span id="element_consistency-158"><a href="#element_consistency-158"><span class="linenos">158</span></a><span class="sd">        &gt;&gt;&gt; print(ecs_values)</span>
</span><span id="element_consistency-159"><a href="#element_consistency-159"><span class="linenos">159</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="element_consistency-160"><a href="#element_consistency-160"><span class="linenos">160</span></a>
</span><span id="element_consistency-161"><a href="#element_consistency-161"><span class="linenos">161</span></a>    <span class="c1"># Precompute data for each clustering</span>
</span><span id="element_consistency-162"><a href="#element_consistency-162"><span class="linenos">162</span></a>    <span class="n">clustering_data</span> <span class="o">=</span> <span class="n">_precompute_clustering_data</span><span class="p">(</span><span class="n">clustering_list</span><span class="p">)</span>
</span><span id="element_consistency-163"><a href="#element_consistency-163"><span class="linenos">163</span></a>    <span class="n">num_clusterings</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">clustering_data</span><span class="p">)</span>
</span><span id="element_consistency-164"><a href="#element_consistency-164"><span class="linenos">164</span></a>    <span class="n">num_elements</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">clustering_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;clustering&#39;</span><span class="p">])</span>
</span><span id="element_consistency-165"><a href="#element_consistency-165"><span class="linenos">165</span></a>
</span><span id="element_consistency-166"><a href="#element_consistency-166"><span class="linenos">166</span></a>    <span class="c1"># Check that all clusterings have the same length</span>
</span><span id="element_consistency-167"><a href="#element_consistency-167"><span class="linenos">167</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;clustering&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="n">num_elements</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">clustering_data</span><span class="p">):</span>
</span><span id="element_consistency-168"><a href="#element_consistency-168"><span class="linenos">168</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All clusterings must have the same number of elements&quot;</span><span class="p">)</span>
</span><span id="element_consistency-169"><a href="#element_consistency-169"><span class="linenos">169</span></a>
</span><span id="element_consistency-170"><a href="#element_consistency-170"><span class="linenos">170</span></a>    <span class="n">ecs_element_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_elements</span><span class="p">)</span>
</span><span id="element_consistency-171"><a href="#element_consistency-171"><span class="linenos">171</span></a>    <span class="n">num_pairs</span> <span class="o">=</span> <span class="n">num_clusterings</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_clusterings</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="element_consistency-172"><a href="#element_consistency-172"><span class="linenos">172</span></a>
</span><span id="element_consistency-173"><a href="#element_consistency-173"><span class="linenos">173</span></a>    <span class="c1"># Generate all unique pairs of indices</span>
</span><span id="element_consistency-174"><a href="#element_consistency-174"><span class="linenos">174</span></a>    <span class="n">indices_i</span><span class="p">,</span> <span class="n">indices_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu_indices</span><span class="p">(</span><span class="n">num_clusterings</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="element_consistency-175"><a href="#element_consistency-175"><span class="linenos">175</span></a>
</span><span id="element_consistency-176"><a href="#element_consistency-176"><span class="linenos">176</span></a>    <span class="c1"># Loop over pairs using precomputed data</span>
</span><span id="element_consistency-177"><a href="#element_consistency-177"><span class="linenos">177</span></a>    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indices_i</span><span class="p">)):</span>
</span><span id="element_consistency-178"><a href="#element_consistency-178"><span class="linenos">178</span></a>        <span class="n">i</span> <span class="o">=</span> <span class="n">indices_i</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="element_consistency-179"><a href="#element_consistency-179"><span class="linenos">179</span></a>        <span class="n">j</span> <span class="o">=</span> <span class="n">indices_j</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="element_consistency-180"><a href="#element_consistency-180"><span class="linenos">180</span></a>        <span class="n">ecs_element_values</span> <span class="o">+=</span> <span class="n">_element_sim_elscore_with_precomputed</span><span class="p">(</span>
</span><span id="element_consistency-181"><a href="#element_consistency-181"><span class="linenos">181</span></a>            <span class="n">clustering_data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">clustering_data</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span><span id="element_consistency-182"><a href="#element_consistency-182"><span class="linenos">182</span></a>        <span class="p">)</span>
</span><span id="element_consistency-183"><a href="#element_consistency-183"><span class="linenos">183</span></a>
</span><span id="element_consistency-184"><a href="#element_consistency-184"><span class="linenos">184</span></a>    <span class="c1"># Compute the average ECS values</span>
</span><span id="element_consistency-185"><a href="#element_consistency-185"><span class="linenos">185</span></a>    <span class="n">ecs_element_values</span> <span class="o">/=</span> <span class="n">num_pairs</span>
</span><span id="element_consistency-186"><a href="#element_consistency-186"><span class="linenos">186</span></a>
</span><span id="element_consistency-187"><a href="#element_consistency-187"><span class="linenos">187</span></a>    <span class="k">return</span> <span class="n">ecs_element_values</span>
</span></pre></div>


            <div class="docstring"><p>Inspects the consistency of a set of clusterings by calculating their element-wise clustering consistency.</p>

<p>Optimized version using precomputed data and efficient looping.</p>

<h3 id="args">Args:</h3>

<pre><code>clustering_list (list of array-like): A list where each element is a clustering partition represented as an array-like structure (e.g., lists, NumPy arrays). Each clustering partition should have the same length, with each element representing a cluster assignment.
</code></pre>

<h3 id="returns">Returns:</h3>

<pre><code>ndarray: A NumPy array of average consistency scores for each element in the clustering partitions.
The length of this array is equal to the number of elements in the individual clustering partitions.
</code></pre>

<h3 id="raises">Raises:</h3>

<pre><code>ValueError: If elements of the 'clustering_list' are not of the same length or if they are not appropriate array-like structures.
</code></pre>

<h3 id="example">Example:</h3>

<pre><code>&gt;&gt;&gt; import numpy as np
&gt;&gt;&gt; clustering_list = [np.array([1, 1, 2]), np.array([1, 2, 2]), np.array([2, 2, 1])]
&gt;&gt;&gt; ecs_values = element_consistency(clustering_list)
&gt;&gt;&gt; print(ecs_values)
</code></pre>
</div>


                </section>
                <section id="weighted_element_consistency">
                            <input id="weighted_element_consistency-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">weighted_element_consistency</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">clustering_list</span>, </span><span class="param"><span class="n">weights</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">calculate_sim_matrix</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="weighted_element_consistency-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#weighted_element_consistency"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="weighted_element_consistency-227"><a href="#weighted_element_consistency-227"><span class="linenos">227</span></a><span class="k">def</span> <span class="nf">weighted_element_consistency</span><span class="p">(</span><span class="n">clustering_list</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">calculate_sim_matrix</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="weighted_element_consistency-228"><a href="#weighted_element_consistency-228"><span class="linenos">228</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="weighted_element_consistency-229"><a href="#weighted_element_consistency-229"><span class="linenos">229</span></a><span class="sd">    Calculate the weighted element-wise consistency of a set of clusterings.</span>
</span><span id="weighted_element_consistency-230"><a href="#weighted_element_consistency-230"><span class="linenos">230</span></a>
</span><span id="weighted_element_consistency-231"><a href="#weighted_element_consistency-231"><span class="linenos">231</span></a><span class="sd">    This function computes per-element weighted consistency scores, aligning with the old implementation.</span>
</span><span id="weighted_element_consistency-232"><a href="#weighted_element_consistency-232"><span class="linenos">232</span></a>
</span><span id="weighted_element_consistency-233"><a href="#weighted_element_consistency-233"><span class="linenos">233</span></a><span class="sd">    ### Args:</span>
</span><span id="weighted_element_consistency-234"><a href="#weighted_element_consistency-234"><span class="linenos">234</span></a><span class="sd">        clustering_list (list of array-like): A list where each element is a clustering partition.</span>
</span><span id="weighted_element_consistency-235"><a href="#weighted_element_consistency-235"><span class="linenos">235</span></a><span class="sd">        weights (list of float, optional): A list of weights corresponding to each clustering in &#39;clustering_list&#39;.</span>
</span><span id="weighted_element_consistency-236"><a href="#weighted_element_consistency-236"><span class="linenos">236</span></a><span class="sd">        calculate_sim_matrix (bool, optional): Whether to return the similarity matrix.</span>
</span><span id="weighted_element_consistency-237"><a href="#weighted_element_consistency-237"><span class="linenos">237</span></a>
</span><span id="weighted_element_consistency-238"><a href="#weighted_element_consistency-238"><span class="linenos">238</span></a><span class="sd">    ### Returns:</span>
</span><span id="weighted_element_consistency-239"><a href="#weighted_element_consistency-239"><span class="linenos">239</span></a><span class="sd">        ndarray: An array of per-element weighted consistency scores.</span>
</span><span id="weighted_element_consistency-240"><a href="#weighted_element_consistency-240"><span class="linenos">240</span></a><span class="sd">        (optional) ndarray: Similarity matrix if calculate_sim_matrix is True.</span>
</span><span id="weighted_element_consistency-241"><a href="#weighted_element_consistency-241"><span class="linenos">241</span></a>
</span><span id="weighted_element_consistency-242"><a href="#weighted_element_consistency-242"><span class="linenos">242</span></a><span class="sd">    ### Example:</span>
</span><span id="weighted_element_consistency-243"><a href="#weighted_element_consistency-243"><span class="linenos">243</span></a><span class="sd">        &gt;&gt;&gt; clustering_list = [np.array([1, 1, 2]), np.array([1, 2, 2]), np.array([2, 2, 1])]</span>
</span><span id="weighted_element_consistency-244"><a href="#weighted_element_consistency-244"><span class="linenos">244</span></a><span class="sd">        &gt;&gt;&gt; weighted_ecc = weighted_element_consistency(clustering_list, weights=[1, 0.5, 0.5])</span>
</span><span id="weighted_element_consistency-245"><a href="#weighted_element_consistency-245"><span class="linenos">245</span></a><span class="sd">        &gt;&gt;&gt; print(weighted_ecc)</span>
</span><span id="weighted_element_consistency-246"><a href="#weighted_element_consistency-246"><span class="linenos">246</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="weighted_element_consistency-247"><a href="#weighted_element_consistency-247"><span class="linenos">247</span></a>    <span class="n">n_clusterings</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">clustering_list</span><span class="p">)</span>
</span><span id="weighted_element_consistency-248"><a href="#weighted_element_consistency-248"><span class="linenos">248</span></a>    <span class="n">num_elements</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">clustering_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="weighted_element_consistency-249"><a href="#weighted_element_consistency-249"><span class="linenos">249</span></a>
</span><span id="weighted_element_consistency-250"><a href="#weighted_element_consistency-250"><span class="linenos">250</span></a>    <span class="c1"># Precompute data for all clusterings</span>
</span><span id="weighted_element_consistency-251"><a href="#weighted_element_consistency-251"><span class="linenos">251</span></a>    <span class="n">clustering_data</span> <span class="o">=</span> <span class="n">_precompute_clustering_data</span><span class="p">(</span><span class="n">clustering_list</span><span class="p">)</span>
</span><span id="weighted_element_consistency-252"><a href="#weighted_element_consistency-252"><span class="linenos">252</span></a>
</span><span id="weighted_element_consistency-253"><a href="#weighted_element_consistency-253"><span class="linenos">253</span></a>    <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="weighted_element_consistency-254"><a href="#weighted_element_consistency-254"><span class="linenos">254</span></a>        <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_clusterings</span><span class="p">)</span>
</span><span id="weighted_element_consistency-255"><a href="#weighted_element_consistency-255"><span class="linenos">255</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="weighted_element_consistency-256"><a href="#weighted_element_consistency-256"><span class="linenos">256</span></a>        <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
</span><span id="weighted_element_consistency-257"><a href="#weighted_element_consistency-257"><span class="linenos">257</span></a>        <span class="k">if</span> <span class="n">weights</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">n_clusterings</span><span class="p">:</span>
</span><span id="weighted_element_consistency-258"><a href="#weighted_element_consistency-258"><span class="linenos">258</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Length of &#39;weights&#39; must match the number of clusterings.&quot;</span><span class="p">)</span>
</span><span id="weighted_element_consistency-259"><a href="#weighted_element_consistency-259"><span class="linenos">259</span></a>
</span><span id="weighted_element_consistency-260"><a href="#weighted_element_consistency-260"><span class="linenos">260</span></a>    <span class="n">total_weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
</span><span id="weighted_element_consistency-261"><a href="#weighted_element_consistency-261"><span class="linenos">261</span></a>    <span class="n">num_pairs</span> <span class="o">=</span> <span class="n">total_weights</span> <span class="o">*</span> <span class="p">(</span><span class="n">total_weights</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="weighted_element_consistency-262"><a href="#weighted_element_consistency-262"><span class="linenos">262</span></a>
</span><span id="weighted_element_consistency-263"><a href="#weighted_element_consistency-263"><span class="linenos">263</span></a>    <span class="c1"># Initialize consistency accumulator as an array</span>
</span><span id="weighted_element_consistency-264"><a href="#weighted_element_consistency-264"><span class="linenos">264</span></a>    <span class="n">consistency</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_elements</span><span class="p">)</span>
</span><span id="weighted_element_consistency-265"><a href="#weighted_element_consistency-265"><span class="linenos">265</span></a>
</span><span id="weighted_element_consistency-266"><a href="#weighted_element_consistency-266"><span class="linenos">266</span></a>    <span class="k">if</span> <span class="n">calculate_sim_matrix</span><span class="p">:</span>
</span><span id="weighted_element_consistency-267"><a href="#weighted_element_consistency-267"><span class="linenos">267</span></a>        <span class="n">sim_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_clusterings</span><span class="p">,</span> <span class="n">n_clusterings</span><span class="p">))</span>  <span class="c1"># Initialize with zeros</span>
</span><span id="weighted_element_consistency-268"><a href="#weighted_element_consistency-268"><span class="linenos">268</span></a>
</span><span id="weighted_element_consistency-269"><a href="#weighted_element_consistency-269"><span class="linenos">269</span></a>    <span class="c1"># Generate all unique pairs of indices</span>
</span><span id="weighted_element_consistency-270"><a href="#weighted_element_consistency-270"><span class="linenos">270</span></a>    <span class="n">indices_i</span><span class="p">,</span> <span class="n">indices_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu_indices</span><span class="p">(</span><span class="n">n_clusterings</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="weighted_element_consistency-271"><a href="#weighted_element_consistency-271"><span class="linenos">271</span></a>
</span><span id="weighted_element_consistency-272"><a href="#weighted_element_consistency-272"><span class="linenos">272</span></a>    <span class="c1"># Compute pairwise ECS values and accumulate weighted consistency</span>
</span><span id="weighted_element_consistency-273"><a href="#weighted_element_consistency-273"><span class="linenos">273</span></a>    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indices_i</span><span class="p">)):</span>
</span><span id="weighted_element_consistency-274"><a href="#weighted_element_consistency-274"><span class="linenos">274</span></a>        <span class="n">i</span> <span class="o">=</span> <span class="n">indices_i</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="weighted_element_consistency-275"><a href="#weighted_element_consistency-275"><span class="linenos">275</span></a>        <span class="n">j</span> <span class="o">=</span> <span class="n">indices_j</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="weighted_element_consistency-276"><a href="#weighted_element_consistency-276"><span class="linenos">276</span></a>        <span class="n">weight_pair</span> <span class="o">=</span> <span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">weights</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span><span id="weighted_element_consistency-277"><a href="#weighted_element_consistency-277"><span class="linenos">277</span></a>
</span><span id="weighted_element_consistency-278"><a href="#weighted_element_consistency-278"><span class="linenos">278</span></a>        <span class="n">ecs_values</span> <span class="o">=</span> <span class="n">_element_sim_elscore_with_precomputed</span><span class="p">(</span><span class="n">clustering_data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">clustering_data</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</span><span id="weighted_element_consistency-279"><a href="#weighted_element_consistency-279"><span class="linenos">279</span></a>
</span><span id="weighted_element_consistency-280"><a href="#weighted_element_consistency-280"><span class="linenos">280</span></a>        <span class="n">consistency</span> <span class="o">+=</span> <span class="n">ecs_values</span> <span class="o">*</span> <span class="n">weight_pair</span>
</span><span id="weighted_element_consistency-281"><a href="#weighted_element_consistency-281"><span class="linenos">281</span></a>
</span><span id="weighted_element_consistency-282"><a href="#weighted_element_consistency-282"><span class="linenos">282</span></a>        <span class="k">if</span> <span class="n">calculate_sim_matrix</span><span class="p">:</span>
</span><span id="weighted_element_consistency-283"><a href="#weighted_element_consistency-283"><span class="linenos">283</span></a>            <span class="n">mean_ecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ecs_values</span><span class="p">)</span>
</span><span id="weighted_element_consistency-284"><a href="#weighted_element_consistency-284"><span class="linenos">284</span></a>            <span class="n">sim_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_ecs</span>  <span class="c1"># Only assign upper triangle</span>
</span><span id="weighted_element_consistency-285"><a href="#weighted_element_consistency-285"><span class="linenos">285</span></a>
</span><span id="weighted_element_consistency-286"><a href="#weighted_element_consistency-286"><span class="linenos">286</span></a>    <span class="c1"># Add self-consistency contributions (element-wise)</span>
</span><span id="weighted_element_consistency-287"><a href="#weighted_element_consistency-287"><span class="linenos">287</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_clusterings</span><span class="p">):</span>
</span><span id="weighted_element_consistency-288"><a href="#weighted_element_consistency-288"><span class="linenos">288</span></a>        <span class="n">weight</span> <span class="o">=</span> <span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="weighted_element_consistency-289"><a href="#weighted_element_consistency-289"><span class="linenos">289</span></a>        <span class="c1"># Since ECS of a clustering with itself is 1 for all elements,</span>
</span><span id="weighted_element_consistency-290"><a href="#weighted_element_consistency-290"><span class="linenos">290</span></a>        <span class="c1"># and weights[i] * (weights[i] - 1) / 2 is the weight of self-consistency,</span>
</span><span id="weighted_element_consistency-291"><a href="#weighted_element_consistency-291"><span class="linenos">291</span></a>        <span class="c1"># we multiply it by 1 (the ECS value) for each element.</span>
</span><span id="weighted_element_consistency-292"><a href="#weighted_element_consistency-292"><span class="linenos">292</span></a>        <span class="n">consistency</span> <span class="o">+=</span> <span class="p">(</span><span class="n">weight</span> <span class="o">*</span> <span class="p">(</span><span class="n">weight</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num_elements</span><span class="p">)</span>
</span><span id="weighted_element_consistency-293"><a href="#weighted_element_consistency-293"><span class="linenos">293</span></a>
</span><span id="weighted_element_consistency-294"><a href="#weighted_element_consistency-294"><span class="linenos">294</span></a>    <span class="c1"># Normalize consistency</span>
</span><span id="weighted_element_consistency-295"><a href="#weighted_element_consistency-295"><span class="linenos">295</span></a>    <span class="n">normalized_consistency</span> <span class="o">=</span> <span class="n">consistency</span> <span class="o">/</span> <span class="n">num_pairs</span>
</span><span id="weighted_element_consistency-296"><a href="#weighted_element_consistency-296"><span class="linenos">296</span></a>
</span><span id="weighted_element_consistency-297"><a href="#weighted_element_consistency-297"><span class="linenos">297</span></a>    <span class="k">if</span> <span class="n">calculate_sim_matrix</span><span class="p">:</span>
</span><span id="weighted_element_consistency-298"><a href="#weighted_element_consistency-298"><span class="linenos">298</span></a>        <span class="k">return</span> <span class="n">normalized_consistency</span><span class="p">,</span> <span class="n">sim_matrix</span>  <span class="c1"># sim_matrix remains upper triangular with zeros elsewhere</span>
</span><span id="weighted_element_consistency-299"><a href="#weighted_element_consistency-299"><span class="linenos">299</span></a>
</span><span id="weighted_element_consistency-300"><a href="#weighted_element_consistency-300"><span class="linenos">300</span></a>    <span class="k">return</span> <span class="n">normalized_consistency</span>
</span></pre></div>


            <div class="docstring"><p>Calculate the weighted element-wise consistency of a set of clusterings.</p>

<p>This function computes per-element weighted consistency scores, aligning with the old implementation.</p>

<h3 id="args">Args:</h3>

<pre><code>clustering_list (list of array-like): A list where each element is a clustering partition.
weights (list of float, optional): A list of weights corresponding to each clustering in 'clustering_list'.
calculate_sim_matrix (bool, optional): Whether to return the similarity matrix.
</code></pre>

<h3 id="returns">Returns:</h3>

<pre><code>ndarray: An array of per-element weighted consistency scores.
(optional) ndarray: Similarity matrix if calculate_sim_matrix is True.
</code></pre>

<h3 id="example">Example:</h3>

<pre><code>&gt;&gt;&gt; clustering_list = [np.array([1, 1, 2]), np.array([1, 2, 2]), np.array([2, 2, 1])]
&gt;&gt;&gt; weighted_ecc = weighted_element_consistency(clustering_list, weights=[1, 0.5, 0.5])
&gt;&gt;&gt; print(weighted_ecc)
</code></pre>
</div>


                </section>
                <section id="assess_feature_stability">
                            <input id="assess_feature_stability-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">assess_feature_stability</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">data_matrix</span>,</span><span class="param">	<span class="n">feature_set</span>,</span><span class="param">	<span class="n">steps</span>,</span><span class="param">	<span class="n">feature_type</span>,</span><span class="param">	<span class="n">resolution</span>,</span><span class="param">	<span class="n">ncores</span>,</span><span class="param">	<span class="n">n_repetitions</span><span class="o">=</span><span class="mi">100</span>,</span><span class="param">	<span class="n">seed_sequence</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">graph_reduction_type</span><span class="o">=</span><span class="s1">&#39;PCA&#39;</span>,</span><span class="param">	<span class="n">npcs</span><span class="o">=</span><span class="mi">30</span>,</span><span class="param">	<span class="n">ecs_thresh</span><span class="o">=</span><span class="mi">1</span>,</span><span class="param">	<span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;leiden&#39;</span>,</span><span class="param">	<span class="n">umap_arguments</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">show_warnings</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">parallel_steps</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">pca_postprocessing</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">flavor</span><span class="o">=</span><span class="s1">&#39;default&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="assess_feature_stability-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#assess_feature_stability"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="assess_feature_stability-132"><a href="#assess_feature_stability-132"><span class="linenos">132</span></a><span class="k">def</span> <span class="nf">assess_feature_stability</span><span class="p">(</span><span class="n">data_matrix</span><span class="p">,</span> <span class="n">feature_set</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="n">feature_type</span><span class="p">,</span>
</span><span id="assess_feature_stability-133"><a href="#assess_feature_stability-133"><span class="linenos">133</span></a>                             <span class="n">resolution</span><span class="p">,</span> <span class="n">ncores</span><span class="p">,</span> <span class="n">n_repetitions</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">seed_sequence</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="assess_feature_stability-134"><a href="#assess_feature_stability-134"><span class="linenos">134</span></a>                             <span class="n">graph_reduction_type</span><span class="o">=</span><span class="s2">&quot;PCA&quot;</span><span class="p">,</span> <span class="n">npcs</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">ecs_thresh</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="assess_feature_stability-135"><a href="#assess_feature_stability-135"><span class="linenos">135</span></a>                             <span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;leiden&#39;</span><span class="p">,</span> <span class="n">umap_arguments</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_warnings</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">parallel_steps</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">pca_postprocessing</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">flavor</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">):</span>
</span><span id="assess_feature_stability-136"><a href="#assess_feature_stability-136"><span class="linenos">136</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="assess_feature_stability-137"><a href="#assess_feature_stability-137"><span class="linenos">137</span></a><span class="sd">    Assess the stability for configurations of feature types and size. Evaluate the stability of clusterings obtained based on incremental subsets of a given feature set.</span>
</span><span id="assess_feature_stability-138"><a href="#assess_feature_stability-138"><span class="linenos">138</span></a><span class="sd">    </span>
</span><span id="assess_feature_stability-139"><a href="#assess_feature_stability-139"><span class="linenos">139</span></a><span class="sd">    The algorithm assumes that the feature_set is already sorted when performing the subsetting. For example, if the user wants to analyze highly variable feature set, they should provide them sorted by their variability.</span>
</span><span id="assess_feature_stability-140"><a href="#assess_feature_stability-140"><span class="linenos">140</span></a><span class="sd">    </span>
</span><span id="assess_feature_stability-141"><a href="#assess_feature_stability-141"><span class="linenos">141</span></a><span class="sd">    ### Args:</span>
</span><span id="assess_feature_stability-142"><a href="#assess_feature_stability-142"><span class="linenos">142</span></a><span class="sd">        data_matrix (pandas.DataFrame): A data matrix with rows as cells and columns as features.</span>
</span><span id="assess_feature_stability-143"><a href="#assess_feature_stability-143"><span class="linenos">143</span></a><span class="sd">        feature_set (list): A list of features feature names that can be found on the rownames of the data matrix.</span>
</span><span id="assess_feature_stability-144"><a href="#assess_feature_stability-144"><span class="linenos">144</span></a><span class="sd">        steps (list): A list of integers containing the sizes of the subsets.</span>
</span><span id="assess_feature_stability-145"><a href="#assess_feature_stability-145"><span class="linenos">145</span></a><span class="sd">        feature_type (str): A name associated to the feature_set (e.g. HV - for highly variable genes).</span>
</span><span id="assess_feature_stability-146"><a href="#assess_feature_stability-146"><span class="linenos">146</span></a><span class="sd">        resolution (list): A list of resolutions to be used for clustering.</span>
</span><span id="assess_feature_stability-147"><a href="#assess_feature_stability-147"><span class="linenos">147</span></a><span class="sd">        ncores (int): The number of cores to be used for parallel processing.</span>
</span><span id="assess_feature_stability-148"><a href="#assess_feature_stability-148"><span class="linenos">148</span></a><span class="sd">        n_repetitions (int): The number of repetitions of applying the pipeline with different seeds; ignored if seed_sequence is provided by the user.</span>
</span><span id="assess_feature_stability-149"><a href="#assess_feature_stability-149"><span class="linenos">149</span></a><span class="sd">        seed_sequence (int array): A custom seed sequence; if the value is None, the sequence will be built starting from 1 with a step of 100.</span>
</span><span id="assess_feature_stability-150"><a href="#assess_feature_stability-150"><span class="linenos">150</span></a><span class="sd">        graph_reduction_type (str): The graph reduction type, denoting if the graph should be built on either the PCA or the UMAP embedding.</span>
</span><span id="assess_feature_stability-151"><a href="#assess_feature_stability-151"><span class="linenos">151</span></a><span class="sd">        npcs (int): The number of principal components.</span>
</span><span id="assess_feature_stability-152"><a href="#assess_feature_stability-152"><span class="linenos">152</span></a><span class="sd">        ecs_thresh (float): The ECS threshold used for merging similar clusterings.</span>
</span><span id="assess_feature_stability-153"><a href="#assess_feature_stability-153"><span class="linenos">153</span></a><span class="sd">        algorithm (str): The community detection algorithm to be used: &#39;louvain&#39;, or &#39;leiden&#39;. Default and recommended is &#39;leiden&#39;.</span>
</span><span id="assess_feature_stability-154"><a href="#assess_feature_stability-154"><span class="linenos">154</span></a><span class="sd">        umap_arguments (dict): A dictionary containing the arguments to be passed to the UMAP function.</span>
</span><span id="assess_feature_stability-155"><a href="#assess_feature_stability-155"><span class="linenos">155</span></a><span class="sd">        warnings_verbose (bool): Whether to print warnings or not.</span>
</span><span id="assess_feature_stability-156"><a href="#assess_feature_stability-156"><span class="linenos">156</span></a><span class="sd">        flavor (str): The implementation of the graph clustering algorithm to be used. Default is &#39;default&#39;. You can also use &#39;igraph&#39;.</span>
</span><span id="assess_feature_stability-157"><a href="#assess_feature_stability-157"><span class="linenos">157</span></a><span class="sd">    </span>
</span><span id="assess_feature_stability-158"><a href="#assess_feature_stability-158"><span class="linenos">158</span></a><span class="sd">    ### Raises:</span>
</span><span id="assess_feature_stability-159"><a href="#assess_feature_stability-159"><span class="linenos">159</span></a><span class="sd">        ValueError: If data_matrix is not a pandas DataFrame.</span>
</span><span id="assess_feature_stability-160"><a href="#assess_feature_stability-160"><span class="linenos">160</span></a><span class="sd">        ValueError: If feature_set is not a list or tuple of strings, or contains elements not in data_matrix.</span>
</span><span id="assess_feature_stability-161"><a href="#assess_feature_stability-161"><span class="linenos">161</span></a><span class="sd">        ValueError: If any feature in feature_set is not found in data_matrix columns.</span>
</span><span id="assess_feature_stability-162"><a href="#assess_feature_stability-162"><span class="linenos">162</span></a><span class="sd">        ValueError: If steps is not an integer or a list/tuple of integers.</span>
</span><span id="assess_feature_stability-163"><a href="#assess_feature_stability-163"><span class="linenos">163</span></a><span class="sd">        ValueError: If feature_type is not a string.</span>
</span><span id="assess_feature_stability-164"><a href="#assess_feature_stability-164"><span class="linenos">164</span></a><span class="sd">        ValueError: If resolution is not a list or tuple of floats.</span>
</span><span id="assess_feature_stability-165"><a href="#assess_feature_stability-165"><span class="linenos">165</span></a><span class="sd">        ValueError: If n_repetitions is not an integer.</span>
</span><span id="assess_feature_stability-166"><a href="#assess_feature_stability-166"><span class="linenos">166</span></a><span class="sd">        ValueError: If graph_reduction_type is not &#39;PCA&#39; or &#39;UMAP&#39;.</span>
</span><span id="assess_feature_stability-167"><a href="#assess_feature_stability-167"><span class="linenos">167</span></a><span class="sd">        ValueError: If npcs is not an integer.</span>
</span><span id="assess_feature_stability-168"><a href="#assess_feature_stability-168"><span class="linenos">168</span></a><span class="sd">        ValueError: If ecs_thresh is not a numeric value.</span>
</span><span id="assess_feature_stability-169"><a href="#assess_feature_stability-169"><span class="linenos">169</span></a><span class="sd">        ValueError: If algorithm is not &#39;louvain&#39; or &#39;leiden&#39;.</span>
</span><span id="assess_feature_stability-170"><a href="#assess_feature_stability-170"><span class="linenos">170</span></a><span class="sd">        ValueError: If flavor is not &#39;default&#39; or &#39;igraph&#39;.</span>
</span><span id="assess_feature_stability-171"><a href="#assess_feature_stability-171"><span class="linenos">171</span></a><span class="sd">        </span>
</span><span id="assess_feature_stability-172"><a href="#assess_feature_stability-172"><span class="linenos">172</span></a><span class="sd">    ### Returns:</span>
</span><span id="assess_feature_stability-173"><a href="#assess_feature_stability-173"><span class="linenos">173</span></a><span class="sd">        # dict: A dictionary with the following structure:</span>
</span><span id="assess_feature_stability-174"><a href="#assess_feature_stability-174"><span class="linenos">174</span></a><span class="sd">        #     - pca_list (dict): PCA embeddings for each step.</span>
</span><span id="assess_feature_stability-175"><a href="#assess_feature_stability-175"><span class="linenos">175</span></a><span class="sd">        #     - embedding_list (dict): UMAP embeddings for each step.</span>
</span><span id="assess_feature_stability-176"><a href="#assess_feature_stability-176"><span class="linenos">176</span></a><span class="sd">        #     - steps_ecc_list (dict): Contains the element consistency scores for each step and resolution, with each entry as follows:</span>
</span><span id="assess_feature_stability-177"><a href="#assess_feature_stability-177"><span class="linenos">177</span></a><span class="sd">        #             - ecc (float): The element consistency score for the corresponding step.</span>
</span><span id="assess_feature_stability-178"><a href="#assess_feature_stability-178"><span class="linenos">178</span></a><span class="sd">        #             - most_frequent_partition (dict): Information about the partition with the highest frequency:</span>
</span><span id="assess_feature_stability-179"><a href="#assess_feature_stability-179"><span class="linenos">179</span></a><span class="sd">        #                 - mb (list): The partition with the highest frequency.</span>
</span><span id="assess_feature_stability-180"><a href="#assess_feature_stability-180"><span class="linenos">180</span></a><span class="sd">        #                 - freq (int): The frequency of the most frequent partition.</span>
</span><span id="assess_feature_stability-181"><a href="#assess_feature_stability-181"><span class="linenos">181</span></a><span class="sd">        #                 - seed (int): The seed used for the most frequent partition.</span>
</span><span id="assess_feature_stability-182"><a href="#assess_feature_stability-182"><span class="linenos">182</span></a><span class="sd">        #             - n_different_partitions (int): The number of different partitions obtained for the corresponding step.</span>
</span><span id="assess_feature_stability-183"><a href="#assess_feature_stability-183"><span class="linenos">183</span></a><span class="sd">        #     - incremental_ecs_list (dict): Incremental element consistency scores for each step and resolution.</span>
</span><span id="assess_feature_stability-184"><a href="#assess_feature_stability-184"><span class="linenos">184</span></a>
</span><span id="assess_feature_stability-185"><a href="#assess_feature_stability-185"><span class="linenos">185</span></a><span class="sd">    ### Example:</span>
</span><span id="assess_feature_stability-186"><a href="#assess_feature_stability-186"><span class="linenos">186</span></a><span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
</span><span id="assess_feature_stability-187"><a href="#assess_feature_stability-187"><span class="linenos">187</span></a><span class="sd">    &gt;&gt;&gt; import ClustAssessPy as ca</span>
</span><span id="assess_feature_stability-188"><a href="#assess_feature_stability-188"><span class="linenos">188</span></a><span class="sd">    &gt;&gt;&gt; import numpy as np</span>
</span><span id="assess_feature_stability-189"><a href="#assess_feature_stability-189"><span class="linenos">189</span></a><span class="sd">    &gt;&gt;&gt; # Generate a random data matrix</span>
</span><span id="assess_feature_stability-190"><a href="#assess_feature_stability-190"><span class="linenos">190</span></a><span class="sd">    &gt;&gt;&gt; data_matrix = pd.DataFrame(np.random.rand(1000, 1000))</span>
</span><span id="assess_feature_stability-191"><a href="#assess_feature_stability-191"><span class="linenos">191</span></a><span class="sd">    &gt;&gt;&gt; data_matrix.columns = [f&#39;gene_{i}&#39; for i in range(1000)] </span>
</span><span id="assess_feature_stability-192"><a href="#assess_feature_stability-192"><span class="linenos">192</span></a><span class="sd">    &gt;&gt;&gt; # Define the feature set</span>
</span><span id="assess_feature_stability-193"><a href="#assess_feature_stability-193"><span class="linenos">193</span></a><span class="sd">    &gt;&gt;&gt; feature_set = data_matrix.columns.tolist()</span>
</span><span id="assess_feature_stability-194"><a href="#assess_feature_stability-194"><span class="linenos">194</span></a><span class="sd">    &gt;&gt;&gt; # Define the steps</span>
</span><span id="assess_feature_stability-195"><a href="#assess_feature_stability-195"><span class="linenos">195</span></a><span class="sd">    &gt;&gt;&gt; steps = [500, 1000, 1500]</span>
</span><span id="assess_feature_stability-196"><a href="#assess_feature_stability-196"><span class="linenos">196</span></a><span class="sd">    &gt;&gt;&gt; # Define the resolutions</span>
</span><span id="assess_feature_stability-197"><a href="#assess_feature_stability-197"><span class="linenos">197</span></a><span class="sd">    &gt;&gt;&gt; resolution = np.arange(0.1, 1.1, 0.3)</span>
</span><span id="assess_feature_stability-198"><a href="#assess_feature_stability-198"><span class="linenos">198</span></a><span class="sd">    &gt;&gt;&gt; # Assess the feature stability</span>
</span><span id="assess_feature_stability-199"><a href="#assess_feature_stability-199"><span class="linenos">199</span></a><span class="sd">    &gt;&gt;&gt; feature_stability_results = ca.assess_feature_stability(data_matrix, feature_set, steps, &#39;test&#39;, resolution, n_repetitions=10,  graph_reduction_type=&quot;PCA&quot;, npcs=30, algorithm=&#39;leiden&#39;)&quot;&quot;&quot;</span>
</span><span id="assess_feature_stability-200"><a href="#assess_feature_stability-200"><span class="linenos">200</span></a>   
</span><span id="assess_feature_stability-201"><a href="#assess_feature_stability-201"><span class="linenos">201</span></a>    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Please ensure data matrix has rows as cells and columns as features.&quot;</span><span class="p">)</span>
</span><span id="assess_feature_stability-202"><a href="#assess_feature_stability-202"><span class="linenos">202</span></a>    
</span><span id="assess_feature_stability-203"><a href="#assess_feature_stability-203"><span class="linenos">203</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">show_warnings</span><span class="p">:</span>
</span><span id="assess_feature_stability-204"><a href="#assess_feature_stability-204"><span class="linenos">204</span></a>        <span class="k">if</span> <span class="n">algorithm</span> <span class="o">==</span> <span class="s2">&quot;leiden&quot;</span><span class="p">:</span>
</span><span id="assess_feature_stability-205"><a href="#assess_feature_stability-205"><span class="linenos">205</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FutureWarnings (caused by ScanPy for Leiden) will be suppressed. Set show_warnings=True to see them.&quot;</span><span class="p">)</span>
</span><span id="assess_feature_stability-206"><a href="#assess_feature_stability-206"><span class="linenos">206</span></a>    
</span><span id="assess_feature_stability-207"><a href="#assess_feature_stability-207"><span class="linenos">207</span></a>    <span class="c1"># Parameter checks and initial processing</span>
</span><span id="assess_feature_stability-208"><a href="#assess_feature_stability-208"><span class="linenos">208</span></a>    <span class="n">_validate_parameters_feature_stability</span><span class="p">(</span><span class="n">data_matrix</span><span class="p">,</span> <span class="n">feature_set</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="n">feature_type</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">n_repetitions</span><span class="p">,</span> <span class="n">graph_reduction_type</span><span class="p">,</span> <span class="n">npcs</span><span class="p">,</span> <span class="n">ecs_thresh</span><span class="p">,</span> <span class="n">algorithm</span><span class="p">,</span> <span class="n">flavor</span><span class="p">,</span> <span class="n">ncores</span><span class="p">)</span>
</span><span id="assess_feature_stability-209"><a href="#assess_feature_stability-209"><span class="linenos">209</span></a>    
</span><span id="assess_feature_stability-210"><a href="#assess_feature_stability-210"><span class="linenos">210</span></a>    <span class="n">ncells</span> <span class="o">=</span> <span class="n">data_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="assess_feature_stability-211"><a href="#assess_feature_stability-211"><span class="linenos">211</span></a>    
</span><span id="assess_feature_stability-212"><a href="#assess_feature_stability-212"><span class="linenos">212</span></a>    <span class="n">pca_list</span><span class="p">,</span> <span class="n">embedding_list</span><span class="p">,</span> <span class="n">partitions_list</span><span class="p">,</span> <span class="n">steps_ecc_list</span><span class="p">,</span> <span class="n">incremental_ecs_list</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">{}</span>
</span><span id="assess_feature_stability-213"><a href="#assess_feature_stability-213"><span class="linenos">213</span></a>    
</span><span id="assess_feature_stability-214"><a href="#assess_feature_stability-214"><span class="linenos">214</span></a>    <span class="k">if</span> <span class="n">seed_sequence</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="assess_feature_stability-215"><a href="#assess_feature_stability-215"><span class="linenos">215</span></a>        <span class="n">seed_sequence</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_repetitions</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> 
</span><span id="assess_feature_stability-216"><a href="#assess_feature_stability-216"><span class="linenos">216</span></a>        
</span><span id="assess_feature_stability-217"><a href="#assess_feature_stability-217"><span class="linenos">217</span></a>    <span class="k">if</span> <span class="n">parallel_steps</span><span class="p">:</span> 
</span><span id="assess_feature_stability-218"><a href="#assess_feature_stability-218"><span class="linenos">218</span></a>        <span class="c1"># Run steps in parallel</span>
</span><span id="assess_feature_stability-219"><a href="#assess_feature_stability-219"><span class="linenos">219</span></a>        <span class="k">with</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ProcessPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span> <span class="o">=</span> <span class="n">ncores</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
</span><span id="assess_feature_stability-220"><a href="#assess_feature_stability-220"><span class="linenos">220</span></a>            <span class="n">futures</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="assess_feature_stability-221"><a href="#assess_feature_stability-221"><span class="linenos">221</span></a>            <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">steps</span><span class="p">:</span>
</span><span id="assess_feature_stability-222"><a href="#assess_feature_stability-222"><span class="linenos">222</span></a>                <span class="c1"># Map each step to its corresponding future.</span>
</span><span id="assess_feature_stability-223"><a href="#assess_feature_stability-223"><span class="linenos">223</span></a>                <span class="n">future</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">_perform_feature_stability_step</span><span class="p">,</span> <span class="n">data_matrix</span><span class="p">,</span> <span class="n">feature_set</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">npcs</span><span class="p">,</span> <span class="n">ncells</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">seed_sequence</span><span class="p">,</span> <span class="n">algorithm</span><span class="p">,</span> <span class="n">ecs_thresh</span><span class="p">,</span> <span class="n">partitions_list</span><span class="p">,</span> <span class="n">graph_reduction_type</span><span class="p">,</span> <span class="n">pca_postprocessing</span><span class="p">,</span> <span class="n">flavor</span><span class="p">,</span> <span class="n">ncores</span><span class="p">,</span> <span class="n">show_warnings</span><span class="p">,</span> <span class="n">umap_arguments</span><span class="p">)</span>
</span><span id="assess_feature_stability-224"><a href="#assess_feature_stability-224"><span class="linenos">224</span></a>                <span class="n">futures</span><span class="p">[</span><span class="n">future</span><span class="p">]</span> <span class="o">=</span> <span class="n">step</span>
</span><span id="assess_feature_stability-225"><a href="#assess_feature_stability-225"><span class="linenos">225</span></a>
</span><span id="assess_feature_stability-226"><a href="#assess_feature_stability-226"><span class="linenos">226</span></a>            <span class="c1"># Process the results as they complete</span>
</span><span id="assess_feature_stability-227"><a href="#assess_feature_stability-227"><span class="linenos">227</span></a>            <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(</span><span class="n">futures</span><span class="p">):</span>
</span><span id="assess_feature_stability-228"><a href="#assess_feature_stability-228"><span class="linenos">228</span></a>                <span class="n">step</span> <span class="o">=</span> <span class="n">futures</span><span class="p">[</span><span class="n">future</span><span class="p">]</span>
</span><span id="assess_feature_stability-229"><a href="#assess_feature_stability-229"><span class="linenos">229</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span><span id="assess_feature_stability-230"><a href="#assess_feature_stability-230"><span class="linenos">230</span></a>                
</span><span id="assess_feature_stability-231"><a href="#assess_feature_stability-231"><span class="linenos">231</span></a>                <span class="k">if</span> <span class="n">graph_reduction_type</span> <span class="o">==</span> <span class="s2">&quot;UMAP&quot;</span><span class="p">:</span>
</span><span id="assess_feature_stability-232"><a href="#assess_feature_stability-232"><span class="linenos">232</span></a>                    <span class="n">pca_embeddings</span><span class="p">,</span> <span class="n">umap_embeddings</span><span class="p">,</span> <span class="n">temp_list</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="assess_feature_stability-233"><a href="#assess_feature_stability-233"><span class="linenos">233</span></a>                    <span class="n">assign_to_nested_dict</span><span class="p">(</span><span class="n">embedding_list</span><span class="p">,</span> <span class="n">feature_type</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">umap_embeddings</span><span class="p">)</span>
</span><span id="assess_feature_stability-234"><a href="#assess_feature_stability-234"><span class="linenos">234</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="assess_feature_stability-235"><a href="#assess_feature_stability-235"><span class="linenos">235</span></a>                    <span class="n">pca_embeddings</span><span class="p">,</span> <span class="n">temp_list</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="assess_feature_stability-236"><a href="#assess_feature_stability-236"><span class="linenos">236</span></a>
</span><span id="assess_feature_stability-237"><a href="#assess_feature_stability-237"><span class="linenos">237</span></a>                <span class="c1"># Store pca_embeddings and steps_ecc (temp_list)</span>
</span><span id="assess_feature_stability-238"><a href="#assess_feature_stability-238"><span class="linenos">238</span></a>                <span class="n">assign_to_nested_dict</span><span class="p">(</span><span class="n">pca_list</span><span class="p">,</span> <span class="n">feature_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">step</span><span class="p">),</span> <span class="n">pca_embeddings</span><span class="p">)</span>
</span><span id="assess_feature_stability-239"><a href="#assess_feature_stability-239"><span class="linenos">239</span></a>                <span class="n">assign_to_nested_dict</span><span class="p">(</span><span class="n">steps_ecc_list</span><span class="p">,</span> <span class="n">feature_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">step</span><span class="p">),</span> <span class="n">temp_list</span><span class="p">)</span>
</span><span id="assess_feature_stability-240"><a href="#assess_feature_stability-240"><span class="linenos">240</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="assess_feature_stability-241"><a href="#assess_feature_stability-241"><span class="linenos">241</span></a>        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">steps</span><span class="p">:</span>
</span><span id="assess_feature_stability-242"><a href="#assess_feature_stability-242"><span class="linenos">242</span></a>            <span class="k">if</span> <span class="n">graph_reduction_type</span> <span class="o">==</span> <span class="s2">&quot;UMAP&quot;</span><span class="p">:</span>
</span><span id="assess_feature_stability-243"><a href="#assess_feature_stability-243"><span class="linenos">243</span></a>                <span class="n">pca_embeddings</span><span class="p">,</span> <span class="n">umap_embeddings</span><span class="p">,</span> <span class="n">temp_list</span> <span class="o">=</span> <span class="n">_perform_feature_stability_step</span><span class="p">(</span><span class="n">data_matrix</span><span class="p">,</span> <span class="n">feature_set</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">npcs</span><span class="p">,</span> <span class="n">ncells</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">seed_sequence</span><span class="p">,</span> <span class="n">algorithm</span><span class="p">,</span> <span class="n">ecs_thresh</span><span class="p">,</span> <span class="n">partitions_list</span><span class="p">,</span> <span class="n">graph_reduction_type</span><span class="p">,</span> <span class="n">pca_postprocessing</span><span class="p">,</span> <span class="n">flavor</span><span class="p">,</span> <span class="n">ncores</span><span class="p">,</span> <span class="n">umap_arguments</span><span class="p">)</span>
</span><span id="assess_feature_stability-244"><a href="#assess_feature_stability-244"><span class="linenos">244</span></a>                <span class="n">assign_to_nested_dict</span><span class="p">(</span><span class="n">embedding_list</span><span class="p">,</span> <span class="n">feature_type</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">umap_embeddings</span><span class="p">)</span>
</span><span id="assess_feature_stability-245"><a href="#assess_feature_stability-245"><span class="linenos">245</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="assess_feature_stability-246"><a href="#assess_feature_stability-246"><span class="linenos">246</span></a>                <span class="n">pca_embeddings</span><span class="p">,</span> <span class="n">temp_list</span> <span class="o">=</span> <span class="n">_perform_feature_stability_step</span><span class="p">(</span><span class="n">data_matrix</span><span class="p">,</span> <span class="n">feature_set</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">npcs</span><span class="p">,</span> <span class="n">ncells</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">seed_sequence</span><span class="p">,</span> <span class="n">algorithm</span><span class="p">,</span> <span class="n">ecs_thresh</span><span class="p">,</span> <span class="n">partitions_list</span><span class="p">,</span> <span class="n">graph_reduction_type</span><span class="p">,</span> <span class="n">pca_postprocessing</span><span class="p">,</span> <span class="n">flavor</span><span class="p">,</span> <span class="n">ncores</span><span class="p">,</span> <span class="n">umap_arguments</span><span class="p">)</span>
</span><span id="assess_feature_stability-247"><a href="#assess_feature_stability-247"><span class="linenos">247</span></a>                
</span><span id="assess_feature_stability-248"><a href="#assess_feature_stability-248"><span class="linenos">248</span></a>            <span class="c1"># Store pca_embeddings and steps_ecc (temp_list)</span>
</span><span id="assess_feature_stability-249"><a href="#assess_feature_stability-249"><span class="linenos">249</span></a>            <span class="n">assign_to_nested_dict</span><span class="p">(</span><span class="n">pca_list</span><span class="p">,</span> <span class="n">feature_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">step</span><span class="p">),</span> <span class="n">pca_embeddings</span><span class="p">)</span>
</span><span id="assess_feature_stability-250"><a href="#assess_feature_stability-250"><span class="linenos">250</span></a>            <span class="n">assign_to_nested_dict</span><span class="p">(</span><span class="n">steps_ecc_list</span><span class="p">,</span> <span class="n">feature_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">step</span><span class="p">),</span> <span class="n">temp_list</span><span class="p">)</span>
</span><span id="assess_feature_stability-251"><a href="#assess_feature_stability-251"><span class="linenos">251</span></a>        
</span><span id="assess_feature_stability-252"><a href="#assess_feature_stability-252"><span class="linenos">252</span></a>    <span class="c1"># Compute the incremental_ecs_list</span>
</span><span id="assess_feature_stability-253"><a href="#assess_feature_stability-253"><span class="linenos">253</span></a>    <span class="n">incremental_ecs_list</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="assess_feature_stability-254"><a href="#assess_feature_stability-254"><span class="linenos">254</span></a>    <span class="n">incremental_ecs_list</span><span class="p">[</span><span class="n">feature_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="assess_feature_stability-255"><a href="#assess_feature_stability-255"><span class="linenos">255</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="assess_feature_stability-256"><a href="#assess_feature_stability-256"><span class="linenos">256</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">steps</span><span class="p">)):</span>
</span><span id="assess_feature_stability-257"><a href="#assess_feature_stability-257"><span class="linenos">257</span></a>            <span class="n">temp_list</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="assess_feature_stability-258"><a href="#assess_feature_stability-258"><span class="linenos">258</span></a>            <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">resolution</span><span class="p">):</span>
</span><span id="assess_feature_stability-259"><a href="#assess_feature_stability-259"><span class="linenos">259</span></a>                <span class="n">temp_list</span><span class="p">[</span><span class="n">res</span><span class="p">]</span> <span class="o">=</span> <span class="n">element_sim_elscore</span><span class="p">(</span>
</span><span id="assess_feature_stability-260"><a href="#assess_feature_stability-260"><span class="linenos">260</span></a>                    <span class="n">steps_ecc_list</span><span class="p">[</span><span class="n">feature_type</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">steps</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])][</span><span class="n">res</span><span class="p">][</span><span class="s1">&#39;most_frequent_partition&#39;</span><span class="p">][</span><span class="s1">&#39;mb&#39;</span><span class="p">],</span>
</span><span id="assess_feature_stability-261"><a href="#assess_feature_stability-261"><span class="linenos">261</span></a>                    <span class="n">steps_ecc_list</span><span class="p">[</span><span class="n">feature_type</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">steps</span><span class="p">[</span><span class="n">i</span><span class="p">])][</span><span class="n">res</span><span class="p">][</span><span class="s1">&#39;most_frequent_partition&#39;</span><span class="p">][</span><span class="s1">&#39;mb&#39;</span><span class="p">]</span>
</span><span id="assess_feature_stability-262"><a href="#assess_feature_stability-262"><span class="linenos">262</span></a>                <span class="p">)</span>
</span><span id="assess_feature_stability-263"><a href="#assess_feature_stability-263"><span class="linenos">263</span></a>
</span><span id="assess_feature_stability-264"><a href="#assess_feature_stability-264"><span class="linenos">264</span></a>            <span class="n">incremental_ecs_list</span><span class="p">[</span><span class="n">feature_type</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">steps</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">steps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_list</span>
</span><span id="assess_feature_stability-265"><a href="#assess_feature_stability-265"><span class="linenos">265</span></a>            
</span><span id="assess_feature_stability-266"><a href="#assess_feature_stability-266"><span class="linenos">266</span></a>    <span class="k">return</span> <span class="p">{</span>
</span><span id="assess_feature_stability-267"><a href="#assess_feature_stability-267"><span class="linenos">267</span></a>        <span class="s1">&#39;pca_list&#39;</span><span class="p">:</span> <span class="n">pca_list</span><span class="p">,</span>
</span><span id="assess_feature_stability-268"><a href="#assess_feature_stability-268"><span class="linenos">268</span></a>        <span class="s1">&#39;embedding_list&#39;</span><span class="p">:</span> <span class="n">embedding_list</span><span class="p">,</span>
</span><span id="assess_feature_stability-269"><a href="#assess_feature_stability-269"><span class="linenos">269</span></a>        <span class="s1">&#39;steps_ecc_list&#39;</span><span class="p">:</span> <span class="n">steps_ecc_list</span><span class="p">,</span>
</span><span id="assess_feature_stability-270"><a href="#assess_feature_stability-270"><span class="linenos">270</span></a>        <span class="s1">&#39;incremental_ecs_list&#39;</span><span class="p">:</span> <span class="n">incremental_ecs_list</span>
</span><span id="assess_feature_stability-271"><a href="#assess_feature_stability-271"><span class="linenos">271</span></a>    <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Assess the stability for configurations of feature types and size. Evaluate the stability of clusterings obtained based on incremental subsets of a given feature set.</p>

<p>The algorithm assumes that the feature_set is already sorted when performing the subsetting. For example, if the user wants to analyze highly variable feature set, they should provide them sorted by their variability.</p>

<h3 id="args">Args:</h3>

<pre><code>data_matrix (pandas.DataFrame): A data matrix with rows as cells and columns as features.
feature_set (list): A list of features feature names that can be found on the rownames of the data matrix.
steps (list): A list of integers containing the sizes of the subsets.
feature_type (str): A name associated to the feature_set (e.g. HV - for highly variable genes).
resolution (list): A list of resolutions to be used for clustering.
ncores (int): The number of cores to be used for parallel processing.
n_repetitions (int): The number of repetitions of applying the pipeline with different seeds; ignored if seed_sequence is provided by the user.
seed_sequence (int array): A custom seed sequence; if the value is None, the sequence will be built starting from 1 with a step of 100.
graph_reduction_type (str): The graph reduction type, denoting if the graph should be built on either the PCA or the UMAP embedding.
npcs (int): The number of principal components.
ecs_thresh (float): The ECS threshold used for merging similar clusterings.
algorithm (str): The community detection algorithm to be used: 'louvain', or 'leiden'. Default and recommended is 'leiden'.
umap_arguments (dict): A dictionary containing the arguments to be passed to the UMAP function.
warnings_verbose (bool): Whether to print warnings or not.
flavor (str): The implementation of the graph clustering algorithm to be used. Default is 'default'. You can also use 'igraph'.
</code></pre>

<h3 id="raises">Raises:</h3>

<pre><code>ValueError: If data_matrix is not a pandas DataFrame.
ValueError: If feature_set is not a list or tuple of strings, or contains elements not in data_matrix.
ValueError: If any feature in feature_set is not found in data_matrix columns.
ValueError: If steps is not an integer or a list/tuple of integers.
ValueError: If feature_type is not a string.
ValueError: If resolution is not a list or tuple of floats.
ValueError: If n_repetitions is not an integer.
ValueError: If graph_reduction_type is not 'PCA' or 'UMAP'.
ValueError: If npcs is not an integer.
ValueError: If ecs_thresh is not a numeric value.
ValueError: If algorithm is not 'louvain' or 'leiden'.
ValueError: If flavor is not 'default' or 'igraph'.
</code></pre>

<h3 id="returns">Returns:</h3>

<pre><code># dict: A dictionary with the following structure:
#     - pca_list (dict): PCA embeddings for each step.
#     - embedding_list (dict): UMAP embeddings for each step.
#     - steps_ecc_list (dict): Contains the element consistency scores for each step and resolution, with each entry as follows:
#             - ecc (float): The element consistency score for the corresponding step.
#             - most_frequent_partition (dict): Information about the partition with the highest frequency:
#                 - mb (list): The partition with the highest frequency.
#                 - freq (int): The frequency of the most frequent partition.
#                 - seed (int): The seed used for the most frequent partition.
#             - n_different_partitions (int): The number of different partitions obtained for the corresponding step.
#     - incremental_ecs_list (dict): Incremental element consistency scores for each step and resolution.
</code></pre>

<h3 id="example">Example:</h3>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ClustAssessPy</span> <span class="k">as</span> <span class="nn">ca</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Generate a random data matrix</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_matrix</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;gene_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]</span> 
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Define the feature set</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">feature_set</span> <span class="o">=</span> <span class="n">data_matrix</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Define the steps</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">steps</span> <span class="o">=</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1500</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Define the resolutions</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">resolution</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Assess the feature stability</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">feature_stability_results</span> <span class="o">=</span> <span class="n">ca</span><span class="o">.</span><span class="n">assess_feature_stability</span><span class="p">(</span><span class="n">data_matrix</span><span class="p">,</span> <span class="n">feature_set</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">n_repetitions</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>  <span class="n">graph_reduction_type</span><span class="o">=</span><span class="s2">&quot;PCA&quot;</span><span class="p">,</span> <span class="n">npcs</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;leiden&#39;</span><span class="p">)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="assess_clustering_stability">
                            <input id="assess_clustering_stability-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">assess_clustering_stability</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">graph_adjacency_matrix</span>,</span><span class="param">	<span class="n">resolution</span>,</span><span class="param">	<span class="n">ncores</span>,</span><span class="param">	<span class="n">n_repetitions</span><span class="o">=</span><span class="mi">100</span>,</span><span class="param">	<span class="n">seed_sequence</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">ecs_thresh</span><span class="o">=</span><span class="mi">1</span>,</span><span class="param">	<span class="n">algorithms</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;louvain&#39;</span><span class="p">,</span> <span class="s1">&#39;leiden&#39;</span><span class="p">]</span>,</span><span class="param">	<span class="n">flavor</span><span class="o">=</span><span class="s1">&#39;default&#39;</span>,</span><span class="param">	<span class="n">show_warnings</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="assess_clustering_stability-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#assess_clustering_stability"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="assess_clustering_stability-70"><a href="#assess_clustering_stability-70"><span class="linenos"> 70</span></a><span class="k">def</span> <span class="nf">assess_clustering_stability</span><span class="p">(</span><span class="n">graph_adjacency_matrix</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">ncores</span><span class="p">,</span>
</span><span id="assess_clustering_stability-71"><a href="#assess_clustering_stability-71"><span class="linenos"> 71</span></a>                                <span class="n">n_repetitions</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
</span><span id="assess_clustering_stability-72"><a href="#assess_clustering_stability-72"><span class="linenos"> 72</span></a>                                <span class="n">seed_sequence</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ecs_thresh</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="assess_clustering_stability-73"><a href="#assess_clustering_stability-73"><span class="linenos"> 73</span></a>                                <span class="n">algorithms</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;louvain&#39;</span><span class="p">,</span> <span class="s1">&#39;leiden&#39;</span><span class="p">],</span>
</span><span id="assess_clustering_stability-74"><a href="#assess_clustering_stability-74"><span class="linenos"> 74</span></a>                                <span class="n">flavor</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="n">show_warnings</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="assess_clustering_stability-75"><a href="#assess_clustering_stability-75"><span class="linenos"> 75</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="assess_clustering_stability-76"><a href="#assess_clustering_stability-76"><span class="linenos"> 76</span></a><span class="sd">    Evaluates the stability of different graph clustering methods in the clustering pipeline. </span>
</span><span id="assess_clustering_stability-77"><a href="#assess_clustering_stability-77"><span class="linenos"> 77</span></a><span class="sd">    The method will iterate through different values of the resolution parameter and compare, using the EC Consistency score, the partitions obtained at different seeds.</span>
</span><span id="assess_clustering_stability-78"><a href="#assess_clustering_stability-78"><span class="linenos"> 78</span></a><span class="sd">    </span>
</span><span id="assess_clustering_stability-79"><a href="#assess_clustering_stability-79"><span class="linenos"> 79</span></a><span class="sd">    ### Args:</span>
</span><span id="assess_clustering_stability-80"><a href="#assess_clustering_stability-80"><span class="linenos"> 80</span></a><span class="sd">        graph_adjacency_matrix (pandas.DataFrame): A data matrix with rows as cells and columns as features.</span>
</span><span id="assess_clustering_stability-81"><a href="#assess_clustering_stability-81"><span class="linenos"> 81</span></a><span class="sd">        resolution (list): A list of resolutions to be used for clustering.</span>
</span><span id="assess_clustering_stability-82"><a href="#assess_clustering_stability-82"><span class="linenos"> 82</span></a><span class="sd">        ncores (int): The number of cores to be used for parallel processing.</span>
</span><span id="assess_clustering_stability-83"><a href="#assess_clustering_stability-83"><span class="linenos"> 83</span></a><span class="sd">        n_repetitions (int): The number of repetitions of applying the pipeline with different seeds; ignored if seed_sequence is provided by the user.</span>
</span><span id="assess_clustering_stability-84"><a href="#assess_clustering_stability-84"><span class="linenos"> 84</span></a><span class="sd">        seed_sequence (int array): A custom seed sequence; if the value is None, the sequence will be built starting from 1 with a step of 100.</span>
</span><span id="assess_clustering_stability-85"><a href="#assess_clustering_stability-85"><span class="linenos"> 85</span></a><span class="sd">        ecs_thresh (float): The ECS threshold used for merging similar clusterings.</span>
</span><span id="assess_clustering_stability-86"><a href="#assess_clustering_stability-86"><span class="linenos"> 86</span></a><span class="sd">        algorithms (str array): The community detection algorithm to be used: [&#39;louvain&#39;], or [&#39;leiden&#39;], or both [&#39;louvain&#39;, &#39;leiden&#39;].</span>
</span><span id="assess_clustering_stability-87"><a href="#assess_clustering_stability-87"><span class="linenos"> 87</span></a><span class="sd">        flavor (str): The implementation of the graph clustering algorithm to be used. Default is &#39;default&#39;. You can also use &#39;igraph&#39;.</span>
</span><span id="assess_clustering_stability-88"><a href="#assess_clustering_stability-88"><span class="linenos"> 88</span></a><span class="sd">    </span>
</span><span id="assess_clustering_stability-89"><a href="#assess_clustering_stability-89"><span class="linenos"> 89</span></a><span class="sd">    ### Raises:</span>
</span><span id="assess_clustering_stability-90"><a href="#assess_clustering_stability-90"><span class="linenos"> 90</span></a><span class="sd">        ValueError: If resolution is not a list or tuple of floats.</span>
</span><span id="assess_clustering_stability-91"><a href="#assess_clustering_stability-91"><span class="linenos"> 91</span></a><span class="sd">        ValueError: If n_repetitions is not an integer.</span>
</span><span id="assess_clustering_stability-92"><a href="#assess_clustering_stability-92"><span class="linenos"> 92</span></a><span class="sd">        ValueError: If ecs_thresh is not a numeric value.</span>
</span><span id="assess_clustering_stability-93"><a href="#assess_clustering_stability-93"><span class="linenos"> 93</span></a><span class="sd">        ValueError: If algorithm is not &#39;louvain&#39; or &#39;leiden&#39;.</span>
</span><span id="assess_clustering_stability-94"><a href="#assess_clustering_stability-94"><span class="linenos"> 94</span></a><span class="sd">        ValueError: If flavor is not &#39;default&#39; or &#39;igraph&#39;.</span>
</span><span id="assess_clustering_stability-95"><a href="#assess_clustering_stability-95"><span class="linenos"> 95</span></a><span class="sd">        </span>
</span><span id="assess_clustering_stability-96"><a href="#assess_clustering_stability-96"><span class="linenos"> 96</span></a><span class="sd">    ### Returns:</span>
</span><span id="assess_clustering_stability-97"><a href="#assess_clustering_stability-97"><span class="linenos"> 97</span></a><span class="sd">        # dict: A dictionary with the following structure:</span>
</span><span id="assess_clustering_stability-98"><a href="#assess_clustering_stability-98"><span class="linenos"> 98</span></a><span class="sd">        #     - split_by_resolution (dict): Stability results when evaluating the clustering stability by resolution. </span>
</span><span id="assess_clustering_stability-99"><a href="#assess_clustering_stability-99"><span class="linenos"> 99</span></a><span class="sd">        #     - split_by_k (dict): Stability results when evaluating the clustering stability by the number of clusters (k). </span>
</span><span id="assess_clustering_stability-100"><a href="#assess_clustering_stability-100"><span class="linenos">100</span></a><span class="sd">    </span>
</span><span id="assess_clustering_stability-101"><a href="#assess_clustering_stability-101"><span class="linenos">101</span></a><span class="sd">    Example:</span>
</span><span id="assess_clustering_stability-102"><a href="#assess_clustering_stability-102"><span class="linenos">102</span></a><span class="sd">    &gt;&gt;&gt; import numpy as np</span>
</span><span id="assess_clustering_stability-103"><a href="#assess_clustering_stability-103"><span class="linenos">103</span></a><span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
</span><span id="assess_clustering_stability-104"><a href="#assess_clustering_stability-104"><span class="linenos">104</span></a><span class="sd">    &gt;&gt;&gt; import ClustAssessPy as ca</span>
</span><span id="assess_clustering_stability-105"><a href="#assess_clustering_stability-105"><span class="linenos">105</span></a><span class="sd">    &gt;&gt;&gt; # Create a PCA embedding.</span>
</span><span id="assess_clustering_stability-106"><a href="#assess_clustering_stability-106"><span class="linenos">106</span></a><span class="sd">    &gt;&gt;&gt; pca_emb = np.random.uniform(low=0.0, high=1.0, size=(100, 30))</span>
</span><span id="assess_clustering_stability-107"><a href="#assess_clustering_stability-107"><span class="linenos">107</span></a><span class="sd">    &gt;&gt;&gt; pca_emb_df = pd.DataFrame(pca_emb, index=map(str, range(1, 101)), columns=[&quot;PCA_&quot; + str(i) for i in range(1, 31)])</span>
</span><span id="assess_clustering_stability-108"><a href="#assess_clustering_stability-108"><span class="linenos">108</span></a><span class="sd">    &gt;&gt;&gt; # Get SNN matrix from pca using 20 neighbours</span>
</span><span id="assess_clustering_stability-109"><a href="#assess_clustering_stability-109"><span class="linenos">109</span></a><span class="sd">    &gt;&gt;&gt; adj_mat = ca.get_adjacency_matrix_wrapper(pca_emb_df, n_neighs=20)[&#39;snn&#39;]</span>
</span><span id="assess_clustering_stability-110"><a href="#assess_clustering_stability-110"><span class="linenos">110</span></a><span class="sd">    &gt;&gt;&gt; clust_stability = ca.assess_clustering_stability(adj_mat, resolution=[0.1, 0.3, 0.5, 0.7, 0.9], n_repetitions=10, algorithms=[&#39;louvain&#39;,&#39;leiden&#39;])</span>
</span><span id="assess_clustering_stability-111"><a href="#assess_clustering_stability-111"><span class="linenos">111</span></a><span class="sd">    &gt;&gt;&gt; # ------------------------------------------------</span>
</span><span id="assess_clustering_stability-112"><a href="#assess_clustering_stability-112"><span class="linenos">112</span></a><span class="sd">    &gt;&gt;&gt; # ALTERNATIVELY WITH SCANPY - assuming you have an adata object</span>
</span><span id="assess_clustering_stability-113"><a href="#assess_clustering_stability-113"><span class="linenos">113</span></a><span class="sd">    &gt;&gt;&gt; # ------------------------------------------------</span>
</span><span id="assess_clustering_stability-114"><a href="#assess_clustering_stability-114"><span class="linenos">114</span></a><span class="sd">    &gt;&gt;&gt; import scanpy as sc</span>
</span><span id="assess_clustering_stability-115"><a href="#assess_clustering_stability-115"><span class="linenos">115</span></a><span class="sd">    &gt;&gt;&gt; sc.pp.neighbors(adata, n_neighbors=20)</span>
</span><span id="assess_clustering_stability-116"><a href="#assess_clustering_stability-116"><span class="linenos">116</span></a><span class="sd">    &gt;&gt;&gt; adj_mat = adata.obsp[&#39;connectivities&#39;]</span>
</span><span id="assess_clustering_stability-117"><a href="#assess_clustering_stability-117"><span class="linenos">117</span></a><span class="sd">    &gt;&gt;&gt; clust_stability = ca.assess_clustering_stability(adj_mat, resolution=[0.1, 0.3, 0.5, 0.7, 0.9], n_repetitions=10, algorithms=[&#39;louvain&#39;,&#39;leiden&#39;]) </span>
</span><span id="assess_clustering_stability-118"><a href="#assess_clustering_stability-118"><span class="linenos">118</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="assess_clustering_stability-119"><a href="#assess_clustering_stability-119"><span class="linenos">119</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">show_warnings</span><span class="p">:</span>
</span><span id="assess_clustering_stability-120"><a href="#assess_clustering_stability-120"><span class="linenos">120</span></a>        <span class="k">if</span> <span class="s1">&#39;leiden&#39;</span> <span class="ow">in</span> <span class="n">algorithms</span><span class="p">:</span>
</span><span id="assess_clustering_stability-121"><a href="#assess_clustering_stability-121"><span class="linenos">121</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FutureWarnings (caused by ScanPy for Leiden) will be suppressed. Set show_warnings=True to see them.&quot;</span><span class="p">)</span>
</span><span id="assess_clustering_stability-122"><a href="#assess_clustering_stability-122"><span class="linenos">122</span></a>         
</span><span id="assess_clustering_stability-123"><a href="#assess_clustering_stability-123"><span class="linenos">123</span></a>    <span class="c1"># Convert adjacency matrix to csr_matrix if it&#39;s not already</span>
</span><span id="assess_clustering_stability-124"><a href="#assess_clustering_stability-124"><span class="linenos">124</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">graph_adjacency_matrix</span><span class="p">,</span> <span class="n">csr_matrix</span><span class="p">):</span>
</span><span id="assess_clustering_stability-125"><a href="#assess_clustering_stability-125"><span class="linenos">125</span></a>        <span class="n">graph_adjacency_matrix</span> <span class="o">=</span> <span class="n">csr_matrix</span><span class="p">(</span><span class="n">graph_adjacency_matrix</span><span class="p">)</span>
</span><span id="assess_clustering_stability-126"><a href="#assess_clustering_stability-126"><span class="linenos">126</span></a>    
</span><span id="assess_clustering_stability-127"><a href="#assess_clustering_stability-127"><span class="linenos">127</span></a>    <span class="n">_validate_parameters_clustering_stability</span><span class="p">(</span><span class="n">resolution</span><span class="p">,</span> <span class="n">n_repetitions</span><span class="p">,</span> <span class="n">ecs_thresh</span><span class="p">,</span> <span class="n">algorithms</span><span class="p">,</span> <span class="n">flavor</span><span class="p">,</span> <span class="n">ncores</span><span class="p">)</span>
</span><span id="assess_clustering_stability-128"><a href="#assess_clustering_stability-128"><span class="linenos">128</span></a>        
</span><span id="assess_clustering_stability-129"><a href="#assess_clustering_stability-129"><span class="linenos">129</span></a>    <span class="k">if</span> <span class="n">seed_sequence</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="assess_clustering_stability-130"><a href="#assess_clustering_stability-130"><span class="linenos">130</span></a>        <span class="n">seed_sequence</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_repetitions</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="assess_clustering_stability-131"><a href="#assess_clustering_stability-131"><span class="linenos">131</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="assess_clustering_stability-132"><a href="#assess_clustering_stability-132"><span class="linenos">132</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seed_sequence</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
</span><span id="assess_clustering_stability-133"><a href="#assess_clustering_stability-133"><span class="linenos">133</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;seed_sequence parameter should be numeric&quot;</span><span class="p">)</span>
</span><span id="assess_clustering_stability-134"><a href="#assess_clustering_stability-134"><span class="linenos">134</span></a>        <span class="n">seed_sequence</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">seed_sequence</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="assess_clustering_stability-135"><a href="#assess_clustering_stability-135"><span class="linenos">135</span></a>        
</span><span id="assess_clustering_stability-136"><a href="#assess_clustering_stability-136"><span class="linenos">136</span></a>    <span class="n">result_object</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="assess_clustering_stability-137"><a href="#assess_clustering_stability-137"><span class="linenos">137</span></a>
</span><span id="assess_clustering_stability-138"><a href="#assess_clustering_stability-138"><span class="linenos">138</span></a>    <span class="n">adata</span> <span class="o">=</span> <span class="n">AnnData</span><span class="p">(</span><span class="n">graph_adjacency_matrix</span><span class="p">)</span>
</span><span id="assess_clustering_stability-139"><a href="#assess_clustering_stability-139"><span class="linenos">139</span></a>    
</span><span id="assess_clustering_stability-140"><a href="#assess_clustering_stability-140"><span class="linenos">140</span></a>    <span class="k">for</span> <span class="n">alg</span> <span class="ow">in</span> <span class="n">algorithms</span><span class="p">:</span> 
</span><span id="assess_clustering_stability-141"><a href="#assess_clustering_stability-141"><span class="linenos">141</span></a>        <span class="n">result_object</span><span class="p">[</span><span class="n">alg</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="assess_clustering_stability-142"><a href="#assess_clustering_stability-142"><span class="linenos">142</span></a>        
</span><span id="assess_clustering_stability-143"><a href="#assess_clustering_stability-143"><span class="linenos">143</span></a>        <span class="k">with</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ProcessPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span> <span class="o">=</span> <span class="n">ncores</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
</span><span id="assess_clustering_stability-144"><a href="#assess_clustering_stability-144"><span class="linenos">144</span></a>            <span class="n">futures</span> <span class="o">=</span> <span class="p">{</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">_evaluate_clustering_resolution</span><span class="p">,</span> <span class="n">graph_adjacency_matrix</span><span class="p">,</span> <span class="n">adata</span><span class="p">,</span> <span class="n">alg</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">seed_sequence</span><span class="p">,</span> <span class="n">ncores</span><span class="p">,</span> <span class="n">ecs_thresh</span><span class="p">,</span> <span class="n">flavor</span><span class="p">,</span> <span class="n">show_warnings</span><span class="p">):</span><span class="n">res</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">resolution</span><span class="p">}</span>
</span><span id="assess_clustering_stability-145"><a href="#assess_clustering_stability-145"><span class="linenos">145</span></a>
</span><span id="assess_clustering_stability-146"><a href="#assess_clustering_stability-146"><span class="linenos">146</span></a>        <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(</span><span class="n">futures</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="assess_clustering_stability-147"><a href="#assess_clustering_stability-147"><span class="linenos">147</span></a>            <span class="n">res</span> <span class="o">=</span> <span class="n">futures</span><span class="p">[</span><span class="n">future</span><span class="p">]</span>
</span><span id="assess_clustering_stability-148"><a href="#assess_clustering_stability-148"><span class="linenos">148</span></a>            <span class="n">result_object</span><span class="p">[</span><span class="n">alg</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">)]</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span><span id="assess_clustering_stability-149"><a href="#assess_clustering_stability-149"><span class="linenos">149</span></a>            
</span><span id="assess_clustering_stability-150"><a href="#assess_clustering_stability-150"><span class="linenos">150</span></a>    <span class="n">algorithm_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">result_object</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="assess_clustering_stability-151"><a href="#assess_clustering_stability-151"><span class="linenos">151</span></a>    <span class="n">split_by_k</span> <span class="o">=</span> <span class="p">{</span><span class="n">alg_name</span><span class="p">:</span> <span class="n">merge_resolutions</span><span class="p">(</span><span class="n">result_object</span><span class="p">[</span><span class="n">alg_name</span><span class="p">])</span> <span class="k">for</span> <span class="n">alg_name</span> <span class="ow">in</span> <span class="n">algorithm_names</span> <span class="k">if</span> <span class="n">alg_name</span> <span class="ow">in</span> <span class="n">result_object</span><span class="p">}</span>
</span><span id="assess_clustering_stability-152"><a href="#assess_clustering_stability-152"><span class="linenos">152</span></a>
</span><span id="assess_clustering_stability-153"><a href="#assess_clustering_stability-153"><span class="linenos">153</span></a>    <span class="k">return</span> <span class="p">{</span>
</span><span id="assess_clustering_stability-154"><a href="#assess_clustering_stability-154"><span class="linenos">154</span></a>        <span class="s1">&#39;split_by_resolution&#39;</span><span class="p">:</span> <span class="n">result_object</span><span class="p">,</span>
</span><span id="assess_clustering_stability-155"><a href="#assess_clustering_stability-155"><span class="linenos">155</span></a>        <span class="s1">&#39;split_by_k&#39;</span><span class="p">:</span> <span class="n">split_by_k</span>
</span><span id="assess_clustering_stability-156"><a href="#assess_clustering_stability-156"><span class="linenos">156</span></a>    <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Evaluates the stability of different graph clustering methods in the clustering pipeline. 
The method will iterate through different values of the resolution parameter and compare, using the EC Consistency score, the partitions obtained at different seeds.</p>

<h3 id="args">Args:</h3>

<pre><code>graph_adjacency_matrix (pandas.DataFrame): A data matrix with rows as cells and columns as features.
resolution (list): A list of resolutions to be used for clustering.
ncores (int): The number of cores to be used for parallel processing.
n_repetitions (int): The number of repetitions of applying the pipeline with different seeds; ignored if seed_sequence is provided by the user.
seed_sequence (int array): A custom seed sequence; if the value is None, the sequence will be built starting from 1 with a step of 100.
ecs_thresh (float): The ECS threshold used for merging similar clusterings.
algorithms (str array): The community detection algorithm to be used: ['louvain'], or ['leiden'], or both ['louvain', 'leiden'].
flavor (str): The implementation of the graph clustering algorithm to be used. Default is 'default'. You can also use 'igraph'.
</code></pre>

<h3 id="raises">Raises:</h3>

<pre><code>ValueError: If resolution is not a list or tuple of floats.
ValueError: If n_repetitions is not an integer.
ValueError: If ecs_thresh is not a numeric value.
ValueError: If algorithm is not 'louvain' or 'leiden'.
ValueError: If flavor is not 'default' or 'igraph'.
</code></pre>

<h3 id="returns">Returns:</h3>

<pre><code># dict: A dictionary with the following structure:
#     - split_by_resolution (dict): Stability results when evaluating the clustering stability by resolution. 
#     - split_by_k (dict): Stability results when evaluating the clustering stability by the number of clusters (k).
</code></pre>

<p>Example:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ClustAssessPy</span> <span class="k">as</span> <span class="nn">ca</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Create a PCA embedding.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pca_emb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pca_emb_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pca_emb</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">101</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PCA_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">31</span><span class="p">)])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Get SNN matrix from pca using 20 neighbours</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">adj_mat</span> <span class="o">=</span> <span class="n">ca</span><span class="o">.</span><span class="n">get_adjacency_matrix_wrapper</span><span class="p">(</span><span class="n">pca_emb_df</span><span class="p">,</span> <span class="n">n_neighs</span><span class="o">=</span><span class="mi">20</span><span class="p">)[</span><span class="s1">&#39;snn&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">clust_stability</span> <span class="o">=</span> <span class="n">ca</span><span class="o">.</span><span class="n">assess_clustering_stability</span><span class="p">(</span><span class="n">adj_mat</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">],</span> <span class="n">n_repetitions</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">algorithms</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;louvain&#39;</span><span class="p">,</span><span class="s1">&#39;leiden&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># ------------------------------------------------</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># ALTERNATIVELY WITH SCANPY - assuming you have an adata object</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># ------------------------------------------------</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">scanpy</span> <span class="k">as</span> <span class="nn">sc</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sc</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">adj_mat</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">obsp</span><span class="p">[</span><span class="s1">&#39;connectivities&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">clust_stability</span> <span class="o">=</span> <span class="n">ca</span><span class="o">.</span><span class="n">assess_clustering_stability</span><span class="p">(</span><span class="n">adj_mat</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">],</span> <span class="n">n_repetitions</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">algorithms</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;louvain&#39;</span><span class="p">,</span><span class="s1">&#39;leiden&#39;</span><span class="p">])</span>
</code></pre>
</div>
</div>


                </section>
                <section id="assess_nn_stability">
                            <input id="assess_nn_stability-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">assess_nn_stability</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">embedding</span>,</span><span class="param">	<span class="n">n_neigh_sequence</span>,</span><span class="param">	<span class="n">ncores</span>,</span><span class="param">	<span class="n">n_repetitions</span><span class="o">=</span><span class="mi">100</span>,</span><span class="param">	<span class="n">seed_sequence</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">graph_reduction_type</span><span class="o">=</span><span class="s1">&#39;PCA&#39;</span>,</span><span class="param">	<span class="n">ecs_thresh</span><span class="o">=</span><span class="mi">1</span>,</span><span class="param">	<span class="n">graph_type</span><span class="o">=</span><span class="mi">1</span>,</span><span class="param">	<span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;leiden&#39;</span>,</span><span class="param">	<span class="n">umap_arguments</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">flavor</span><span class="o">=</span><span class="s1">&#39;default&#39;</span>,</span><span class="param">	<span class="n">show_warnings</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="assess_nn_stability-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#assess_nn_stability"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="assess_nn_stability-185"><a href="#assess_nn_stability-185"><span class="linenos">185</span></a><span class="k">def</span> <span class="nf">assess_nn_stability</span><span class="p">(</span><span class="n">embedding</span><span class="p">,</span> <span class="n">n_neigh_sequence</span><span class="p">,</span> <span class="n">ncores</span><span class="p">,</span> <span class="n">n_repetitions</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">seed_sequence</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="assess_nn_stability-186"><a href="#assess_nn_stability-186"><span class="linenos">186</span></a>                        <span class="n">graph_reduction_type</span> <span class="o">=</span> <span class="s2">&quot;PCA&quot;</span><span class="p">,</span> <span class="n">ecs_thresh</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">graph_type</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">algorithm</span> <span class="o">=</span> <span class="s1">&#39;leiden&#39;</span><span class="p">,</span> <span class="n">umap_arguments</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">flavor</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="n">show_warnings</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="assess_nn_stability-187"><a href="#assess_nn_stability-187"><span class="linenos">187</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="assess_nn_stability-188"><a href="#assess_nn_stability-188"><span class="linenos">188</span></a><span class="sd">    Evaluates clustering stability when changing the values of different parameters involved in the graph building step, namely the base embedding, the graph type and the number of neighbours.</span>
</span><span id="assess_nn_stability-189"><a href="#assess_nn_stability-189"><span class="linenos">189</span></a><span class="sd">    </span>
</span><span id="assess_nn_stability-190"><a href="#assess_nn_stability-190"><span class="linenos">190</span></a><span class="sd">    ### Args:</span>
</span><span id="assess_nn_stability-191"><a href="#assess_nn_stability-191"><span class="linenos">191</span></a><span class="sd">        embedding (np.ndarray or pd.DataFrame): A matrix associated with a PCA embedding. Embeddings from other dimensionality reduction techniques can be used.</span>
</span><span id="assess_nn_stability-192"><a href="#assess_nn_stability-192"><span class="linenos">192</span></a><span class="sd">        n_neigh_sequence (int array): An integer array of the number of nearest neighbours.</span>
</span><span id="assess_nn_stability-193"><a href="#assess_nn_stability-193"><span class="linenos">193</span></a><span class="sd">        ncores (int): The number of cores to be used for parallel processing.</span>
</span><span id="assess_nn_stability-194"><a href="#assess_nn_stability-194"><span class="linenos">194</span></a><span class="sd">        n_repetitions (int): The number of repetitions of applying the pipeline with different seeds; ignored if seed_sequence is provided by the user.</span>
</span><span id="assess_nn_stability-195"><a href="#assess_nn_stability-195"><span class="linenos">195</span></a><span class="sd">        seed_sequence (int array): A custom seed sequence; if the value is None, the sequence will be built starting from 1 with a step of 100.</span>
</span><span id="assess_nn_stability-196"><a href="#assess_nn_stability-196"><span class="linenos">196</span></a><span class="sd">        graph_reduction_type (str): The graph reduction type, denoting if the graph should be built on either the PCA or the UMAP embedding.</span>
</span><span id="assess_nn_stability-197"><a href="#assess_nn_stability-197"><span class="linenos">197</span></a><span class="sd">        ecs_thresh (float): The ECS threshold used for merging similar clusterings.</span>
</span><span id="assess_nn_stability-198"><a href="#assess_nn_stability-198"><span class="linenos">198</span></a><span class="sd">        graph_type (int): Argument indicating whether the graph should be NN (0), SNN (1) or both (2).</span>
</span><span id="assess_nn_stability-199"><a href="#assess_nn_stability-199"><span class="linenos">199</span></a><span class="sd">        algorithm (str): The community detection algorithm to be used: &#39;louvain&#39;, or &#39;leiden&#39;. Default and recommended is &#39;leiden&#39;.</span>
</span><span id="assess_nn_stability-200"><a href="#assess_nn_stability-200"><span class="linenos">200</span></a><span class="sd">        umap_arguments (dict): Arguments to be used in UMAP construction. Used when graph_reduction_type = &quot;UMAP&quot;.</span>
</span><span id="assess_nn_stability-201"><a href="#assess_nn_stability-201"><span class="linenos">201</span></a><span class="sd">        flavor (str): The implementation of the graph clustering algorithm to be used. Default is &#39;default&#39;. You can also use &#39;igraph&#39;.</span>
</span><span id="assess_nn_stability-202"><a href="#assess_nn_stability-202"><span class="linenos">202</span></a><span class="sd">    </span>
</span><span id="assess_nn_stability-203"><a href="#assess_nn_stability-203"><span class="linenos">203</span></a><span class="sd">    ### Raises:</span>
</span><span id="assess_nn_stability-204"><a href="#assess_nn_stability-204"><span class="linenos">204</span></a><span class="sd">        ValueError: If embedding is not a numpy array or pandas DataFrame.</span>
</span><span id="assess_nn_stability-205"><a href="#assess_nn_stability-205"><span class="linenos">205</span></a><span class="sd">        ValueError: If n_neigh_sequence is not a list or np.ndarray.</span>
</span><span id="assess_nn_stability-206"><a href="#assess_nn_stability-206"><span class="linenos">206</span></a><span class="sd">        ValueError: If n_repetitions is not an integer.</span>
</span><span id="assess_nn_stability-207"><a href="#assess_nn_stability-207"><span class="linenos">207</span></a><span class="sd">        ValueError: If graph_reduction_type is not &#39;PCA&#39; or &#39;UMAP&#39;.</span>
</span><span id="assess_nn_stability-208"><a href="#assess_nn_stability-208"><span class="linenos">208</span></a><span class="sd">        ValueError: If ecs_thresh is not an integer or a float.</span>
</span><span id="assess_nn_stability-209"><a href="#assess_nn_stability-209"><span class="linenos">209</span></a><span class="sd">        ValueError: If graph_type is not an array of integers or if it contain values not between 0 and 2.</span>
</span><span id="assess_nn_stability-210"><a href="#assess_nn_stability-210"><span class="linenos">210</span></a><span class="sd">        ValueError: If algorithm is not &#39;louvain&#39; or &#39;leiden&#39;.</span>
</span><span id="assess_nn_stability-211"><a href="#assess_nn_stability-211"><span class="linenos">211</span></a><span class="sd">        ValueError: If flavor is not &#39;default&#39; or &#39;igraph&#39;.</span>
</span><span id="assess_nn_stability-212"><a href="#assess_nn_stability-212"><span class="linenos">212</span></a><span class="sd">    </span>
</span><span id="assess_nn_stability-213"><a href="#assess_nn_stability-213"><span class="linenos">213</span></a><span class="sd">    ### Returns:</span>
</span><span id="assess_nn_stability-214"><a href="#assess_nn_stability-214"><span class="linenos">214</span></a><span class="sd">        # dict: A dictionary with the following structure:</span>
</span><span id="assess_nn_stability-215"><a href="#assess_nn_stability-215"><span class="linenos">215</span></a><span class="sd">        #     n_neigh_k_corresp (dict): A dict containing the number of the clusters obtained by running the pipeline multiple times with different seed, number of neighbors and graph type (weighted vs unweigted).</span>
</span><span id="assess_nn_stability-216"><a href="#assess_nn_stability-216"><span class="linenos">216</span></a><span class="sd">        #     n_neigh_ec_consistency (dict): A dict containing the EC consistency of the partitions obtained at multiple runs when changing the number of neighbors or the graph type.</span>
</span><span id="assess_nn_stability-217"><a href="#assess_nn_stability-217"><span class="linenos">217</span></a><span class="sd">        #     n_different_partitions (dict): The number of different partitions obtained by each number of neighbors.</span>
</span><span id="assess_nn_stability-218"><a href="#assess_nn_stability-218"><span class="linenos">218</span></a><span class="sd">    </span>
</span><span id="assess_nn_stability-219"><a href="#assess_nn_stability-219"><span class="linenos">219</span></a><span class="sd">    ### Example:</span>
</span><span id="assess_nn_stability-220"><a href="#assess_nn_stability-220"><span class="linenos">220</span></a><span class="sd">    &gt;&gt;&gt; import numpy as np</span>
</span><span id="assess_nn_stability-221"><a href="#assess_nn_stability-221"><span class="linenos">221</span></a><span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
</span><span id="assess_nn_stability-222"><a href="#assess_nn_stability-222"><span class="linenos">222</span></a><span class="sd">    &gt;&gt;&gt; import ClustAssessPy as ca</span>
</span><span id="assess_nn_stability-223"><a href="#assess_nn_stability-223"><span class="linenos">223</span></a><span class="sd">    &gt;&gt;&gt; # Create a PCA embedding.</span>
</span><span id="assess_nn_stability-224"><a href="#assess_nn_stability-224"><span class="linenos">224</span></a><span class="sd">    &gt;&gt;&gt; pca_emb = np.random.uniform(low=0.0, high=1.0, size=(100, 30))</span>
</span><span id="assess_nn_stability-225"><a href="#assess_nn_stability-225"><span class="linenos">225</span></a><span class="sd">    &gt;&gt;&gt; pca_emb_df = pd.DataFrame(pca_emb, index=map(str, range(1, 101)), columns=[&quot;PCA_&quot; + str(i) for i in range(1, 31)])</span>
</span><span id="assess_nn_stability-226"><a href="#assess_nn_stability-226"><span class="linenos">226</span></a><span class="sd">    &gt;&gt;&gt; # Assess nn stability using Leiden algorithm</span>
</span><span id="assess_nn_stability-227"><a href="#assess_nn_stability-227"><span class="linenos">227</span></a><span class="sd">    &gt;&gt;&gt; nn_stability_obj_leiden = ca.assess_nn_stability(pca_emb_df, n_neigh_sequence=[10, 15, 20], n_repetitions = 10, graph_reduction_type=&quot;PCA&quot; ,algorithm = &#39;leiden&#39;, graph_type = 2)</span>
</span><span id="assess_nn_stability-228"><a href="#assess_nn_stability-228"><span class="linenos">228</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="assess_nn_stability-229"><a href="#assess_nn_stability-229"><span class="linenos">229</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">show_warnings</span><span class="p">:</span>
</span><span id="assess_nn_stability-230"><a href="#assess_nn_stability-230"><span class="linenos">230</span></a>        <span class="k">if</span> <span class="n">algorithm</span> <span class="o">==</span> <span class="s2">&quot;leiden&quot;</span><span class="p">:</span>
</span><span id="assess_nn_stability-231"><a href="#assess_nn_stability-231"><span class="linenos">231</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FutureWarnings (caused by ScanPy for Leiden) will be suppressed. Set show_warnings=True to see them.&quot;</span><span class="p">)</span>
</span><span id="assess_nn_stability-232"><a href="#assess_nn_stability-232"><span class="linenos">232</span></a>        
</span><span id="assess_nn_stability-233"><a href="#assess_nn_stability-233"><span class="linenos">233</span></a>    <span class="c1"># Validate parameters stability.</span>
</span><span id="assess_nn_stability-234"><a href="#assess_nn_stability-234"><span class="linenos">234</span></a>    <span class="n">_validate_parameters_stability</span><span class="p">(</span><span class="n">n_neigh_sequence</span><span class="p">,</span> <span class="n">n_repetitions</span><span class="p">,</span> <span class="n">ecs_thresh</span><span class="p">,</span> <span class="n">graph_type</span><span class="p">,</span> <span class="n">embedding</span><span class="p">,</span> <span class="n">algorithm</span><span class="p">,</span> <span class="n">graph_reduction_type</span><span class="p">,</span> <span class="n">flavor</span><span class="p">,</span> <span class="n">ncores</span><span class="p">)</span>
</span><span id="assess_nn_stability-235"><a href="#assess_nn_stability-235"><span class="linenos">235</span></a>
</span><span id="assess_nn_stability-236"><a href="#assess_nn_stability-236"><span class="linenos">236</span></a>    <span class="c1"># Convert number of neighbors to integers.</span>
</span><span id="assess_nn_stability-237"><a href="#assess_nn_stability-237"><span class="linenos">237</span></a>    <span class="n">n_neigh_sequence</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">n_neigh_sequence</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="assess_nn_stability-238"><a href="#assess_nn_stability-238"><span class="linenos">238</span></a>
</span><span id="assess_nn_stability-239"><a href="#assess_nn_stability-239"><span class="linenos">239</span></a>    <span class="c1"># convert n_repetitions to integers</span>
</span><span id="assess_nn_stability-240"><a href="#assess_nn_stability-240"><span class="linenos">240</span></a>    <span class="n">n_repetitions</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_repetitions</span><span class="p">)</span>
</span><span id="assess_nn_stability-241"><a href="#assess_nn_stability-241"><span class="linenos">241</span></a>
</span><span id="assess_nn_stability-242"><a href="#assess_nn_stability-242"><span class="linenos">242</span></a>    <span class="n">n_cells</span> <span class="o">=</span> <span class="n">embedding</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="assess_nn_stability-243"><a href="#assess_nn_stability-243"><span class="linenos">243</span></a>    <span class="n">n_neigh_sequence</span> <span class="o">=</span> <span class="n">n_neigh_sequence</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">n_neigh_sequence</span> <span class="o">&lt;</span> <span class="n">n_cells</span><span class="p">)]</span>
</span><span id="assess_nn_stability-244"><a href="#assess_nn_stability-244"><span class="linenos">244</span></a>
</span><span id="assess_nn_stability-245"><a href="#assess_nn_stability-245"><span class="linenos">245</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">n_neigh_sequence</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="assess_nn_stability-246"><a href="#assess_nn_stability-246"><span class="linenos">246</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The provided values for the `n_neigh_sequence` are greater than the number of cells (</span><span class="si">{</span><span class="n">n_cells</span><span class="si">}</span><span class="s2">). For the downstream analysis, we will set `n_neigh` to </span><span class="si">{</span><span class="n">n_cells</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="assess_nn_stability-247"><a href="#assess_nn_stability-247"><span class="linenos">247</span></a>        <span class="n">n_neigh_sequence</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n_cells</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="assess_nn_stability-248"><a href="#assess_nn_stability-248"><span class="linenos">248</span></a>
</span><span id="assess_nn_stability-249"><a href="#assess_nn_stability-249"><span class="linenos">249</span></a>    <span class="c1"># Create a seed sequence if it&#39;s not provided.</span>
</span><span id="assess_nn_stability-250"><a href="#assess_nn_stability-250"><span class="linenos">250</span></a>    <span class="k">if</span> <span class="n">seed_sequence</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="assess_nn_stability-251"><a href="#assess_nn_stability-251"><span class="linenos">251</span></a>        <span class="n">seed_sequence</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_repetitions</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="assess_nn_stability-252"><a href="#assess_nn_stability-252"><span class="linenos">252</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="assess_nn_stability-253"><a href="#assess_nn_stability-253"><span class="linenos">253</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seed_sequence</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
</span><span id="assess_nn_stability-254"><a href="#assess_nn_stability-254"><span class="linenos">254</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;seed_sequence parameter should be numeric&quot;</span><span class="p">)</span>
</span><span id="assess_nn_stability-255"><a href="#assess_nn_stability-255"><span class="linenos">255</span></a>        <span class="n">seed_sequence</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">seed_sequence</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="assess_nn_stability-256"><a href="#assess_nn_stability-256"><span class="linenos">256</span></a>
</span><span id="assess_nn_stability-257"><a href="#assess_nn_stability-257"><span class="linenos">257</span></a>    <span class="k">if</span> <span class="n">graph_reduction_type</span> <span class="o">==</span> <span class="s2">&quot;PCA&quot;</span><span class="p">:</span>
</span><span id="assess_nn_stability-258"><a href="#assess_nn_stability-258"><span class="linenos">258</span></a>        <span class="k">return</span> <span class="n">_assess_nn_stability_pca</span><span class="p">(</span><span class="n">embedding</span><span class="p">,</span> <span class="n">n_neigh_sequence</span><span class="p">,</span> <span class="n">seed_sequence</span><span class="p">,</span> <span class="n">ecs_thresh</span><span class="p">,</span> <span class="n">graph_type</span><span class="p">,</span> <span class="n">algorithm</span><span class="p">,</span> <span class="n">flavor</span><span class="p">,</span> <span class="n">ncores</span><span class="p">,</span> <span class="n">show_warnings</span><span class="p">)</span>
</span><span id="assess_nn_stability-259"><a href="#assess_nn_stability-259"><span class="linenos">259</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="assess_nn_stability-260"><a href="#assess_nn_stability-260"><span class="linenos">260</span></a>        <span class="k">return</span> <span class="n">_assess_nn_stability_umap</span><span class="p">(</span><span class="n">embedding</span><span class="p">,</span> <span class="n">n_neigh_sequence</span><span class="p">,</span> <span class="n">seed_sequence</span><span class="p">,</span> <span class="n">ecs_thresh</span><span class="p">,</span> <span class="n">graph_type</span><span class="p">,</span> <span class="n">algorithm</span><span class="p">,</span> <span class="n">umap_arguments</span><span class="p">,</span> <span class="n">flavor</span><span class="p">,</span> <span class="n">ncores</span><span class="p">,</span> <span class="n">show_warnings</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Evaluates clustering stability when changing the values of different parameters involved in the graph building step, namely the base embedding, the graph type and the number of neighbours.</p>

<h3 id="args">Args:</h3>

<pre><code>embedding (np.ndarray or pd.DataFrame): A matrix associated with a PCA embedding. Embeddings from other dimensionality reduction techniques can be used.
n_neigh_sequence (int array): An integer array of the number of nearest neighbours.
ncores (int): The number of cores to be used for parallel processing.
n_repetitions (int): The number of repetitions of applying the pipeline with different seeds; ignored if seed_sequence is provided by the user.
seed_sequence (int array): A custom seed sequence; if the value is None, the sequence will be built starting from 1 with a step of 100.
graph_reduction_type (str): The graph reduction type, denoting if the graph should be built on either the PCA or the UMAP embedding.
ecs_thresh (float): The ECS threshold used for merging similar clusterings.
graph_type (int): Argument indicating whether the graph should be NN (0), SNN (1) or both (2).
algorithm (str): The community detection algorithm to be used: 'louvain', or 'leiden'. Default and recommended is 'leiden'.
umap_arguments (dict): Arguments to be used in UMAP construction. Used when graph_reduction_type = "UMAP".
flavor (str): The implementation of the graph clustering algorithm to be used. Default is 'default'. You can also use 'igraph'.
</code></pre>

<h3 id="raises">Raises:</h3>

<pre><code>ValueError: If embedding is not a numpy array or pandas DataFrame.
ValueError: If n_neigh_sequence is not a list or np.ndarray.
ValueError: If n_repetitions is not an integer.
ValueError: If graph_reduction_type is not 'PCA' or 'UMAP'.
ValueError: If ecs_thresh is not an integer or a float.
ValueError: If graph_type is not an array of integers or if it contain values not between 0 and 2.
ValueError: If algorithm is not 'louvain' or 'leiden'.
ValueError: If flavor is not 'default' or 'igraph'.
</code></pre>

<h3 id="returns">Returns:</h3>

<pre><code># dict: A dictionary with the following structure:
#     n_neigh_k_corresp (dict): A dict containing the number of the clusters obtained by running the pipeline multiple times with different seed, number of neighbors and graph type (weighted vs unweigted).
#     n_neigh_ec_consistency (dict): A dict containing the EC consistency of the partitions obtained at multiple runs when changing the number of neighbors or the graph type.
#     n_different_partitions (dict): The number of different partitions obtained by each number of neighbors.
</code></pre>

<h3 id="example">Example:</h3>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ClustAssessPy</span> <span class="k">as</span> <span class="nn">ca</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Create a PCA embedding.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pca_emb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pca_emb_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pca_emb</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">101</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PCA_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">31</span><span class="p">)])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Assess nn stability using Leiden algorithm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nn_stability_obj_leiden</span> <span class="o">=</span> <span class="n">ca</span><span class="o">.</span><span class="n">assess_nn_stability</span><span class="p">(</span><span class="n">pca_emb_df</span><span class="p">,</span> <span class="n">n_neigh_sequence</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span> <span class="n">n_repetitions</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">graph_reduction_type</span><span class="o">=</span><span class="s2">&quot;PCA&quot;</span> <span class="p">,</span><span class="n">algorithm</span> <span class="o">=</span> <span class="s1">&#39;leiden&#39;</span><span class="p">,</span> <span class="n">graph_type</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="plot_clustering_overall_stability">
                            <input id="plot_clustering_overall_stability-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_clustering_overall_stability</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">clust_object</span>, </span><span class="param"><span class="n">value_type</span><span class="o">=</span><span class="s1">&#39;k&#39;</span>, </span><span class="param"><span class="n">summary_function</span><span class="o">=&lt;</span><span class="n">function</span> <span class="n">median</span><span class="o">&gt;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="plot_clustering_overall_stability-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#plot_clustering_overall_stability"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="plot_clustering_overall_stability-102"><a href="#plot_clustering_overall_stability-102"><span class="linenos">102</span></a><span class="k">def</span> <span class="nf">plot_clustering_overall_stability</span><span class="p">(</span><span class="n">clust_object</span><span class="p">,</span> <span class="n">value_type</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">summary_function</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">):</span>
</span><span id="plot_clustering_overall_stability-103"><a href="#plot_clustering_overall_stability-103"><span class="linenos">103</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="plot_clustering_overall_stability-104"><a href="#plot_clustering_overall_stability-104"><span class="linenos">104</span></a><span class="sd">    Display EC consistency across clustering method.</span>
</span><span id="plot_clustering_overall_stability-105"><a href="#plot_clustering_overall_stability-105"><span class="linenos">105</span></a><span class="sd">    </span>
</span><span id="plot_clustering_overall_stability-106"><a href="#plot_clustering_overall_stability-106"><span class="linenos">106</span></a><span class="sd">    ### Args:</span>
</span><span id="plot_clustering_overall_stability-107"><a href="#plot_clustering_overall_stability-107"><span class="linenos">107</span></a><span class="sd">        clust_object (dict): The object returned by the `assess_clustering_stability` function.</span>
</span><span id="plot_clustering_overall_stability-108"><a href="#plot_clustering_overall_stability-108"><span class="linenos">108</span></a><span class="sd">        value_type (str): The type of value to be used for grouping the results. Can be either `k` or `resolution`.</span>
</span><span id="plot_clustering_overall_stability-109"><a href="#plot_clustering_overall_stability-109"><span class="linenos">109</span></a><span class="sd">        summary_function (function): The function to be used for summarizing the ECC values.</span>
</span><span id="plot_clustering_overall_stability-110"><a href="#plot_clustering_overall_stability-110"><span class="linenos">110</span></a><span class="sd">        </span>
</span><span id="plot_clustering_overall_stability-111"><a href="#plot_clustering_overall_stability-111"><span class="linenos">111</span></a><span class="sd">    ### Example:</span>
</span><span id="plot_clustering_overall_stability-112"><a href="#plot_clustering_overall_stability-112"><span class="linenos">112</span></a><span class="sd">    &gt;&gt;&gt; pca_emb = np.random.rand(100, 30)</span>
</span><span id="plot_clustering_overall_stability-113"><a href="#plot_clustering_overall_stability-113"><span class="linenos">113</span></a><span class="sd">    &gt;&gt;&gt; # Create an AnnData object from pca_emb</span>
</span><span id="plot_clustering_overall_stability-114"><a href="#plot_clustering_overall_stability-114"><span class="linenos">114</span></a><span class="sd">    &gt;&gt;&gt; adata = sc.AnnData(X=pca_emb)</span>
</span><span id="plot_clustering_overall_stability-115"><a href="#plot_clustering_overall_stability-115"><span class="linenos">115</span></a><span class="sd">    &gt;&gt;&gt; # Run scanpy.pp.neighbors to get the connectivities as an adjacency matrix</span>
</span><span id="plot_clustering_overall_stability-116"><a href="#plot_clustering_overall_stability-116"><span class="linenos">116</span></a><span class="sd">    &gt;&gt;&gt; sc.pp.neighbors(adata, n_neighbors=10, use_rep=&#39;X&#39;)</span>
</span><span id="plot_clustering_overall_stability-117"><a href="#plot_clustering_overall_stability-117"><span class="linenos">117</span></a><span class="sd">    &gt;&gt;&gt; adjacency_matrix = adata.obsp[&#39;connectivities&#39;]</span>
</span><span id="plot_clustering_overall_stability-118"><a href="#plot_clustering_overall_stability-118"><span class="linenos">118</span></a><span class="sd">    &gt;&gt;&gt; clust_obj = assess_clustering_stability(adjacency_matrix, resolution=[0.1, 0.3, 0.5], n_repetitions=10, algorithm=[1,4])</span>
</span><span id="plot_clustering_overall_stability-119"><a href="#plot_clustering_overall_stability-119"><span class="linenos">119</span></a><span class="sd">    &gt;&gt;&gt; plot_k_resolution_corresp(clust_obj)</span>
</span><span id="plot_clustering_overall_stability-120"><a href="#plot_clustering_overall_stability-120"><span class="linenos">120</span></a><span class="sd">    </span>
</span><span id="plot_clustering_overall_stability-121"><a href="#plot_clustering_overall_stability-121"><span class="linenos">121</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="plot_clustering_overall_stability-122"><a href="#plot_clustering_overall_stability-122"><span class="linenos">122</span></a>    <span class="k">if</span> <span class="n">value_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="s2">&quot;resolution&quot;</span><span class="p">]:</span>
</span><span id="plot_clustering_overall_stability-123"><a href="#plot_clustering_overall_stability-123"><span class="linenos">123</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`value_type` should contain either `k` or `resolution`&quot;</span><span class="p">)</span>
</span><span id="plot_clustering_overall_stability-124"><a href="#plot_clustering_overall_stability-124"><span class="linenos">124</span></a>
</span><span id="plot_clustering_overall_stability-125"><a href="#plot_clustering_overall_stability-125"><span class="linenos">125</span></a>    <span class="c1"># Extracting ECC values and applying the summary function</span>
</span><span id="plot_clustering_overall_stability-126"><a href="#plot_clustering_overall_stability-126"><span class="linenos">126</span></a>    <span class="n">ecc_vals</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="plot_clustering_overall_stability-127"><a href="#plot_clustering_overall_stability-127"><span class="linenos">127</span></a>        <span class="n">method</span><span class="p">:</span> <span class="p">{</span>
</span><span id="plot_clustering_overall_stability-128"><a href="#plot_clustering_overall_stability-128"><span class="linenos">128</span></a>            <span class="n">val_type</span><span class="p">:</span> <span class="n">summary_function</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ecc&#39;</span><span class="p">])</span>
</span><span id="plot_clustering_overall_stability-129"><a href="#plot_clustering_overall_stability-129"><span class="linenos">129</span></a>            <span class="k">for</span> <span class="n">val_type</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">alg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="plot_clustering_overall_stability-130"><a href="#plot_clustering_overall_stability-130"><span class="linenos">130</span></a>        <span class="p">}</span>
</span><span id="plot_clustering_overall_stability-131"><a href="#plot_clustering_overall_stability-131"><span class="linenos">131</span></a>        <span class="k">for</span> <span class="n">method</span><span class="p">,</span> <span class="n">alg</span> <span class="ow">in</span> <span class="n">clust_object</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;split_by_</span><span class="si">{</span><span class="n">value_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="plot_clustering_overall_stability-132"><a href="#plot_clustering_overall_stability-132"><span class="linenos">132</span></a>    <span class="p">}</span>
</span><span id="plot_clustering_overall_stability-133"><a href="#plot_clustering_overall_stability-133"><span class="linenos">133</span></a>    
</span><span id="plot_clustering_overall_stability-134"><a href="#plot_clustering_overall_stability-134"><span class="linenos">134</span></a>    <span class="n">melted_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span>
</span><span id="plot_clustering_overall_stability-135"><a href="#plot_clustering_overall_stability-135"><span class="linenos">135</span></a>        <span class="p">{</span><span class="s1">&#39;Method&#39;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span> <span class="n">value_type</span><span class="p">:</span> <span class="n">val_type</span><span class="p">,</span> <span class="s1">&#39;ECC&#39;</span><span class="p">:</span> <span class="n">ecc</span><span class="p">}</span>
</span><span id="plot_clustering_overall_stability-136"><a href="#plot_clustering_overall_stability-136"><span class="linenos">136</span></a>        <span class="k">for</span> <span class="n">method</span><span class="p">,</span> <span class="n">val_types</span> <span class="ow">in</span> <span class="n">ecc_vals</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="plot_clustering_overall_stability-137"><a href="#plot_clustering_overall_stability-137"><span class="linenos">137</span></a>        <span class="k">for</span> <span class="n">val_type</span><span class="p">,</span> <span class="n">ecc</span> <span class="ow">in</span> <span class="n">val_types</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="plot_clustering_overall_stability-138"><a href="#plot_clustering_overall_stability-138"><span class="linenos">138</span></a>    <span class="p">])</span>
</span><span id="plot_clustering_overall_stability-139"><a href="#plot_clustering_overall_stability-139"><span class="linenos">139</span></a>
</span><span id="plot_clustering_overall_stability-140"><a href="#plot_clustering_overall_stability-140"><span class="linenos">140</span></a>    <span class="n">plot</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="plot_clustering_overall_stability-141"><a href="#plot_clustering_overall_stability-141"><span class="linenos">141</span></a>        <span class="n">ggplot</span><span class="p">(</span><span class="n">melted_df</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Method&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;ECC&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;Method&#39;</span><span class="p">))</span> <span class="o">+</span>
</span><span id="plot_clustering_overall_stability-142"><a href="#plot_clustering_overall_stability-142"><span class="linenos">142</span></a>        <span class="n">geom_boxplot</span><span class="p">()</span> <span class="o">+</span>
</span><span id="plot_clustering_overall_stability-143"><a href="#plot_clustering_overall_stability-143"><span class="linenos">143</span></a>        <span class="n">theme_classic</span><span class="p">()</span> <span class="o">+</span>
</span><span id="plot_clustering_overall_stability-144"><a href="#plot_clustering_overall_stability-144"><span class="linenos">144</span></a>        <span class="n">ggtitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Overall clustering stability grouped by </span><span class="si">{</span><span class="n">value_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="plot_clustering_overall_stability-145"><a href="#plot_clustering_overall_stability-145"><span class="linenos">145</span></a>    <span class="p">)</span>
</span><span id="plot_clustering_overall_stability-146"><a href="#plot_clustering_overall_stability-146"><span class="linenos">146</span></a>
</span><span id="plot_clustering_overall_stability-147"><a href="#plot_clustering_overall_stability-147"><span class="linenos">147</span></a>    <span class="k">return</span> <span class="n">plot</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Display EC consistency across clustering method.</p>

<h3 id="args">Args:</h3>

<pre><code>clust_object (dict): The object returned by the `assess_clustering_stability` function.
value_type (str): The type of value to be used for grouping the results. Can be either `k` or `resolution`.
summary_function (function): The function to be used for summarizing the ECC values.
</code></pre>

<h3 id="example">Example:</h3>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">pca_emb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Create an AnnData object from pca_emb</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">adata</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">AnnData</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">pca_emb</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Run scanpy.pp.neighbors to get the connectivities as an adjacency matrix</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sc</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">use_rep</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">adjacency_matrix</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">obsp</span><span class="p">[</span><span class="s1">&#39;connectivities&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">clust_obj</span> <span class="o">=</span> <span class="n">assess_clustering_stability</span><span class="p">(</span><span class="n">adjacency_matrix</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="n">n_repetitions</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plot_k_resolution_corresp</span><span class="p">(</span><span class="n">clust_obj</span><span class="p">)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="plot_feature_overall_stability_boxplot">
                            <input id="plot_feature_overall_stability_boxplot-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_feature_overall_stability_boxplot</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">feature_objects_assessment_list</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="plot_feature_overall_stability_boxplot-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#plot_feature_overall_stability_boxplot"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="plot_feature_overall_stability_boxplot-4"><a href="#plot_feature_overall_stability_boxplot-4"><span class="linenos"> 4</span></a><span class="k">def</span> <span class="nf">plot_feature_overall_stability_boxplot</span><span class="p">(</span><span class="n">feature_objects_assessment_list</span><span class="p">):</span>
</span><span id="plot_feature_overall_stability_boxplot-5"><a href="#plot_feature_overall_stability_boxplot-5"><span class="linenos"> 5</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="plot_feature_overall_stability_boxplot-6"><a href="#plot_feature_overall_stability_boxplot-6"><span class="linenos"> 6</span></a><span class="sd">    Display EC consistency for each feature set and for each step.</span>
</span><span id="plot_feature_overall_stability_boxplot-7"><a href="#plot_feature_overall_stability_boxplot-7"><span class="linenos"> 7</span></a><span class="sd">    </span>
</span><span id="plot_feature_overall_stability_boxplot-8"><a href="#plot_feature_overall_stability_boxplot-8"><span class="linenos"> 8</span></a><span class="sd">    ### Args:</span>
</span><span id="plot_feature_overall_stability_boxplot-9"><a href="#plot_feature_overall_stability_boxplot-9"><span class="linenos"> 9</span></a><span class="sd">        feature_objects_assessment_list (dict): The object returned by the `assess_feature_stability` function.</span>
</span><span id="plot_feature_overall_stability_boxplot-10"><a href="#plot_feature_overall_stability_boxplot-10"><span class="linenos">10</span></a><span class="sd">        </span>
</span><span id="plot_feature_overall_stability_boxplot-11"><a href="#plot_feature_overall_stability_boxplot-11"><span class="linenos">11</span></a><span class="sd">    ### Example:</span>
</span><span id="plot_feature_overall_stability_boxplot-12"><a href="#plot_feature_overall_stability_boxplot-12"><span class="linenos">12</span></a><span class="sd">    &gt;&gt;&gt; np.random.seed(42)</span>
</span><span id="plot_feature_overall_stability_boxplot-13"><a href="#plot_feature_overall_stability_boxplot-13"><span class="linenos">13</span></a><span class="sd">    &gt;&gt;&gt; expr_matrix_values = np.vstack((np.random.rand(25, 10), np.random.uniform(5, 7, (75, 10))))</span>
</span><span id="plot_feature_overall_stability_boxplot-14"><a href="#plot_feature_overall_stability_boxplot-14"><span class="linenos">14</span></a><span class="sd">    &gt;&gt;&gt; expr_matrix = pd.DataFrame(expr_matrix_values)</span>
</span><span id="plot_feature_overall_stability_boxplot-15"><a href="#plot_feature_overall_stability_boxplot-15"><span class="linenos">15</span></a><span class="sd">    &gt;&gt;&gt; # Set the row names and column names</span>
</span><span id="plot_feature_overall_stability_boxplot-16"><a href="#plot_feature_overall_stability_boxplot-16"><span class="linenos">16</span></a><span class="sd">    &gt;&gt;&gt; expr_matrix.index = map(str, range(1, 101))</span>
</span><span id="plot_feature_overall_stability_boxplot-17"><a href="#plot_feature_overall_stability_boxplot-17"><span class="linenos">17</span></a><span class="sd">    &gt;&gt;&gt; expr_matrix.columns = [&quot;feature &quot; + str(i) for i in range(1, 11)]</span>
</span><span id="plot_feature_overall_stability_boxplot-18"><a href="#plot_feature_overall_stability_boxplot-18"><span class="linenos">18</span></a><span class="sd">    &gt;&gt;&gt; feature_stability_result = assess_feature_stability(data_matrix = expr_matrix, feature_set = expr_matrix.columns.tolist(), steps = [5, 10], feature_type = &#39;type_name&#39;, resolution = [0.3, 0.5], n_repetitions=10, algorithm=4)</span>
</span><span id="plot_feature_overall_stability_boxplot-19"><a href="#plot_feature_overall_stability_boxplot-19"><span class="linenos">19</span></a><span class="sd">    &gt;&gt;&gt; plot_feature_overall_stability_boxplot(feature_stability_result)</span>
</span><span id="plot_feature_overall_stability_boxplot-20"><a href="#plot_feature_overall_stability_boxplot-20"><span class="linenos">20</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="plot_feature_overall_stability_boxplot-21"><a href="#plot_feature_overall_stability_boxplot-21"><span class="linenos">21</span></a>    <span class="c1"># if it is not a list, make it a list</span>
</span><span id="plot_feature_overall_stability_boxplot-22"><a href="#plot_feature_overall_stability_boxplot-22"><span class="linenos">22</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feature_objects_assessment_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="plot_feature_overall_stability_boxplot-23"><a href="#plot_feature_overall_stability_boxplot-23"><span class="linenos">23</span></a>        <span class="n">feature_objects_assessment_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">feature_objects_assessment_list</span><span class="p">]</span>
</span><span id="plot_feature_overall_stability_boxplot-24"><a href="#plot_feature_overall_stability_boxplot-24"><span class="linenos">24</span></a>    
</span><span id="plot_feature_overall_stability_boxplot-25"><a href="#plot_feature_overall_stability_boxplot-25"><span class="linenos">25</span></a>    <span class="c1"># Get overall stability results in a dataframe. </span>
</span><span id="plot_feature_overall_stability_boxplot-26"><a href="#plot_feature_overall_stability_boxplot-26"><span class="linenos">26</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="plot_feature_overall_stability_boxplot-27"><a href="#plot_feature_overall_stability_boxplot-27"><span class="linenos">27</span></a>    <span class="k">for</span> <span class="n">fs_object</span> <span class="ow">in</span> <span class="n">feature_objects_assessment_list</span><span class="p">:</span>
</span><span id="plot_feature_overall_stability_boxplot-28"><a href="#plot_feature_overall_stability_boxplot-28"><span class="linenos">28</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fs_object</span><span class="p">[</span><span class="s1">&#39;steps_ecc_list&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="plot_feature_overall_stability_boxplot-29"><a href="#plot_feature_overall_stability_boxplot-29"><span class="linenos">29</span></a>        <span class="n">feature_object</span> <span class="o">=</span> <span class="n">fs_object</span><span class="p">[</span><span class="s1">&#39;steps_ecc_list&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>
</span><span id="plot_feature_overall_stability_boxplot-30"><a href="#plot_feature_overall_stability_boxplot-30"><span class="linenos">30</span></a>        <span class="k">for</span> <span class="n">type_key</span><span class="p">,</span> <span class="n">steps_dict</span> <span class="ow">in</span> <span class="n">feature_object</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="plot_feature_overall_stability_boxplot-31"><a href="#plot_feature_overall_stability_boxplot-31"><span class="linenos">31</span></a>            <span class="k">for</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">results_ecc</span> <span class="ow">in</span> <span class="n">steps_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="plot_feature_overall_stability_boxplot-32"><a href="#plot_feature_overall_stability_boxplot-32"><span class="linenos">32</span></a>                <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;#Features&#39;</span><span class="p">:</span> <span class="n">type_key</span><span class="p">,</span> <span class="s1">&#39;ECC&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">results_ecc</span><span class="p">[</span><span class="s1">&#39;ecc&#39;</span><span class="p">]),</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">})</span>
</span><span id="plot_feature_overall_stability_boxplot-33"><a href="#plot_feature_overall_stability_boxplot-33"><span class="linenos">33</span></a>
</span><span id="plot_feature_overall_stability_boxplot-34"><a href="#plot_feature_overall_stability_boxplot-34"><span class="linenos">34</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="plot_feature_overall_stability_boxplot-35"><a href="#plot_feature_overall_stability_boxplot-35"><span class="linenos">35</span></a>    
</span><span id="plot_feature_overall_stability_boxplot-36"><a href="#plot_feature_overall_stability_boxplot-36"><span class="linenos">36</span></a>    <span class="c1"># Sort by features</span>
</span><span id="plot_feature_overall_stability_boxplot-37"><a href="#plot_feature_overall_stability_boxplot-37"><span class="linenos">37</span></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;#Features&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;#Features&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>  
</span><span id="plot_feature_overall_stability_boxplot-38"><a href="#plot_feature_overall_stability_boxplot-38"><span class="linenos">38</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;#Features&#39;</span><span class="p">)</span>
</span><span id="plot_feature_overall_stability_boxplot-39"><a href="#plot_feature_overall_stability_boxplot-39"><span class="linenos">39</span></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;#Features&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;#Features&#39;</span><span class="p">],</span> <span class="n">categories</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;#Features&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()),</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="plot_feature_overall_stability_boxplot-40"><a href="#plot_feature_overall_stability_boxplot-40"><span class="linenos">40</span></a>
</span><span id="plot_feature_overall_stability_boxplot-41"><a href="#plot_feature_overall_stability_boxplot-41"><span class="linenos">41</span></a>    <span class="n">plot</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="plot_feature_overall_stability_boxplot-42"><a href="#plot_feature_overall_stability_boxplot-42"><span class="linenos">42</span></a>        <span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;#Features&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;ECC&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;type&#39;</span><span class="p">))</span>
</span><span id="plot_feature_overall_stability_boxplot-43"><a href="#plot_feature_overall_stability_boxplot-43"><span class="linenos">43</span></a>        <span class="o">+</span> <span class="n">geom_boxplot</span><span class="p">(</span><span class="n">outlier_shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">outlier_alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="plot_feature_overall_stability_boxplot-44"><a href="#plot_feature_overall_stability_boxplot-44"><span class="linenos">44</span></a>        <span class="o">+</span> <span class="n">theme_classic</span><span class="p">()</span>
</span><span id="plot_feature_overall_stability_boxplot-45"><a href="#plot_feature_overall_stability_boxplot-45"><span class="linenos">45</span></a>    <span class="p">)</span>
</span><span id="plot_feature_overall_stability_boxplot-46"><a href="#plot_feature_overall_stability_boxplot-46"><span class="linenos">46</span></a>    
</span><span id="plot_feature_overall_stability_boxplot-47"><a href="#plot_feature_overall_stability_boxplot-47"><span class="linenos">47</span></a>    <span class="k">return</span> <span class="n">plot</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Display EC consistency for each feature set and for each step.</p>

<h3 id="args">Args:</h3>

<pre><code>feature_objects_assessment_list (dict): The object returned by the `assess_feature_stability` function.
</code></pre>

<h3 id="example">Example:</h3>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">expr_matrix_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="p">(</span><span class="mi">75</span><span class="p">,</span> <span class="mi">10</span><span class="p">))))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">expr_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">expr_matrix_values</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Set the row names and column names</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">expr_matrix</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">101</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">expr_matrix</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;feature &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">feature_stability_result</span> <span class="o">=</span> <span class="n">assess_feature_stability</span><span class="p">(</span><span class="n">data_matrix</span> <span class="o">=</span> <span class="n">expr_matrix</span><span class="p">,</span> <span class="n">feature_set</span> <span class="o">=</span> <span class="n">expr_matrix</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">steps</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="n">feature_type</span> <span class="o">=</span> <span class="s1">&#39;type_name&#39;</span><span class="p">,</span> <span class="n">resolution</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="n">n_repetitions</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plot_feature_overall_stability_boxplot</span><span class="p">(</span><span class="n">feature_stability_result</span><span class="p">)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="plot_feature_overall_stability_incremental">
                            <input id="plot_feature_overall_stability_incremental-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_feature_overall_stability_incremental</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">feature_objects_assessment_list</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="plot_feature_overall_stability_incremental-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#plot_feature_overall_stability_incremental"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="plot_feature_overall_stability_incremental-50"><a href="#plot_feature_overall_stability_incremental-50"><span class="linenos">50</span></a><span class="k">def</span> <span class="nf">plot_feature_overall_stability_incremental</span><span class="p">(</span><span class="n">feature_objects_assessment_list</span><span class="p">):</span>
</span><span id="plot_feature_overall_stability_incremental-51"><a href="#plot_feature_overall_stability_incremental-51"><span class="linenos">51</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="plot_feature_overall_stability_incremental-52"><a href="#plot_feature_overall_stability_incremental-52"><span class="linenos">52</span></a><span class="sd">    Perform an incremental ECS between two consecutive feature steps.</span>
</span><span id="plot_feature_overall_stability_incremental-53"><a href="#plot_feature_overall_stability_incremental-53"><span class="linenos">53</span></a><span class="sd">    </span>
</span><span id="plot_feature_overall_stability_incremental-54"><a href="#plot_feature_overall_stability_incremental-54"><span class="linenos">54</span></a><span class="sd">    ### Args:</span>
</span><span id="plot_feature_overall_stability_incremental-55"><a href="#plot_feature_overall_stability_incremental-55"><span class="linenos">55</span></a><span class="sd">        feature_objects_assessment_list (dict): The object returned by the `assess_feature_stability` function.</span>
</span><span id="plot_feature_overall_stability_incremental-56"><a href="#plot_feature_overall_stability_incremental-56"><span class="linenos">56</span></a><span class="sd">        </span>
</span><span id="plot_feature_overall_stability_incremental-57"><a href="#plot_feature_overall_stability_incremental-57"><span class="linenos">57</span></a><span class="sd">    ### Example:</span>
</span><span id="plot_feature_overall_stability_incremental-58"><a href="#plot_feature_overall_stability_incremental-58"><span class="linenos">58</span></a><span class="sd">    &gt;&gt;&gt; np.random.seed(42)</span>
</span><span id="plot_feature_overall_stability_incremental-59"><a href="#plot_feature_overall_stability_incremental-59"><span class="linenos">59</span></a><span class="sd">    &gt;&gt;&gt; expr_matrix_values = np.vstack((np.random.rand(25, 10), np.random.uniform(5, 7, (75, 10))))</span>
</span><span id="plot_feature_overall_stability_incremental-60"><a href="#plot_feature_overall_stability_incremental-60"><span class="linenos">60</span></a><span class="sd">    &gt;&gt;&gt; expr_matrix = pd.DataFrame(expr_matrix_values)</span>
</span><span id="plot_feature_overall_stability_incremental-61"><a href="#plot_feature_overall_stability_incremental-61"><span class="linenos">61</span></a><span class="sd">    &gt;&gt;&gt; # Set the row names and column names</span>
</span><span id="plot_feature_overall_stability_incremental-62"><a href="#plot_feature_overall_stability_incremental-62"><span class="linenos">62</span></a><span class="sd">    &gt;&gt;&gt; expr_matrix.index = map(str, range(1, 101))</span>
</span><span id="plot_feature_overall_stability_incremental-63"><a href="#plot_feature_overall_stability_incremental-63"><span class="linenos">63</span></a><span class="sd">    &gt;&gt;&gt; expr_matrix.columns = [&quot;feature &quot; + str(i) for i in range(1, 11)]</span>
</span><span id="plot_feature_overall_stability_incremental-64"><a href="#plot_feature_overall_stability_incremental-64"><span class="linenos">64</span></a><span class="sd">    &gt;&gt;&gt; feature_stability_result = assess_feature_stability(data_matrix = expr_matrix, feature_set = expr_matrix.columns.tolist(), steps = [5, 10], feature_type = &#39;type_name&#39;, resolution = [0.3, 0.5], n_repetitions=10, algorithm=4)</span>
</span><span id="plot_feature_overall_stability_incremental-65"><a href="#plot_feature_overall_stability_incremental-65"><span class="linenos">65</span></a><span class="sd">    &gt;&gt;&gt; plot_feature_overall_stability_incremental(feature_stability_result)</span>
</span><span id="plot_feature_overall_stability_incremental-66"><a href="#plot_feature_overall_stability_incremental-66"><span class="linenos">66</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="plot_feature_overall_stability_incremental-67"><a href="#plot_feature_overall_stability_incremental-67"><span class="linenos">67</span></a>    <span class="c1"># if it is not a list, make it a list</span>
</span><span id="plot_feature_overall_stability_incremental-68"><a href="#plot_feature_overall_stability_incremental-68"><span class="linenos">68</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feature_objects_assessment_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="plot_feature_overall_stability_incremental-69"><a href="#plot_feature_overall_stability_incremental-69"><span class="linenos">69</span></a>        <span class="n">feature_objects_assessment_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">feature_objects_assessment_list</span><span class="p">]</span>
</span><span id="plot_feature_overall_stability_incremental-70"><a href="#plot_feature_overall_stability_incremental-70"><span class="linenos">70</span></a>    
</span><span id="plot_feature_overall_stability_incremental-71"><a href="#plot_feature_overall_stability_incremental-71"><span class="linenos">71</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;#Features&#39;</span><span class="p">,</span> <span class="s1">&#39;ECS&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">])</span>
</span><span id="plot_feature_overall_stability_incremental-72"><a href="#plot_feature_overall_stability_incremental-72"><span class="linenos">72</span></a>    
</span><span id="plot_feature_overall_stability_incremental-73"><a href="#plot_feature_overall_stability_incremental-73"><span class="linenos">73</span></a>    <span class="c1"># Get incremental stability results in a dataframe.</span>
</span><span id="plot_feature_overall_stability_incremental-74"><a href="#plot_feature_overall_stability_incremental-74"><span class="linenos">74</span></a>    <span class="k">for</span> <span class="n">fs_object</span> <span class="ow">in</span> <span class="n">feature_objects_assessment_list</span><span class="p">:</span>
</span><span id="plot_feature_overall_stability_incremental-75"><a href="#plot_feature_overall_stability_incremental-75"><span class="linenos">75</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fs_object</span><span class="p">[</span><span class="s1">&#39;incremental_ecs_list&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="plot_feature_overall_stability_incremental-76"><a href="#plot_feature_overall_stability_incremental-76"><span class="linenos">76</span></a>        <span class="n">feature_object</span> <span class="o">=</span> <span class="n">fs_object</span><span class="p">[</span><span class="s1">&#39;incremental_ecs_list&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>
</span><span id="plot_feature_overall_stability_incremental-77"><a href="#plot_feature_overall_stability_incremental-77"><span class="linenos">77</span></a>        <span class="k">for</span> <span class="n">type_key</span><span class="p">,</span> <span class="n">steps_dict</span> <span class="ow">in</span> <span class="n">feature_object</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="plot_feature_overall_stability_incremental-78"><a href="#plot_feature_overall_stability_incremental-78"><span class="linenos">78</span></a>            <span class="k">for</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">results_ecs</span> <span class="ow">in</span> <span class="n">steps_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="plot_feature_overall_stability_incremental-79"><a href="#plot_feature_overall_stability_incremental-79"><span class="linenos">79</span></a>                <span class="c1"># Temporary df to hold the results for this resolution</span>
</span><span id="plot_feature_overall_stability_incremental-80"><a href="#plot_feature_overall_stability_incremental-80"><span class="linenos">80</span></a>                <span class="n">temp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
</span><span id="plot_feature_overall_stability_incremental-81"><a href="#plot_feature_overall_stability_incremental-81"><span class="linenos">81</span></a>                    <span class="s1">&#39;#Features&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">type_key</span><span class="p">],</span>
</span><span id="plot_feature_overall_stability_incremental-82"><a href="#plot_feature_overall_stability_incremental-82"><span class="linenos">82</span></a>                    <span class="s1">&#39;ECS&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">results_ecs</span><span class="p">)],</span>
</span><span id="plot_feature_overall_stability_incremental-83"><a href="#plot_feature_overall_stability_incremental-83"><span class="linenos">83</span></a>                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="plot_feature_overall_stability_incremental-84"><a href="#plot_feature_overall_stability_incremental-84"><span class="linenos">84</span></a>                <span class="p">})</span>
</span><span id="plot_feature_overall_stability_incremental-85"><a href="#plot_feature_overall_stability_incremental-85"><span class="linenos">85</span></a>                <span class="c1"># Append the temporary DataFrame to the main DataFrame</span>
</span><span id="plot_feature_overall_stability_incremental-86"><a href="#plot_feature_overall_stability_incremental-86"><span class="linenos">86</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">temp_df</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="plot_feature_overall_stability_incremental-87"><a href="#plot_feature_overall_stability_incremental-87"><span class="linenos">87</span></a>    
</span><span id="plot_feature_overall_stability_incremental-88"><a href="#plot_feature_overall_stability_incremental-88"><span class="linenos">88</span></a>    <span class="c1"># Sort by features order (order that they appear in the incremental_ecs list).</span>
</span><span id="plot_feature_overall_stability_incremental-89"><a href="#plot_feature_overall_stability_incremental-89"><span class="linenos">89</span></a>    <span class="n">features_order</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;#Features&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="plot_feature_overall_stability_incremental-90"><a href="#plot_feature_overall_stability_incremental-90"><span class="linenos">90</span></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;#Features&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;#Features&#39;</span><span class="p">],</span> <span class="n">categories</span><span class="o">=</span><span class="n">features_order</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="plot_feature_overall_stability_incremental-91"><a href="#plot_feature_overall_stability_incremental-91"><span class="linenos">91</span></a>
</span><span id="plot_feature_overall_stability_incremental-92"><a href="#plot_feature_overall_stability_incremental-92"><span class="linenos">92</span></a>    <span class="n">plot</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="plot_feature_overall_stability_incremental-93"><a href="#plot_feature_overall_stability_incremental-93"><span class="linenos">93</span></a>        <span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;#Features&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;ECS&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;type&#39;</span><span class="p">))</span>
</span><span id="plot_feature_overall_stability_incremental-94"><a href="#plot_feature_overall_stability_incremental-94"><span class="linenos">94</span></a>        <span class="o">+</span> <span class="n">geom_boxplot</span><span class="p">(</span><span class="n">outlier_shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">outlier_alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="plot_feature_overall_stability_incremental-95"><a href="#plot_feature_overall_stability_incremental-95"><span class="linenos">95</span></a>        <span class="o">+</span> <span class="n">theme_classic</span><span class="p">()</span>
</span><span id="plot_feature_overall_stability_incremental-96"><a href="#plot_feature_overall_stability_incremental-96"><span class="linenos">96</span></a>    <span class="p">)</span>
</span><span id="plot_feature_overall_stability_incremental-97"><a href="#plot_feature_overall_stability_incremental-97"><span class="linenos">97</span></a>    
</span><span id="plot_feature_overall_stability_incremental-98"><a href="#plot_feature_overall_stability_incremental-98"><span class="linenos">98</span></a>    <span class="k">return</span> <span class="n">plot</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Perform an incremental ECS between two consecutive feature steps.</p>

<h3 id="args">Args:</h3>

<pre><code>feature_objects_assessment_list (dict): The object returned by the `assess_feature_stability` function.
</code></pre>

<h3 id="example">Example:</h3>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">expr_matrix_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="p">(</span><span class="mi">75</span><span class="p">,</span> <span class="mi">10</span><span class="p">))))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">expr_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">expr_matrix_values</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Set the row names and column names</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">expr_matrix</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">101</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">expr_matrix</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;feature &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">feature_stability_result</span> <span class="o">=</span> <span class="n">assess_feature_stability</span><span class="p">(</span><span class="n">data_matrix</span> <span class="o">=</span> <span class="n">expr_matrix</span><span class="p">,</span> <span class="n">feature_set</span> <span class="o">=</span> <span class="n">expr_matrix</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">steps</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="n">feature_type</span> <span class="o">=</span> <span class="s1">&#39;type_name&#39;</span><span class="p">,</span> <span class="n">resolution</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="n">n_repetitions</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plot_feature_overall_stability_incremental</span><span class="p">(</span><span class="n">feature_stability_result</span><span class="p">)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="plot_k_n_partitions">
                            <input id="plot_k_n_partitions-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_k_n_partitions</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">clust_object</span>,</span><span class="param">	<span class="n">color_information</span><span class="o">=</span><span class="s1">&#39;ecc&#39;</span>,</span><span class="param">	<span class="n">y_step</span><span class="o">=</span><span class="mi">5</span>,</span><span class="param">	<span class="n">pt_size_range</span><span class="o">=</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>,</span><span class="param">	<span class="n">dodge_width</span><span class="o">=</span><span class="mf">0.3</span>,</span><span class="param">	<span class="n">summary_function</span><span class="o">=&lt;</span><span class="n">function</span> <span class="n">median</span><span class="o">&gt;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="plot_k_n_partitions-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#plot_k_n_partitions"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="plot_k_n_partitions-150"><a href="#plot_k_n_partitions-150"><span class="linenos">150</span></a><span class="k">def</span> <span class="nf">plot_k_n_partitions</span><span class="p">(</span><span class="n">clust_object</span><span class="p">,</span> <span class="n">color_information</span><span class="o">=</span><span class="s2">&quot;ecc&quot;</span><span class="p">,</span> <span class="n">y_step</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pt_size_range</span><span class="o">=</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dodge_width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">summary_function</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">):</span>
</span><span id="plot_k_n_partitions-151"><a href="#plot_k_n_partitions-151"><span class="linenos">151</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="plot_k_n_partitions-152"><a href="#plot_k_n_partitions-152"><span class="linenos">152</span></a><span class="sd">    For each configuration provided in clust_object, display how many different partitions with the same number of clusters can be obtained by changing the seed.</span>
</span><span id="plot_k_n_partitions-153"><a href="#plot_k_n_partitions-153"><span class="linenos">153</span></a><span class="sd">    </span>
</span><span id="plot_k_n_partitions-154"><a href="#plot_k_n_partitions-154"><span class="linenos">154</span></a><span class="sd">    ### Args:</span>
</span><span id="plot_k_n_partitions-155"><a href="#plot_k_n_partitions-155"><span class="linenos">155</span></a><span class="sd">        clust_object (dict): The object returned by the `assess_clustering_stability` function.</span>
</span><span id="plot_k_n_partitions-156"><a href="#plot_k_n_partitions-156"><span class="linenos">156</span></a><span class="sd">        color_information (str): The information to be used for coloring the points. Can be either `ecc` or `freq_part`.</span>
</span><span id="plot_k_n_partitions-157"><a href="#plot_k_n_partitions-157"><span class="linenos">157</span></a><span class="sd">        y_step (int): The step for the y-axis.</span>
</span><span id="plot_k_n_partitions-158"><a href="#plot_k_n_partitions-158"><span class="linenos">158</span></a><span class="sd">        pt_size_range (tuple): The range of point sizes.</span>
</span><span id="plot_k_n_partitions-159"><a href="#plot_k_n_partitions-159"><span class="linenos">159</span></a><span class="sd">        dodge_width (float): The width of the dodging.</span>
</span><span id="plot_k_n_partitions-160"><a href="#plot_k_n_partitions-160"><span class="linenos">160</span></a><span class="sd">        summary_function (function): The function to be used for summarizing the ECC values.</span>
</span><span id="plot_k_n_partitions-161"><a href="#plot_k_n_partitions-161"><span class="linenos">161</span></a><span class="sd">        </span>
</span><span id="plot_k_n_partitions-162"><a href="#plot_k_n_partitions-162"><span class="linenos">162</span></a><span class="sd">    ### Example:</span>
</span><span id="plot_k_n_partitions-163"><a href="#plot_k_n_partitions-163"><span class="linenos">163</span></a><span class="sd">    &gt;&gt;&gt; pca_emb = np.random.rand(100, 30)</span>
</span><span id="plot_k_n_partitions-164"><a href="#plot_k_n_partitions-164"><span class="linenos">164</span></a><span class="sd">    &gt;&gt;&gt; # Create an AnnData object from pca_emb</span>
</span><span id="plot_k_n_partitions-165"><a href="#plot_k_n_partitions-165"><span class="linenos">165</span></a><span class="sd">    &gt;&gt;&gt; adata = sc.AnnData(X=pca_emb)</span>
</span><span id="plot_k_n_partitions-166"><a href="#plot_k_n_partitions-166"><span class="linenos">166</span></a><span class="sd">    &gt;&gt;&gt; # Run scanpy.pp.neighbors to get the connectivities as an adjacency matrix</span>
</span><span id="plot_k_n_partitions-167"><a href="#plot_k_n_partitions-167"><span class="linenos">167</span></a><span class="sd">    &gt;&gt;&gt; sc.pp.neighbors(adata, n_neighbors=10, use_rep=&#39;X&#39;)</span>
</span><span id="plot_k_n_partitions-168"><a href="#plot_k_n_partitions-168"><span class="linenos">168</span></a><span class="sd">    &gt;&gt;&gt; adjacency_matrix = adata.obsp[&#39;connectivities&#39;]</span>
</span><span id="plot_k_n_partitions-169"><a href="#plot_k_n_partitions-169"><span class="linenos">169</span></a><span class="sd">    &gt;&gt;&gt; clust_obj = assess_clustering_stability(adjacency_matrix, resolution=[0.1, 0.3, 0.5], n_repetitions=10, algorithm=[1,4])</span>
</span><span id="plot_k_n_partitions-170"><a href="#plot_k_n_partitions-170"><span class="linenos">170</span></a><span class="sd">    &gt;&gt;&gt; plot_k_n_partitions(clust_obj)</span>
</span><span id="plot_k_n_partitions-171"><a href="#plot_k_n_partitions-171"><span class="linenos">171</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="plot_k_n_partitions-172"><a href="#plot_k_n_partitions-172"><span class="linenos">172</span></a>    <span class="k">if</span> <span class="n">color_information</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ecc&quot;</span><span class="p">,</span> <span class="s2">&quot;freq_part&quot;</span><span class="p">]:</span>
</span><span id="plot_k_n_partitions-173"><a href="#plot_k_n_partitions-173"><span class="linenos">173</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;colour_information can be either `ecc` or `freq_part`&quot;</span><span class="p">)</span>
</span><span id="plot_k_n_partitions-174"><a href="#plot_k_n_partitions-174"><span class="linenos">174</span></a>
</span><span id="plot_k_n_partitions-175"><a href="#plot_k_n_partitions-175"><span class="linenos">175</span></a>    <span class="k">if</span> <span class="s1">&#39;split_by_k&#39;</span> <span class="ow">in</span> <span class="n">clust_object</span><span class="p">:</span>
</span><span id="plot_k_n_partitions-176"><a href="#plot_k_n_partitions-176"><span class="linenos">176</span></a>        <span class="n">clust_object</span> <span class="o">=</span> <span class="n">clust_object</span><span class="p">[</span><span class="s1">&#39;split_by_k&#39;</span><span class="p">]</span>
</span><span id="plot_k_n_partitions-177"><a href="#plot_k_n_partitions-177"><span class="linenos">177</span></a>
</span><span id="plot_k_n_partitions-178"><a href="#plot_k_n_partitions-178"><span class="linenos">178</span></a>    <span class="n">data_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="plot_k_n_partitions-179"><a href="#plot_k_n_partitions-179"><span class="linenos">179</span></a>    <span class="n">max_n_part</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="plot_k_n_partitions-180"><a href="#plot_k_n_partitions-180"><span class="linenos">180</span></a>
</span><span id="plot_k_n_partitions-181"><a href="#plot_k_n_partitions-181"><span class="linenos">181</span></a>    <span class="k">for</span> <span class="n">configuration</span><span class="p">,</span> <span class="n">partition_object</span> <span class="ow">in</span> <span class="n">clust_object</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="plot_k_n_partitions-182"><a href="#plot_k_n_partitions-182"><span class="linenos">182</span></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">partition_object</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="plot_k_n_partitions-183"><a href="#plot_k_n_partitions-183"><span class="linenos">183</span></a>            <span class="n">n_partitions</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;partitions&#39;</span><span class="p">])</span>
</span><span id="plot_k_n_partitions-184"><a href="#plot_k_n_partitions-184"><span class="linenos">184</span></a>            <span class="n">first_occ</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">partition</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">partition</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;partitions&#39;</span><span class="p">])</span>
</span><span id="plot_k_n_partitions-185"><a href="#plot_k_n_partitions-185"><span class="linenos">185</span></a>            <span class="n">total_occ</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">partition</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">partition</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;partitions&#39;</span><span class="p">])</span>
</span><span id="plot_k_n_partitions-186"><a href="#plot_k_n_partitions-186"><span class="linenos">186</span></a>            <span class="n">freq_part</span> <span class="o">=</span> <span class="n">first_occ</span> <span class="o">/</span> <span class="n">total_occ</span>
</span><span id="plot_k_n_partitions-187"><a href="#plot_k_n_partitions-187"><span class="linenos">187</span></a>            <span class="n">ecc</span> <span class="o">=</span> <span class="n">summary_function</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ecc&#39;</span><span class="p">])</span>
</span><span id="plot_k_n_partitions-188"><a href="#plot_k_n_partitions-188"><span class="linenos">188</span></a>
</span><span id="plot_k_n_partitions-189"><a href="#plot_k_n_partitions-189"><span class="linenos">189</span></a>            <span class="n">data_list</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="plot_k_n_partitions-190"><a href="#plot_k_n_partitions-190"><span class="linenos">190</span></a>                <span class="c1"># convert k to numeric</span>
</span><span id="plot_k_n_partitions-191"><a href="#plot_k_n_partitions-191"><span class="linenos">191</span></a>                <span class="s1">&#39;n.clusters&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">k</span><span class="p">),</span>
</span><span id="plot_k_n_partitions-192"><a href="#plot_k_n_partitions-192"><span class="linenos">192</span></a>                <span class="s1">&#39;n.partitions&#39;</span><span class="p">:</span> <span class="n">n_partitions</span><span class="p">,</span>
</span><span id="plot_k_n_partitions-193"><a href="#plot_k_n_partitions-193"><span class="linenos">193</span></a>                <span class="s1">&#39;configuration&#39;</span><span class="p">:</span> <span class="n">configuration</span><span class="p">,</span>
</span><span id="plot_k_n_partitions-194"><a href="#plot_k_n_partitions-194"><span class="linenos">194</span></a>                <span class="s1">&#39;first.occ&#39;</span><span class="p">:</span> <span class="n">first_occ</span><span class="p">,</span>
</span><span id="plot_k_n_partitions-195"><a href="#plot_k_n_partitions-195"><span class="linenos">195</span></a>                <span class="s1">&#39;total.occ&#39;</span><span class="p">:</span> <span class="n">total_occ</span><span class="p">,</span>
</span><span id="plot_k_n_partitions-196"><a href="#plot_k_n_partitions-196"><span class="linenos">196</span></a>                <span class="s1">&#39;freq_part&#39;</span><span class="p">:</span> <span class="n">freq_part</span><span class="p">,</span>
</span><span id="plot_k_n_partitions-197"><a href="#plot_k_n_partitions-197"><span class="linenos">197</span></a>                <span class="s1">&#39;ecc&#39;</span><span class="p">:</span> <span class="n">ecc</span>
</span><span id="plot_k_n_partitions-198"><a href="#plot_k_n_partitions-198"><span class="linenos">198</span></a>            <span class="p">})</span>
</span><span id="plot_k_n_partitions-199"><a href="#plot_k_n_partitions-199"><span class="linenos">199</span></a>
</span><span id="plot_k_n_partitions-200"><a href="#plot_k_n_partitions-200"><span class="linenos">200</span></a>            <span class="n">max_n_part</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_n_part</span><span class="p">,</span> <span class="n">n_partitions</span><span class="p">)</span>
</span><span id="plot_k_n_partitions-201"><a href="#plot_k_n_partitions-201"><span class="linenos">201</span></a>
</span><span id="plot_k_n_partitions-202"><a href="#plot_k_n_partitions-202"><span class="linenos">202</span></a>    <span class="n">overall_total_occ</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;total.occ&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_list</span><span class="p">)</span>
</span><span id="plot_k_n_partitions-203"><a href="#plot_k_n_partitions-203"><span class="linenos">203</span></a>    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_list</span><span class="p">:</span>
</span><span id="plot_k_n_partitions-204"><a href="#plot_k_n_partitions-204"><span class="linenos">204</span></a>        <span class="n">item</span><span class="p">[</span><span class="s1">&#39;frequency_k&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;total.occ&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">overall_total_occ</span>
</span><span id="plot_k_n_partitions-205"><a href="#plot_k_n_partitions-205"><span class="linenos">205</span></a>
</span><span id="plot_k_n_partitions-206"><a href="#plot_k_n_partitions-206"><span class="linenos">206</span></a>    <span class="n">unique_parts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_list</span><span class="p">)</span>
</span><span id="plot_k_n_partitions-207"><a href="#plot_k_n_partitions-207"><span class="linenos">207</span></a>    <span class="n">y_breaks</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_n_part</span> <span class="o">+</span> <span class="n">y_step</span><span class="p">,</span> <span class="n">y_step</span><span class="p">))</span>
</span><span id="plot_k_n_partitions-208"><a href="#plot_k_n_partitions-208"><span class="linenos">208</span></a>    <span class="n">unique_parts</span><span class="p">[</span><span class="s1">&#39;n.clusters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">unique_parts</span><span class="p">[</span><span class="s1">&#39;n.clusters&#39;</span><span class="p">],</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="plot_k_n_partitions-209"><a href="#plot_k_n_partitions-209"><span class="linenos">209</span></a>
</span><span id="plot_k_n_partitions-210"><a href="#plot_k_n_partitions-210"><span class="linenos">210</span></a>    <span class="n">plot</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="plot_k_n_partitions-211"><a href="#plot_k_n_partitions-211"><span class="linenos">211</span></a>        <span class="n">ggplot</span><span class="p">(</span><span class="n">unique_parts</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span>
</span><span id="plot_k_n_partitions-212"><a href="#plot_k_n_partitions-212"><span class="linenos">212</span></a>            <span class="n">x</span><span class="o">=</span><span class="s1">&#39;n.clusters&#39;</span><span class="p">,</span>
</span><span id="plot_k_n_partitions-213"><a href="#plot_k_n_partitions-213"><span class="linenos">213</span></a>            <span class="n">y</span><span class="o">=</span><span class="s1">&#39;n.partitions&#39;</span><span class="p">,</span>
</span><span id="plot_k_n_partitions-214"><a href="#plot_k_n_partitions-214"><span class="linenos">214</span></a>            <span class="n">shape</span><span class="o">=</span><span class="s1">&#39;configuration&#39;</span><span class="p">,</span>
</span><span id="plot_k_n_partitions-215"><a href="#plot_k_n_partitions-215"><span class="linenos">215</span></a>            <span class="n">size</span><span class="o">=</span><span class="s1">&#39;frequency_k&#39;</span><span class="p">,</span>
</span><span id="plot_k_n_partitions-216"><a href="#plot_k_n_partitions-216"><span class="linenos">216</span></a>            <span class="n">fill</span><span class="o">=</span><span class="n">color_information</span><span class="p">,</span>  <span class="c1"># Replace with the correct column name</span>
</span><span id="plot_k_n_partitions-217"><a href="#plot_k_n_partitions-217"><span class="linenos">217</span></a>            <span class="n">group</span><span class="o">=</span><span class="s1">&#39;configuration&#39;</span>
</span><span id="plot_k_n_partitions-218"><a href="#plot_k_n_partitions-218"><span class="linenos">218</span></a>        <span class="p">))</span> <span class="o">+</span>
</span><span id="plot_k_n_partitions-219"><a href="#plot_k_n_partitions-219"><span class="linenos">219</span></a>        <span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="n">y_breaks</span><span class="p">)</span> <span class="o">+</span>
</span><span id="plot_k_n_partitions-220"><a href="#plot_k_n_partitions-220"><span class="linenos">220</span></a>        <span class="n">scale_size_continuous</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="n">pt_size_range</span><span class="p">,</span> <span class="n">guide</span><span class="o">=</span><span class="s1">&#39;legend&#39;</span><span class="p">)</span> <span class="o">+</span>
</span><span id="plot_k_n_partitions-221"><a href="#plot_k_n_partitions-221"><span class="linenos">221</span></a>        <span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_n_part</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y_step</span><span class="p">)),</span> <span class="n">linetype</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#e3e3e3&quot;</span><span class="p">)</span> <span class="o">+</span>
</span><span id="plot_k_n_partitions-222"><a href="#plot_k_n_partitions-222"><span class="linenos">222</span></a>        <span class="n">geom_point</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">position_dodge</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">dodge_width</span><span class="p">))</span> <span class="o">+</span>
</span><span id="plot_k_n_partitions-223"><a href="#plot_k_n_partitions-223"><span class="linenos">223</span></a>        <span class="n">theme_classic</span><span class="p">()</span> <span class="o">+</span>
</span><span id="plot_k_n_partitions-224"><a href="#plot_k_n_partitions-224"><span class="linenos">224</span></a>        <span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;# partitions&quot;</span><span class="p">)</span> <span class="o">+</span>
</span><span id="plot_k_n_partitions-225"><a href="#plot_k_n_partitions-225"><span class="linenos">225</span></a>        <span class="n">guides</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">guide_legend</span><span class="p">(</span><span class="n">override_aes</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">pt_size_range</span><span class="p">)}))</span>
</span><span id="plot_k_n_partitions-226"><a href="#plot_k_n_partitions-226"><span class="linenos">226</span></a>    <span class="p">)</span>
</span><span id="plot_k_n_partitions-227"><a href="#plot_k_n_partitions-227"><span class="linenos">227</span></a>    
</span><span id="plot_k_n_partitions-228"><a href="#plot_k_n_partitions-228"><span class="linenos">228</span></a>    <span class="k">return</span> <span class="n">plot</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>For each configuration provided in clust_object, display how many different partitions with the same number of clusters can be obtained by changing the seed.</p>

<h3 id="args">Args:</h3>

<pre><code>clust_object (dict): The object returned by the `assess_clustering_stability` function.
color_information (str): The information to be used for coloring the points. Can be either `ecc` or `freq_part`.
y_step (int): The step for the y-axis.
pt_size_range (tuple): The range of point sizes.
dodge_width (float): The width of the dodging.
summary_function (function): The function to be used for summarizing the ECC values.
</code></pre>

<h3 id="example">Example:</h3>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">pca_emb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Create an AnnData object from pca_emb</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">adata</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">AnnData</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">pca_emb</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Run scanpy.pp.neighbors to get the connectivities as an adjacency matrix</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sc</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">use_rep</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">adjacency_matrix</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">obsp</span><span class="p">[</span><span class="s1">&#39;connectivities&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">clust_obj</span> <span class="o">=</span> <span class="n">assess_clustering_stability</span><span class="p">(</span><span class="n">adjacency_matrix</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="n">n_repetitions</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plot_k_n_partitions</span><span class="p">(</span><span class="n">clust_obj</span><span class="p">)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="plot_k_resolution_corresp">
                            <input id="plot_k_resolution_corresp-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_k_resolution_corresp</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">clust_object</span>,</span><span class="param">	<span class="n">color_information</span><span class="o">=</span><span class="s1">&#39;ecc&#39;</span>,</span><span class="param">	<span class="n">dodge_width</span><span class="o">=</span><span class="mf">0.3</span>,</span><span class="param">	<span class="n">pt_size_range</span><span class="o">=</span><span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>,</span><span class="param">	<span class="n">summary_function</span><span class="o">=&lt;</span><span class="n">function</span> <span class="n">median</span><span class="o">&gt;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="plot_k_resolution_corresp-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#plot_k_resolution_corresp"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="plot_k_resolution_corresp-230"><a href="#plot_k_resolution_corresp-230"><span class="linenos">230</span></a><span class="k">def</span> <span class="nf">plot_k_resolution_corresp</span><span class="p">(</span><span class="n">clust_object</span><span class="p">,</span> <span class="n">color_information</span><span class="o">=</span><span class="s2">&quot;ecc&quot;</span><span class="p">,</span> <span class="n">dodge_width</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">pt_size_range</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">summary_function</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">):</span>
</span><span id="plot_k_resolution_corresp-231"><a href="#plot_k_resolution_corresp-231"><span class="linenos">231</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="plot_k_resolution_corresp-232"><a href="#plot_k_resolution_corresp-232"><span class="linenos">232</span></a><span class="sd">    For each configuration provided in the clust_object, display what number of clusters appear for different values of the resolution parameters.</span>
</span><span id="plot_k_resolution_corresp-233"><a href="#plot_k_resolution_corresp-233"><span class="linenos">233</span></a><span class="sd">    </span>
</span><span id="plot_k_resolution_corresp-234"><a href="#plot_k_resolution_corresp-234"><span class="linenos">234</span></a><span class="sd">    ### Args:</span>
</span><span id="plot_k_resolution_corresp-235"><a href="#plot_k_resolution_corresp-235"><span class="linenos">235</span></a><span class="sd">        clust_object (dict): The object returned by the `assess_clustering_stability` function.</span>
</span><span id="plot_k_resolution_corresp-236"><a href="#plot_k_resolution_corresp-236"><span class="linenos">236</span></a><span class="sd">        color_information (str): The information to be used for coloring the points. Can be either `ecc` or `freq_part`.</span>
</span><span id="plot_k_resolution_corresp-237"><a href="#plot_k_resolution_corresp-237"><span class="linenos">237</span></a><span class="sd">        dodge_width (float): The width of the dodging.</span>
</span><span id="plot_k_resolution_corresp-238"><a href="#plot_k_resolution_corresp-238"><span class="linenos">238</span></a><span class="sd">        pt_size_range (float array): The range of point sizes.</span>
</span><span id="plot_k_resolution_corresp-239"><a href="#plot_k_resolution_corresp-239"><span class="linenos">239</span></a><span class="sd">        summary_function (function): The function to be used for summarizing the ECC values.</span>
</span><span id="plot_k_resolution_corresp-240"><a href="#plot_k_resolution_corresp-240"><span class="linenos">240</span></a><span class="sd">        </span>
</span><span id="plot_k_resolution_corresp-241"><a href="#plot_k_resolution_corresp-241"><span class="linenos">241</span></a><span class="sd">    ### Example:</span>
</span><span id="plot_k_resolution_corresp-242"><a href="#plot_k_resolution_corresp-242"><span class="linenos">242</span></a><span class="sd">    &gt;&gt;&gt; pca_emb = np.random.rand(100, 30)</span>
</span><span id="plot_k_resolution_corresp-243"><a href="#plot_k_resolution_corresp-243"><span class="linenos">243</span></a><span class="sd">    &gt;&gt;&gt; # Create an AnnData object from pca_emb</span>
</span><span id="plot_k_resolution_corresp-244"><a href="#plot_k_resolution_corresp-244"><span class="linenos">244</span></a><span class="sd">    &gt;&gt;&gt; adata = sc.AnnData(X=pca_emb)</span>
</span><span id="plot_k_resolution_corresp-245"><a href="#plot_k_resolution_corresp-245"><span class="linenos">245</span></a><span class="sd">    &gt;&gt;&gt; # Run scanpy.pp.neighbors to get the connectivities as an adjacency matrix</span>
</span><span id="plot_k_resolution_corresp-246"><a href="#plot_k_resolution_corresp-246"><span class="linenos">246</span></a><span class="sd">    &gt;&gt;&gt; sc.pp.neighbors(adata, n_neighbors=10, use_rep=&#39;X&#39;)</span>
</span><span id="plot_k_resolution_corresp-247"><a href="#plot_k_resolution_corresp-247"><span class="linenos">247</span></a><span class="sd">    &gt;&gt;&gt; adjacency_matrix = adata.obsp[&#39;connectivities&#39;]</span>
</span><span id="plot_k_resolution_corresp-248"><a href="#plot_k_resolution_corresp-248"><span class="linenos">248</span></a><span class="sd">    &gt;&gt;&gt; clust_obj = assess_clustering_stability(adjacency_matrix, resolution=[0.1, 0.3, 0.5], n_repetitions=10, algorithm=[1,4])</span>
</span><span id="plot_k_resolution_corresp-249"><a href="#plot_k_resolution_corresp-249"><span class="linenos">249</span></a><span class="sd">    &gt;&gt;&gt; plot_k_resolution_corresp(clust_obj)</span>
</span><span id="plot_k_resolution_corresp-250"><a href="#plot_k_resolution_corresp-250"><span class="linenos">250</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="plot_k_resolution_corresp-251"><a href="#plot_k_resolution_corresp-251"><span class="linenos">251</span></a>    <span class="k">if</span> <span class="n">color_information</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ecc&quot;</span><span class="p">,</span> <span class="s2">&quot;freq_k&quot;</span><span class="p">]:</span>
</span><span id="plot_k_resolution_corresp-252"><a href="#plot_k_resolution_corresp-252"><span class="linenos">252</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;color_information can be either `ecc` or `freq_k`&quot;</span><span class="p">)</span>
</span><span id="plot_k_resolution_corresp-253"><a href="#plot_k_resolution_corresp-253"><span class="linenos">253</span></a>
</span><span id="plot_k_resolution_corresp-254"><a href="#plot_k_resolution_corresp-254"><span class="linenos">254</span></a>    <span class="n">appearances_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="plot_k_resolution_corresp-255"><a href="#plot_k_resolution_corresp-255"><span class="linenos">255</span></a>
</span><span id="plot_k_resolution_corresp-256"><a href="#plot_k_resolution_corresp-256"><span class="linenos">256</span></a>    <span class="c1"># Iterate through the clustering results</span>
</span><span id="plot_k_resolution_corresp-257"><a href="#plot_k_resolution_corresp-257"><span class="linenos">257</span></a>    <span class="k">for</span> <span class="n">method</span><span class="p">,</span> <span class="n">resolutions</span> <span class="ow">in</span> <span class="n">clust_object</span><span class="p">[</span><span class="s1">&#39;split_by_resolution&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="plot_k_resolution_corresp-258"><a href="#plot_k_resolution_corresp-258"><span class="linenos">258</span></a>        <span class="k">for</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">res_object</span> <span class="ow">in</span> <span class="n">resolutions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="plot_k_resolution_corresp-259"><a href="#plot_k_resolution_corresp-259"><span class="linenos">259</span></a>            <span class="c1"># Calculate total runs for normalization</span>
</span><span id="plot_k_resolution_corresp-260"><a href="#plot_k_resolution_corresp-260"><span class="linenos">260</span></a>            <span class="n">n_runs</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">partition</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="n">res_object</span><span class="p">[</span><span class="s1">&#39;clusters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">partition</span> <span class="ow">in</span> <span class="n">cluster</span><span class="p">[</span><span class="s1">&#39;partitions&#39;</span><span class="p">])</span>
</span><span id="plot_k_resolution_corresp-261"><a href="#plot_k_resolution_corresp-261"><span class="linenos">261</span></a>
</span><span id="plot_k_resolution_corresp-262"><a href="#plot_k_resolution_corresp-262"><span class="linenos">262</span></a>            <span class="n">temp_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="plot_k_resolution_corresp-263"><a href="#plot_k_resolution_corresp-263"><span class="linenos">263</span></a>                <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="plot_k_resolution_corresp-264"><a href="#plot_k_resolution_corresp-264"><span class="linenos">264</span></a>                <span class="s1">&#39;resolution_value&#39;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="plot_k_resolution_corresp-265"><a href="#plot_k_resolution_corresp-265"><span class="linenos">265</span></a>                <span class="s1">&#39;number_clusters&#39;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="plot_k_resolution_corresp-266"><a href="#plot_k_resolution_corresp-266"><span class="linenos">266</span></a>                <span class="s1">&#39;freq_partition&#39;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="plot_k_resolution_corresp-267"><a href="#plot_k_resolution_corresp-267"><span class="linenos">267</span></a>                <span class="s1">&#39;ecc&#39;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="plot_k_resolution_corresp-268"><a href="#plot_k_resolution_corresp-268"><span class="linenos">268</span></a>                <span class="s1">&#39;freq_k&#39;</span><span class="p">:</span> <span class="p">[]</span>
</span><span id="plot_k_resolution_corresp-269"><a href="#plot_k_resolution_corresp-269"><span class="linenos">269</span></a>            <span class="p">}</span>
</span><span id="plot_k_resolution_corresp-270"><a href="#plot_k_resolution_corresp-270"><span class="linenos">270</span></a>
</span><span id="plot_k_resolution_corresp-271"><a href="#plot_k_resolution_corresp-271"><span class="linenos">271</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">cluster_info</span> <span class="ow">in</span> <span class="n">res_object</span><span class="p">[</span><span class="s1">&#39;clusters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="plot_k_resolution_corresp-272"><a href="#plot_k_resolution_corresp-272"><span class="linenos">272</span></a>                <span class="c1"># Calculate the sum of frequencies for this cluster size (k)</span>
</span><span id="plot_k_resolution_corresp-273"><a href="#plot_k_resolution_corresp-273"><span class="linenos">273</span></a>                <span class="n">freq_k</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">partition</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">partition</span> <span class="ow">in</span> <span class="n">cluster_info</span><span class="p">[</span><span class="s1">&#39;partitions&#39;</span><span class="p">])</span>
</span><span id="plot_k_resolution_corresp-274"><a href="#plot_k_resolution_corresp-274"><span class="linenos">274</span></a>                
</span><span id="plot_k_resolution_corresp-275"><a href="#plot_k_resolution_corresp-275"><span class="linenos">275</span></a>                <span class="n">temp_data</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
</span><span id="plot_k_resolution_corresp-276"><a href="#plot_k_resolution_corresp-276"><span class="linenos">276</span></a>                <span class="n">temp_data</span><span class="p">[</span><span class="s1">&#39;resolution_value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resolution</span><span class="p">)</span>
</span><span id="plot_k_resolution_corresp-277"><a href="#plot_k_resolution_corresp-277"><span class="linenos">277</span></a>                <span class="n">temp_data</span><span class="p">[</span><span class="s1">&#39;number_clusters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span><span id="plot_k_resolution_corresp-278"><a href="#plot_k_resolution_corresp-278"><span class="linenos">278</span></a>                <span class="n">temp_data</span><span class="p">[</span><span class="s1">&#39;freq_partition&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cluster_info</span><span class="p">[</span><span class="s1">&#39;partitions&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">partition</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">partition</span> <span class="ow">in</span> <span class="n">cluster_info</span><span class="p">[</span><span class="s1">&#39;partitions&#39;</span><span class="p">]))</span>
</span><span id="plot_k_resolution_corresp-279"><a href="#plot_k_resolution_corresp-279"><span class="linenos">279</span></a>                <span class="n">temp_data</span><span class="p">[</span><span class="s1">&#39;ecc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">summary_function</span><span class="p">(</span><span class="n">cluster_info</span><span class="p">[</span><span class="s1">&#39;ecc&#39;</span><span class="p">]))</span>
</span><span id="plot_k_resolution_corresp-280"><a href="#plot_k_resolution_corresp-280"><span class="linenos">280</span></a>                <span class="n">temp_data</span><span class="p">[</span><span class="s1">&#39;freq_k&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">freq_k</span><span class="p">)</span>
</span><span id="plot_k_resolution_corresp-281"><a href="#plot_k_resolution_corresp-281"><span class="linenos">281</span></a>
</span><span id="plot_k_resolution_corresp-282"><a href="#plot_k_resolution_corresp-282"><span class="linenos">282</span></a>            <span class="c1"># Convert to DataFrame and normalize</span>
</span><span id="plot_k_resolution_corresp-283"><a href="#plot_k_resolution_corresp-283"><span class="linenos">283</span></a>            <span class="n">temp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">temp_data</span><span class="p">)</span>
</span><span id="plot_k_resolution_corresp-284"><a href="#plot_k_resolution_corresp-284"><span class="linenos">284</span></a>            <span class="n">temp_df</span><span class="p">[</span><span class="s1">&#39;freq_k&#39;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">n_runs</span>
</span><span id="plot_k_resolution_corresp-285"><a href="#plot_k_resolution_corresp-285"><span class="linenos">285</span></a>            <span class="n">appearances_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">appearances_df</span><span class="p">,</span> <span class="n">temp_df</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="plot_k_resolution_corresp-286"><a href="#plot_k_resolution_corresp-286"><span class="linenos">286</span></a>
</span><span id="plot_k_resolution_corresp-287"><a href="#plot_k_resolution_corresp-287"><span class="linenos">287</span></a>    <span class="n">appearances_df</span><span class="p">[</span><span class="s1">&#39;number_clusters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">appearances_df</span><span class="p">[</span><span class="s1">&#39;number_clusters&#39;</span><span class="p">])</span>
</span><span id="plot_k_resolution_corresp-288"><a href="#plot_k_resolution_corresp-288"><span class="linenos">288</span></a>    <span class="n">appearances_df</span><span class="p">[</span><span class="s1">&#39;resolution_value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">appearances_df</span><span class="p">[</span><span class="s1">&#39;resolution_value&#39;</span><span class="p">])</span>
</span><span id="plot_k_resolution_corresp-289"><a href="#plot_k_resolution_corresp-289"><span class="linenos">289</span></a>
</span><span id="plot_k_resolution_corresp-290"><a href="#plot_k_resolution_corresp-290"><span class="linenos">290</span></a>    <span class="n">plot</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="plot_k_resolution_corresp-291"><a href="#plot_k_resolution_corresp-291"><span class="linenos">291</span></a>        <span class="n">ggplot</span><span class="p">(</span><span class="n">appearances_df</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span>
</span><span id="plot_k_resolution_corresp-292"><a href="#plot_k_resolution_corresp-292"><span class="linenos">292</span></a>            <span class="n">y</span><span class="o">=</span><span class="s1">&#39;number_clusters&#39;</span><span class="p">,</span>
</span><span id="plot_k_resolution_corresp-293"><a href="#plot_k_resolution_corresp-293"><span class="linenos">293</span></a>            <span class="n">x</span><span class="o">=</span><span class="s1">&#39;factor(resolution_value)&#39;</span><span class="p">,</span>
</span><span id="plot_k_resolution_corresp-294"><a href="#plot_k_resolution_corresp-294"><span class="linenos">294</span></a>            <span class="n">size</span><span class="o">=</span><span class="s1">&#39;freq_partition&#39;</span><span class="p">,</span>
</span><span id="plot_k_resolution_corresp-295"><a href="#plot_k_resolution_corresp-295"><span class="linenos">295</span></a>            <span class="n">fill</span><span class="o">=</span><span class="n">color_information</span><span class="p">,</span>
</span><span id="plot_k_resolution_corresp-296"><a href="#plot_k_resolution_corresp-296"><span class="linenos">296</span></a>            <span class="n">shape</span><span class="o">=</span><span class="s1">&#39;method&#39;</span><span class="p">,</span>
</span><span id="plot_k_resolution_corresp-297"><a href="#plot_k_resolution_corresp-297"><span class="linenos">297</span></a>            <span class="n">group</span><span class="o">=</span><span class="s1">&#39;method&#39;</span>
</span><span id="plot_k_resolution_corresp-298"><a href="#plot_k_resolution_corresp-298"><span class="linenos">298</span></a>        <span class="p">))</span> <span class="o">+</span>
</span><span id="plot_k_resolution_corresp-299"><a href="#plot_k_resolution_corresp-299"><span class="linenos">299</span></a>        <span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="n">appearances_df</span><span class="p">[</span><span class="s1">&#39;number_clusters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span> <span class="n">linetype</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#e3e3e3&quot;</span><span class="p">)</span> <span class="o">+</span>
</span><span id="plot_k_resolution_corresp-300"><a href="#plot_k_resolution_corresp-300"><span class="linenos">300</span></a>        <span class="n">geom_point</span><span class="p">(</span><span class="n">position</span><span class="o">=</span> <span class="n">position_dodge</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">dodge_width</span><span class="p">))</span> <span class="o">+</span>
</span><span id="plot_k_resolution_corresp-301"><a href="#plot_k_resolution_corresp-301"><span class="linenos">301</span></a>        <span class="n">theme_classic</span><span class="p">()</span> <span class="o">+</span>
</span><span id="plot_k_resolution_corresp-302"><a href="#plot_k_resolution_corresp-302"><span class="linenos">302</span></a>        <span class="n">scale_fill_cmap</span><span class="p">(</span><span class="n">guide</span><span class="o">=</span><span class="s2">&quot;colorbar&quot;</span><span class="p">)</span> <span class="o">+</span>
</span><span id="plot_k_resolution_corresp-303"><a href="#plot_k_resolution_corresp-303"><span class="linenos">303</span></a>        <span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;resolution&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span> <span class="o">+</span>
</span><span id="plot_k_resolution_corresp-304"><a href="#plot_k_resolution_corresp-304"><span class="linenos">304</span></a>        <span class="n">scale_size_continuous</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="n">pt_size_range</span><span class="p">,</span> <span class="n">guide</span><span class="o">=</span><span class="s2">&quot;legend&quot;</span><span class="p">)</span> <span class="o">+</span>
</span><span id="plot_k_resolution_corresp-305"><a href="#plot_k_resolution_corresp-305"><span class="linenos">305</span></a>        <span class="n">theme</span><span class="p">(</span><span class="n">axis_text_x</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">hjust</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="o">+</span>
</span><span id="plot_k_resolution_corresp-306"><a href="#plot_k_resolution_corresp-306"><span class="linenos">306</span></a>        <span class="n">guides</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">guide_legend</span><span class="p">(</span><span class="n">override_aes</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">pt_size_range</span><span class="p">)}))</span>
</span><span id="plot_k_resolution_corresp-307"><a href="#plot_k_resolution_corresp-307"><span class="linenos">307</span></a>    <span class="p">)</span>
</span><span id="plot_k_resolution_corresp-308"><a href="#plot_k_resolution_corresp-308"><span class="linenos">308</span></a>    
</span><span id="plot_k_resolution_corresp-309"><a href="#plot_k_resolution_corresp-309"><span class="linenos">309</span></a>    <span class="k">return</span> <span class="n">plot</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>    
</span></pre></div>


            <div class="docstring"><p>For each configuration provided in the clust_object, display what number of clusters appear for different values of the resolution parameters.</p>

<h3 id="args">Args:</h3>

<pre><code>clust_object (dict): The object returned by the `assess_clustering_stability` function.
color_information (str): The information to be used for coloring the points. Can be either `ecc` or `freq_part`.
dodge_width (float): The width of the dodging.
pt_size_range (float array): The range of point sizes.
summary_function (function): The function to be used for summarizing the ECC values.
</code></pre>

<h3 id="example">Example:</h3>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">pca_emb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Create an AnnData object from pca_emb</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">adata</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">AnnData</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">pca_emb</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Run scanpy.pp.neighbors to get the connectivities as an adjacency matrix</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sc</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">use_rep</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">adjacency_matrix</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">obsp</span><span class="p">[</span><span class="s1">&#39;connectivities&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">clust_obj</span> <span class="o">=</span> <span class="n">assess_clustering_stability</span><span class="p">(</span><span class="n">adjacency_matrix</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="n">n_repetitions</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plot_k_resolution_corresp</span><span class="p">(</span><span class="n">clust_obj</span><span class="p">)</span>
</code></pre>
</div>
</div>


                </section>
                <section id="plot_n_neigh_ecs">
                            <input id="plot_n_neigh_ecs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_n_neigh_ecs</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">nn_ecs_object</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="plot_n_neigh_ecs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#plot_n_neigh_ecs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="plot_n_neigh_ecs-311"><a href="#plot_n_neigh_ecs-311"><span class="linenos">311</span></a><span class="k">def</span> <span class="nf">plot_n_neigh_ecs</span><span class="p">(</span><span class="n">nn_ecs_object</span><span class="p">):</span>
</span><span id="plot_n_neigh_ecs-312"><a href="#plot_n_neigh_ecs-312"><span class="linenos">312</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="plot_n_neigh_ecs-313"><a href="#plot_n_neigh_ecs-313"><span class="linenos">313</span></a><span class="sd">    Display, for all configurations consisting in different number of neighbors, graph types and base embeddings, </span>
</span><span id="plot_n_neigh_ecs-314"><a href="#plot_n_neigh_ecs-314"><span class="linenos">314</span></a><span class="sd">    the EC Consistency of the partitions obtained over multiple runs.</span>
</span><span id="plot_n_neigh_ecs-315"><a href="#plot_n_neigh_ecs-315"><span class="linenos">315</span></a><span class="sd">    </span>
</span><span id="plot_n_neigh_ecs-316"><a href="#plot_n_neigh_ecs-316"><span class="linenos">316</span></a><span class="sd">    ### Args:</span>
</span><span id="plot_n_neigh_ecs-317"><a href="#plot_n_neigh_ecs-317"><span class="linenos">317</span></a><span class="sd">        nn_ecs_object (dict): The object returned by the `assess_nn_stability` function.</span>
</span><span id="plot_n_neigh_ecs-318"><a href="#plot_n_neigh_ecs-318"><span class="linenos">318</span></a><span class="sd">    </span>
</span><span id="plot_n_neigh_ecs-319"><a href="#plot_n_neigh_ecs-319"><span class="linenos">319</span></a><span class="sd">    ### Example:</span>
</span><span id="plot_n_neigh_ecs-320"><a href="#plot_n_neigh_ecs-320"><span class="linenos">320</span></a><span class="sd">    &gt;&gt;&gt; pca_emb = np.random.rand(100, 30)</span>
</span><span id="plot_n_neigh_ecs-321"><a href="#plot_n_neigh_ecs-321"><span class="linenos">321</span></a><span class="sd">    &gt;&gt;&gt; nn_stability_obj = assess_nn_stability(pca_emb, n_neigh_sequence= [10, 15, 20], n_repetitions = 10, algorithm = 4)</span>
</span><span id="plot_n_neigh_ecs-322"><a href="#plot_n_neigh_ecs-322"><span class="linenos">322</span></a><span class="sd">    &gt;&gt;&gt; plot_n_neigh_ecs(nn_stability_obj)</span>
</span><span id="plot_n_neigh_ecs-323"><a href="#plot_n_neigh_ecs-323"><span class="linenos">323</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="plot_n_neigh_ecs-324"><a href="#plot_n_neigh_ecs-324"><span class="linenos">324</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="plot_n_neigh_ecs-325"><a href="#plot_n_neigh_ecs-325"><span class="linenos">325</span></a>    <span class="k">for</span> <span class="n">config_name</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="n">nn_ecs_object</span><span class="p">[</span><span class="s1">&#39;n_neigh_ec_consistency&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="plot_n_neigh_ecs-326"><a href="#plot_n_neigh_ecs-326"><span class="linenos">326</span></a>        <span class="k">for</span> <span class="n">n_neigh</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="plot_n_neigh_ecs-327"><a href="#plot_n_neigh_ecs-327"><span class="linenos">327</span></a>            <span class="k">for</span> <span class="n">ecc</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
</span><span id="plot_n_neigh_ecs-328"><a href="#plot_n_neigh_ecs-328"><span class="linenos">328</span></a>                <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;ECC&#39;</span><span class="p">:</span> <span class="n">ecc</span><span class="p">,</span> <span class="s1">&#39;n_neigh&#39;</span><span class="p">:</span> <span class="n">n_neigh</span><span class="p">,</span> <span class="s1">&#39;config_name&#39;</span><span class="p">:</span> <span class="n">config_name</span><span class="p">})</span>
</span><span id="plot_n_neigh_ecs-329"><a href="#plot_n_neigh_ecs-329"><span class="linenos">329</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="plot_n_neigh_ecs-330"><a href="#plot_n_neigh_ecs-330"><span class="linenos">330</span></a>
</span><span id="plot_n_neigh_ecs-331"><a href="#plot_n_neigh_ecs-331"><span class="linenos">331</span></a>    <span class="c1"># Convert &#39;n_neigh&#39; to a categorical variable and sort its levels</span>
</span><span id="plot_n_neigh_ecs-332"><a href="#plot_n_neigh_ecs-332"><span class="linenos">332</span></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;n_neigh&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;n_neigh&#39;</span><span class="p">],</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="plot_n_neigh_ecs-333"><a href="#plot_n_neigh_ecs-333"><span class="linenos">333</span></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;n_neigh&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;n_neigh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">reorder_categories</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;n_neigh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
</span><span id="plot_n_neigh_ecs-334"><a href="#plot_n_neigh_ecs-334"><span class="linenos">334</span></a>
</span><span id="plot_n_neigh_ecs-335"><a href="#plot_n_neigh_ecs-335"><span class="linenos">335</span></a>    
</span><span id="plot_n_neigh_ecs-336"><a href="#plot_n_neigh_ecs-336"><span class="linenos">336</span></a>    <span class="n">plot</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="plot_n_neigh_ecs-337"><a href="#plot_n_neigh_ecs-337"><span class="linenos">337</span></a>        <span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;n_neigh&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;ECC&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;config_name&#39;</span><span class="p">))</span>
</span><span id="plot_n_neigh_ecs-338"><a href="#plot_n_neigh_ecs-338"><span class="linenos">338</span></a>        <span class="o">+</span> <span class="n">geom_boxplot</span><span class="p">()</span>
</span><span id="plot_n_neigh_ecs-339"><a href="#plot_n_neigh_ecs-339"><span class="linenos">339</span></a>        <span class="o">+</span> <span class="n">theme_classic</span><span class="p">()</span>
</span><span id="plot_n_neigh_ecs-340"><a href="#plot_n_neigh_ecs-340"><span class="linenos">340</span></a>    <span class="p">)</span>
</span><span id="plot_n_neigh_ecs-341"><a href="#plot_n_neigh_ecs-341"><span class="linenos">341</span></a>    
</span><span id="plot_n_neigh_ecs-342"><a href="#plot_n_neigh_ecs-342"><span class="linenos">342</span></a>    <span class="k">return</span> <span class="n">plot</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Display, for all configurations consisting in different number of neighbors, graph types and base embeddings, 
the EC Consistency of the partitions obtained over multiple runs.</p>

<h3 id="args">Args:</h3>

<pre><code>nn_ecs_object (dict): The object returned by the `assess_nn_stability` function.
</code></pre>

<h3 id="example">Example:</h3>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">pca_emb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nn_stability_obj</span> <span class="o">=</span> <span class="n">assess_nn_stability</span><span class="p">(</span><span class="n">pca_emb</span><span class="p">,</span> <span class="n">n_neigh_sequence</span><span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span> <span class="n">n_repetitions</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">algorithm</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plot_n_neigh_ecs</span><span class="p">(</span><span class="n">nn_stability_obj</span><span class="p">)</span>
</code></pre>
</div>
</div>


                </section>
    </main>
</body>
</html>